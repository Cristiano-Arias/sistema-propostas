<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Envio de Propostas</title>
    
    <!-- Importar arquivos do sistema -->
    <script src="auth.js"></script>
    <script src="sistema-notificacoes.js"></script>
    
    <!-- Configura√ß√£o da API -->
    <script>
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:5000' 
            : window.location.origin;
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
        }

        .auth-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(102, 126, 234, 0.1);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
        }

        .processo-info {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .processo-info input {
            background: transparent;
            border: 1px solid white;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .processo-info input#objetoProcesso {
            width: 400px;
        }

        .progress-container {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: #ecf0f1;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(45deg, #3498db, #2980b9);
            height: 100%;
            transition: width 0.3s ease;
            width: 0%;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 140px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active { background: #3498db; color: white; }

        .form-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .form-section.active { display: block; }

        .section-title {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
            font-size: 14px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row.single { grid-template-columns: 1fr; }
        .form-row.triple { grid-template-columns: 1fr 1fr 1fr; }

        .form-group { margin-bottom: 15px; }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 13px;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        textarea { resize: vertical; min-height: 70px; }

        .required { color: #e74c3c; }

        .help-text {
            font-size: 11px;
            color: #7f8c8d;
            margin-top: 3px;
        }

        .dynamic-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            margin: 10px 0;
        }

        .dynamic-table th {
            background: #3498db;
            color: white;
            padding: 10px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
        }

        .dynamic-table td {
            padding: 8px;
            border-bottom: 1px solid #ecf0f1;
        }

        .dynamic-table input, .dynamic-table select {
            border: 1px solid #ddd;
            padding: 5px;
            font-size: 12px;
        }

        .add-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin: 8px 0;
        }

        .remove-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
        }

        .cronograma-automatico-info {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
            color: #2c3e50;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .form-row, .form-row.triple { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
            .tab { min-width: auto; }
            .processo-info input#objetoProcesso { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Portal de Envio de Propostas</h1>
            <p>Sistema Profissional de Propostas T√©cnicas e Comerciais</p>
            <div class="auth-info" id="authInfo"></div>
        </div>

        <div class="processo-info">
            <h2>üìã Processo: <input type="text" id="numeroProcesso" readonly></h2>
            <p><strong>Objeto:</strong> <input type="text" id="objetoProcesso" readonly></p>
            <p><strong>Prazo para envio:</strong> <input type="text" id="prazoEnvio" readonly></p>
        </div>

        <div class="progress-container">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span><strong>Progresso:</strong> <span id="progressText">0%</span></span>
                <span style="font-size: 12px; color: #27ae60;">üíæ Auto-save ativo</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dados', this)">1. Dados Cadastrais</button>
            <button class="tab" onclick="showTab('resumo', this)">2. Resumo Proposta</button>
            <button class="tab" onclick="showTab('tecnica', this)">3. Proposta T√©cnica</button>
            <button class="tab" onclick="showTab('comercial', this)">4. Proposta Comercial</button>
            <button class="tab" onclick="showTab('revisao', this)">5. Revis√£o</button>
        </div>

        <!-- SE√á√ÉO 1: DADOS CADASTRAIS -->
        <div class="form-section active" id="dados">
            <div class="section-title">üè¢ 1. Dados Cadastrais</div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="razaoSocial">Raz√£o Social <span class="required">*</span></label>
                    <input type="text" id="razaoSocial" required>
                </div>
                <div class="form-group">
                    <label for="cnpj">CNPJ <span class="required">*</span></label>
                    <input type="text" id="cnpj" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="endereco">Endere√ßo Completo</label>
                    <input type="text" id="endereco">
                </div>
                <div class="form-group">
                    <label for="cidade">Cidade/UF</label>
                    <input type="text" id="cidade">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="telefone">Telefone</label>
                    <input type="tel" id="telefone">
                </div>
                <div class="form-group">
                    <label for="email">E-mail <span class="required">*</span></label>
                    <input type="email" id="email" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="respTecnico">Respons√°vel T√©cnico</label>
                    <input type="text" id="respTecnico">
                </div>
                <div class="form-group">
                    <label for="crea">CREA/CAU</label>
                    <input type="text" id="crea">
                </div>
            </div>
        </div>

        <!-- SE√á√ÉO 2: RESUMO DA PROPOSTA -->
        <div class="form-section" id="resumo">
            <div class="section-title">üìä 2. Resumo da Proposta</div>
            
            <div class="resumo-box" style="background: #e8f4f8; border: 2px solid #0ea5e9; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                    <span>üí∞ Pre√ßo Total:</span>
                    <span><strong>R$ <span id="precoTotalResumo">0,00</span></strong></span>
                </div>
                <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                    <span>‚è∞ Prazo de Execu√ß√£o:</span>
                    <span><strong><span id="prazoResumo">-- dias</span></strong></span>
                </div>
                <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                    <span>üí≥ Condi√ß√£o de Pagamento:</span>
                    <span><strong><span id="pagamentoResumo">A definir</span></strong></span>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="prazoExecucaoResumo">Prazo de Execu√ß√£o <span class="required">*</span></label>
                    <input type="text" id="prazoExecucaoResumo" placeholder="120 dias corridos" onchange="atualizarResumo()">
                </div>
                <div class="form-group">
                    <label for="formaPagamentoResumo">Condi√ß√£o de Pagamento</label>
                    <input type="text" id="formaPagamentoResumo" placeholder="30% entrada, 70% execu√ß√£o" onchange="atualizarResumo()">
                </div>
            </div>
        </div>

        <!-- SE√á√ÉO 3: PROPOSTA T√âCNICA COMPLETA -->
        <div class="form-section" id="tecnica">
            <div class="section-title">üìã 3. Proposta T√©cnica</div>

            <div class="section-title">3.1 Objeto da Concorr√™ncia</div>
            <div class="form-group">
                <label for="objetoConcorrencia">Descri√ß√£o do Objeto <span class="required">*</span></label>
                <textarea id="objetoConcorrencia" rows="3" required></textarea>
                <div class="help-text">Transcreva exatamente conforme edital</div>
            </div>

            <div class="section-title">3.2 Descri√ß√£o Detalhada do Escopo</div>
            <div class="form-group">
                <label for="escopoInclusos">Servi√ßos a Executar</label>
                <textarea id="escopoInclusos" rows="4" placeholder="Descreva todos os servi√ßos inclusos na proposta"></textarea>
            </div>
            <div class="form-group">
                <label for="escopoExclusos">Servi√ßos Exclu√≠dos</label>
                <textarea id="escopoExclusos" rows="3" placeholder="Liste servi√ßos que N√ÉO est√£o inclusos"></textarea>
            </div>

            <div class="section-title">3.3 Metodologia de Execu√ß√£o</div>
            <div class="form-group">
                <label for="metodologia">Detalhamento <span class="required">*</span></label>
                <textarea id="metodologia" rows="5" required placeholder="Descreva detalhadamente como os servi√ßos ser√£o executados"></textarea>
            </div>
            <div class="form-group">
                <label for="sequenciaExecucao">Plano de Execu√ß√£o</label>
                <textarea id="sequenciaExecucao" rows="3" placeholder="Sequ√™ncia l√≥gica de execu√ß√£o das atividades"></textarea>
            </div>

            <div class="section-title">3.3.1 Tabela de Servi√ßos (sem valores)</div>
            <table class="dynamic-table" id="servicosTecnicaTable">
                <thead>
                    <tr>
                        <th style="width: 8%;">Item</th>
                        <th style="width: 50%;">Descri√ß√£o</th>
                        <th style="width: 12%;">Unidade</th>
                        <th style="width: 15%;">Quantidade</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" value="1" readonly style="text-align: center;"></td>
                        <td><input type="text" placeholder="Descri√ß√£o do servi√ßo"></td>
                        <td><input type="text" placeholder="m¬≤"></td>
                        <td><input type="number" placeholder="100"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRow(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addServicoTecnicaRow()">+ Adicionar Servi√ßo</button>

            <div class="section-title">3.4 M√£o de Obra Direta e Indireta</div>
            <table class="dynamic-table" id="equipeTable">
                <thead>
                    <tr>
                        <th style="width: 40%;">Fun√ß√£o</th>
                        <th style="width: 20%;">Quantidade</th>
                        <th style="width: 20%;">Tempo (meses)</th>
                        <th style="width: 15%;">Qualifica√ß√£o</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Engenheiro Civil"></td>
                        <td><input type="number" placeholder="1"></td>
                        <td><input type="number" placeholder="4" step="0.1"></td>
                        <td><input type="text" placeholder="S√™nior"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRow(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addEquipeRow()">+ Adicionar Profissional</button>

            <div class="section-title">3.5 Lista de Materiais (Quantidades sem pre√ßos)</div>
            <table class="dynamic-table" id="materiaisTable">
                <thead>
                    <tr>
                        <th style="width: 30%;">Material</th>
                        <th style="width: 35%;">Especifica√ß√£o</th>
                        <th style="width: 15%;">Unidade</th>
                        <th style="width: 15%;">Quantidade</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Concreto"></td>
                        <td><input type="text" placeholder="FCK 25 MPa"></td>
                        <td><input type="text" placeholder="m¬≥"></td>
                        <td><input type="number" placeholder="450"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRow(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addMaterialRow()">+ Adicionar Material</button>

            <div class="section-title">3.6 Lista de Equipamentos (Quantidades)</div>
            <table class="dynamic-table" id="equipamentosTable">
                <thead>
                    <tr>
                        <th style="width: 25%;">Equipamento</th>
                        <th style="width: 30%;">Especifica√ß√£o</th>
                        <th style="width: 10%;">Unidade</th>
                        <th style="width: 15%;">Quantidade</th>
                        <th style="width: 15%;">Tempo (meses)</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Betoneira"></td>
                        <td><input type="text" placeholder="400L"></td>
                        <td><input type="text" placeholder="und"></td>
                        <td><input type="number" placeholder="2"></td>
                        <td><input type="number" placeholder="4" step="0.1"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRow(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addEquipamentoRow()">+ Adicionar Equipamento</button>

            <div class="section-title">3.9 Prazo de Execu√ß√£o</div>
            <div class="form-row single">
                <div class="form-group">
                    <label for="prazoExecucao">Prazo Total <span class="required">*</span></label>
                    <input type="text" id="prazoExecucao" placeholder="120 dias corridos" required>
                    <div class="help-text">Este prazo ser√° usado no cronograma e na proposta comercial</div>
                </div>
            </div>

            <div class="section-title">3.10 Prazo de Mobiliza√ß√£o</div>
            <div class="form-row single">
                <div class="form-group">
                    <label for="prazoMobilizacao">Mobiliza√ß√£o</label>
                    <input type="text" id="prazoMobilizacao" placeholder="15 dias">
                </div>
            </div>

            <div class="section-title">3.11 Cronograma de Execu√ß√£o Automatizado</div>
            <div class="cronograma-automatico-info">
                <strong>üí° Cronograma Inteligente:</strong> Insira apenas a atividade e a dura√ß√£o em dias. 
                As datas de in√≠cio e fim ser√£o calculadas automaticamente de forma sequencial.
            </div>
            <table class="dynamic-table" id="cronogramaTable">
                <thead>
                    <tr>
                        <th style="width: 40%;">Atividade</th>
                        <th style="width: 20%;">Dura√ß√£o (dias)</th>
                        <th style="width: 20%;">In√≠cio (Calculado)</th>
                        <th style="width: 15%;">Fim (Calculado)</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Mobiliza√ß√£o" value="Mobiliza√ß√£o"></td>
                        <td><input type="number" placeholder="15" min="1" value="15" onchange="calcularCronograma()"></td>
                        <td><input type="text" readonly value="Dia 1" style="background: #f8f9fa;"></td>
                        <td><input type="text" readonly value="Dia 15" style="background: #f8f9fa;"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRowAndRecalculate(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addCronogramaRow()">+ Adicionar Atividade</button>
            <div style="text-align: right; margin-top: 10px; font-weight: bold; color: #2c3e50;">
                Prazo Total Calculado: <span id="prazoTotalCronograma">15</span> dias
            </div>

            <div class="section-title">3.12 Garantias Oferecidas</div>
            <div class="form-group">
                <label for="garantias">Garantias</label>
                <textarea id="garantias" rows="3" placeholder="Ex: 5 anos para estrutura, 3 anos para acabamentos, 2 anos para instala√ß√µes"></textarea>
            </div>

            <div class="section-title">3.13 Necessidade de Canteiro</div>
            <div class="form-group">
                <label for="estruturaCanteiro">Estrutura do Canteiro</label>
                <textarea id="estruturaCanteiro" rows="3" placeholder="Escrit√≥rio, almoxarifado, vesti√°rios, refeit√≥rio, guarita"></textarea>
            </div>

            <div class="section-title">3.14 Obriga√ß√µes (Alimenta√ß√£o, Energia, etc.)</div>
            <div class="form-group">
                <label for="obrigacoesContratada">Responsabilidades da CONTRATADA</label>
                <textarea id="obrigacoesContratada" rows="3" placeholder="Alimenta√ß√£o, transporte, EPIs, ferramentas, energia provis√≥ria"></textarea>
            </div>
            <div class="form-group">
                <label for="obrigacoesContratante">Responsabilidades da CONTRATANTE</label>
                <textarea id="obrigacoesContratante" rows="3" placeholder="Ponto de energia, √°gua, acesso ao local"></textarea>
            </div>

            <div class="section-title">3.15 Experi√™ncia</div>
            <table class="dynamic-table" id="experienciaTable">
                <thead>
                    <tr>
                        <th style="width: 30%;">Obra</th>
                        <th style="width: 20%;">Cliente</th>
                        <th style="width: 15%;">Valor</th>
                        <th style="width: 10%;">Ano</th>
                        <th style="width: 20%;">Contato</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Nome da obra"></td>
                        <td><input type="text" placeholder="Cliente"></td>
                        <td><input type="text" placeholder="R$ 2.500.000"></td>
                        <td><input type="number" placeholder="2024"></td>
                        <td><input type="text" placeholder="(00) 0000-0000"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRow(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addExperienciaRow()">+ Adicionar Obra</button>

            <div class="section-title">3.16 Certifica√ß√µes/Qualifica√ß√µes</div>
            <table class="dynamic-table" id="certificacoesTable">
                <thead>
                    <tr>
                        <th style="width: 35%;">Certifica√ß√£o</th>
                        <th style="width: 30%;">√ìrg√£o Emissor</th>
                        <th style="width: 15%;">N√∫mero</th>
                        <th style="width: 15%;">Validade</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="ISO 9001:2015"></td>
                        <td><input type="text" placeholder="Bureau Veritas"></td>
                        <td><input type="text" placeholder="BR-XXXX"></td>
                        <td><input type="date"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRow(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addCertificacaoRow()">+ Adicionar Certifica√ß√£o</button>
        </div>

        <!-- SE√á√ÉO 4: PROPOSTA COMERCIAL COMPLETA -->
        <div class="form-section" id="comercial">
            <div class="section-title">üí∞ 4. Proposta Comercial</div>

            <div class="section-title">4.1 Objeto da Concorr√™ncia</div>
            <div class="form-group">
                <label for="objetoComercial">Objeto (ser√° copiado da proposta t√©cnica)</label>
                <textarea id="objetoComercial" rows="2" readonly style="background: #f8f9fa;"></textarea>
            </div>

            <div class="section-title">4.2 Tabela de Servi√ßos por Item</div>
            <table class="dynamic-table" id="servicosTable">
                <thead>
                    <tr>
                        <th style="width: 8%;">Item</th>
                        <th style="width: 40%;">Descri√ß√£o</th>
                        <th style="width: 10%;">Unid</th>
                        <th style="width: 12%;">Qtd</th>
                        <th style="width: 12%;">Pre√ßo Unit</th>
                        <th style="width: 13%;">Total</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" value="1" readonly style="text-align: center;"></td>
                        <td><input type="text" placeholder="Descri√ß√£o do servi√ßo"></td>
                        <td><input type="text" placeholder="m¬≥"></td>
                        <td><input type="number" placeholder="100" onchange="calcTotal(this)"></td>
                        <td><input type="number" placeholder="25.50" step="0.01" onchange="calcTotal(this)"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRow(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addServicoRow()">+ Adicionar Servi√ßo</button>
            
            <div style="text-align: right; margin: 10px 0; font-weight: bold; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                <span>TOTAL SERVI√áOS: R$ <span id="totalServicos">0,00</span></span>
            </div>

            <div class="section-title">4.3 Pre√ßo Global</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="valorTotal">Valor Total (Calculado Automaticamente)</label>
                    <input type="text" id="valorTotal" placeholder="R$ 0,00" readonly style="background: #f8f9fa; font-weight: bold; font-size: 16px;">
                </div>
                <div class="form-group">
                    <label for="validadeProposta">Validade da Proposta</label>
                    <input type="text" id="validadeProposta" placeholder="60 dias" value="60 dias">
                </div>
            </div>

            <div class="section-title">4.4 M√£o de Obra Direta e Indireta</div>
            <table class="dynamic-table" id="maoObraTable">
                <thead>
                    <tr>
                        <th style="width: 25%;">Fun√ß√£o</th>
                        <th style="width: 10%;">Qtd</th>
                        <th style="width: 10%;">Tempo</th>
                        <th style="width: 12%;">Sal√°rio</th>
                        <th style="width: 10%;">Enc.(%)</th>
                        <th style="width: 13%;">Total/M√™s</th>
                        <th style="width: 15%;">Total Geral</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Engenheiro Civil"></td>
                        <td><input type="number" placeholder="1" onchange="calcMaoObra(this)"></td>
                        <td><input type="number" placeholder="4" onchange="calcMaoObra(this)" step="0.1"></td>
                        <td><input type="number" placeholder="8500" onchange="calcMaoObra(this)" step="0.01"></td>
                        <td><input type="number" placeholder="80" value="80" onchange="calcMaoObra(this)" step="0.1"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRow(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addMaoObraRow()">+ Adicionar Fun√ß√£o</button>
            
            <div style="text-align: right; margin: 10px 0; font-weight: bold; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                <span>TOTAL M√ÉO DE OBRA: R$ <span id="totalMaoObra">0,00</span></span>
            </div>

            <div class="section-title">4.5 Lista de Materiais com Valores</div>
            <table class="dynamic-table" id="materiaisComercialTable">
                <thead>
                    <tr>
                        <th style="width: 25%;">Material</th>
                        <th style="width: 25%;">Especifica√ß√£o</th>
                        <th style="width: 10%;">Unidade</th>
                        <th style="width: 12%;">Quantidade</th>
                        <th style="width: 13%;">Pre√ßo Unit.</th>
                        <th style="width: 10%;">Total</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Concreto"></td>
                        <td><input type="text" placeholder="FCK 25 MPa"></td>
                        <td><input type="text" placeholder="m¬≥"></td>
                        <td><input type="number" placeholder="450" onchange="calcMaterial(this)"></td>
                        <td><input type="number" placeholder="320.50" step="0.01" onchange="calcMaterial(this)"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRow(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addMaterialComercialRow()">+ Adicionar Material</button>
            
            <div style="text-align: right; margin: 10px 0; font-weight: bold; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                <span>TOTAL MATERIAIS: R$ <span id="totalMateriais">0,00</span></span>
            </div>

            <div class="section-title">4.6 Equipamentos com Pre√ßo Unit√°rio, Tempo e Quantidade</div>
            <table class="dynamic-table" id="equipamentosComercialTable">
                <thead>
                    <tr>
                        <th style="width: 25%;">Equipamento</th>
                        <th style="width: 25%;">Especifica√ß√£o</th>
                        <th style="width: 10%;">Qtd</th>
                        <th style="width: 10%;">Tempo</th>
                        <th style="width: 15%;">Pre√ßo/m√™s</th>
                        <th style="width: 10%;">Total</th>
                        <th style="width: 5%;">A√ß√£o</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Betoneira"></td>
                        <td><input type="text" placeholder="400L"></td>
                        <td><input type="number" placeholder="2" onchange="calcEquipamento(this)"></td>
                        <td><input type="number" placeholder="4" step="0.1" onchange="calcEquipamento(this)"></td>
                        <td><input type="number" placeholder="1200" step="0.01" onchange="calcEquipamento(this)"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                        <td><button type="button" class="remove-btn" onclick="removeRow(this)">√ó</button></td>
                    </tr>
                </tbody>
            </table>
            <button type="button" class="add-btn" onclick="addEquipamentoComercialRow()">+ Adicionar Equipamento</button>
            
            <div style="text-align: right; margin: 10px 0; font-weight: bold; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                <span>TOTAL EQUIPAMENTOS: R$ <span id="totalEquipamentos">0,00</span></span>
            </div>

            <div class="section-title">4.7 BDI Detalhado</div>
            <table class="dynamic-table" id="bdiTable">
                <thead>
                    <tr>
                        <th style="width: 60%;">Item do BDI</th>
                        <th style="width: 20%;">Percentual (%)</th>
                        <th style="width: 20%;">Valor (R$)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" value="Administra√ß√£o Central" readonly></td>
                        <td><input type="number" placeholder="8.0" step="0.1" onchange="calcBDI()"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                    </tr>
                    <tr>
                        <td><input type="text" value="Seguros e Garantias" readonly></td>
                        <td><input type="number" placeholder="1.5" step="0.1" onchange="calcBDI()"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                    </tr>
                    <tr>
                        <td><input type="text" value="Riscos" readonly></td>
                        <td><input type="number" placeholder="2.0" step="0.1" onchange="calcBDI()"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                    </tr>
                    <tr>
                        <td><input type="text" value="Despesas Financeiras" readonly></td>
                        <td><input type="number" placeholder="1.0" step="0.1" onchange="calcBDI()"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                    </tr>
                    <tr>
                        <td><input type="text" value="Lucro" readonly></td>
                        <td><input type="number" placeholder="8.0" step="0.1" onchange="calcBDI()"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                    </tr>
                    <tr>
                        <td><input type="text" value="Tributos (ISS, PIS, COFINS)" readonly></td>
                        <td><input type="number" placeholder="7.5" step="0.1" onchange="calcBDI()"></td>
                        <td><input type="text" readonly style="background: #f8f9fa;"></td>
                    </tr>
                </tbody>
            </table>
            
            <div class="total-box" style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 5px solid #27ae60;">
                <div style="display: flex; justify-content: space-between; margin: 5px 0; font-weight: bold;">
                    <span>CUSTO DIRETO (Servi√ßos + MO + Mat + Equip):</span>
                    <span>R$ <span id="custoDirecto">0,00</span></span>
                </div>
                <div style="display: flex; justify-content: space-between; margin: 5px 0; color: #27ae60; font-weight: bold;">
                    <span>BDI TOTAL:</span>
                    <span><span id="bdiPercentual">0.0</span>% = R$ <span id="bdiValor">0,00</span></span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 10px; padding-top: 10px; border-top: 2px solid #27ae60; font-size: 18px; font-weight: bold;">
                    <span>VALOR TOTAL DA PROPOSTA:</span>
                    <span>R$ <span id="valorTotalCalculado">0,00</span></span>
                </div>
            </div>

            <div class="section-title">4.8 Condi√ß√µes</div>
            <div class="form-group">
                <label for="validadeDetalhada">Condi√ß√µes de Validade</label>
                <textarea id="validadeDetalhada" rows="3" placeholder="Proposta v√°lida por 60 dias. Pre√ßos sujeitos a reajuste ap√≥s este per√≠odo. N√£o inclusos impostos adicionais."></textarea>
            </div>

            <div class="form-group">
                <label for="condicoesPagamento">Condi√ß√µes de Pagamento Detalhadas</label>
                <textarea id="condicoesPagamento" rows="3" placeholder="30% na assinatura do contrato, 40% na entrega dos materiais, 30% na conclus√£o dos servi√ßos"></textarea>
            </div>
        </div>

        <!-- SE√á√ÉO 5: REVIS√ÉO FINAL -->
        <div class="form-section" id="revisao">
            <div class="section-title">üìã 5. Revis√£o Final</div>
            
            <div id="resumoProposta">
                <!-- Conte√∫do ser√° gerado dinamicamente -->
            </div>
        </div>

        <div class="submit-section" style="background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 25px; text-align: center; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);">
            <button type="button" class="preview-btn" onclick="gerarPreview()" style="background: linear-gradient(45deg, #f39c12, #e67e22); color: white; padding: 12px 25px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; margin: 0 8px; border: none;">
                üëÅÔ∏è Visualizar
            </button>
            <button type="button" class="submit-btn" onclick="enviarProposta()" style="background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; padding: 12px 25px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; margin: 0 8px; border: none;">
                üöÄ Enviar Proposta
            </button>
            
            <div id="mensagem" style="margin-top: 20px; display: none;"></div>
        </div>
    </div>

    <!-- Modal de Revis√£o Final -->
    <div id="modalRevisao" class="modal-revisao" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow-y: auto;">
        <div class="modal-revisao-content" style="background-color: white; margin: 2% auto; padding: 0; border-radius: 15px; width: 90%; max-width: 900px; box-shadow: 0 5px 30px rgba(0,0,0,0.3); max-height: 95vh; display: flex; flex-direction: column;">
            <div class="modal-revisao-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 30px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center;">
                <h2>üìã Revis√£o Final da Proposta</h2>
                <button onclick="fecharModalRevisao()" style="background: none; border: none; color: white; font-size: 28px; cursor: pointer;">&times;</button>
            </div>
            
            <div class="modal-revisao-body" style="padding: 30px; overflow-y: auto; flex: 1;">
                <div class="alerta-revisao" style="background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">‚ö†Ô∏è</span>
                    <div>
                        <strong>ATEN√á√ÉO:</strong> Revise cuidadosamente todos os dados antes de enviar.
                        Ap√≥s o envio, a proposta n√£o poder√° ser alterada.
                    </div>
                </div>
                
                <div id="conteudoRevisao">
                    <!-- Conte√∫do ser√° preenchido dinamicamente -->
                </div>
            </div>
            
            <div class="modal-revisao-footer" style="padding: 20px 30px; background: #f8f9fa; border-top: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; border-radius: 0 0 15px 15px;">
                <button class="btn-voltar-revisao" onclick="fecharModalRevisao()" style="background: #6c757d; color: white; padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">
                    ‚Üê Voltar e Editar
                </button>
                
                <div style="display: flex; align-items: center; gap: 15px;">
                    <label style="display: flex; align-items: center; gap: 5px; font-weight: 600;">
                        <input type="checkbox" id="confirmacaoFinal" onchange="habilitarBotaoEnvio()">
                        Confirmo que todos os dados est√£o corretos
                    </label>
                    
                    <button id="btnConfirmarEnvio" class="btn-confirmar-envio" onclick="confirmarEnvioFinal()" disabled style="opacity: 0.5; background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">
                        ‚úÖ Confirmar e Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- INCLUIR O ARQUIVO DE SCRIPTS COMPLETO -->
    <script src="portal-propostas-completo-scripts.js"></script>
    <script>
    // Garantir que showTab esteja dispon√≠vel
    window.showTab = showTab;
    window.atualizarResumo = atualizarResumo;
    window.calcularCronograma = calcularCronograma;
    window.removeRow = removeRow;
    window.removeRowAndRecalculate = removeRowAndRecalculate;
    window.calcTotal = calcTotal;
    window.calcMaoObra = calcMaoObra;
    window.calcMaterial = calcMaterial;
    window.calcEquipamento = calcEquipamento;
    window.calcBDI = calcBDI;
    window.gerarPreview = gerarPreview;
    window.enviarProposta = enviarProposta;
    </script>
</body>
</html>
    </div>
