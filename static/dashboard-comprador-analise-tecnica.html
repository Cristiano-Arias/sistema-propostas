<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise Comparativa T√©cnica - Sistema de Gest√£o de Propostas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            text-align: center;
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }

        .logo h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .logo p {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-title {
            padding: 0 20px;
            font-size: 12px;
            text-transform: uppercase;
            opacity: 0.7;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
        }

        .nav-item:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .nav-item.active {
            background-color: rgba(255,255,255,0.2);
            border-right: 3px solid #4caf50;
        }

        .nav-item .icon {
            margin-right: 10px;
            font-size: 16px;
        }

        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #2e7d32;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .analysis-container {
            display: grid;
            gap: 20px;
        }

        .methodology-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .section-title .icon {
            margin-right: 10px;
            font-size: 20px;
        }

        .methodology-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .methodology-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .methodology-card:hover {
            border-color: #2e7d32;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.1);
        }

        .methodology-card.selected {
            border-color: #2e7d32;
            background: #f1f8e9;
        }

        .methodology-card h3 {
            color: #2e7d32;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .methodology-card p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .methodology-features {
            list-style: none;
        }

        .methodology-features li {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
            padding-left: 15px;
            position: relative;
        }

        .methodology-features li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: bold;
        }

        .criteria-section {
            margin-top: 30px;
        }

        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .criteria-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #2e7d32;
        }

        .criteria-item h4 {
            color: #2e7d32;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .criteria-item .weight {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .criteria-item .description {
            font-size: 12px;
            color: #777;
            line-height: 1.4;
        }

        .proposals-comparison {
            margin-top: 30px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .comparison-table th {
            background: #2e7d32;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .comparison-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .comparison-table tr:hover {
            background: #f8f9fa;
        }

        .score-cell {
            text-align: center;
            font-weight: 600;
        }

        .score-excellent {
            color: #4caf50;
            background: #e8f5e8;
            border-radius: 4px;
            padding: 5px 10px;
        }

        .score-good {
            color: #ff9800;
            background: #fff3e0;
            border-radius: 4px;
            padding: 5px 10px;
        }

        .score-regular {
            color: #f44336;
            background: #ffebee;
            border-radius: 4px;
            padding: 5px 10px;
        }

        .technical-analysis {
            margin-top: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
        }

        .analysis-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .analysis-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .analysis-item h4 {
            color: #2e7d32;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .analysis-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .analysis-metrics {
            background: white;
            border-radius: 8px;
            padding: 15px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .metric:last-child {
            margin-bottom: 0;
        }

        .metric-label {
            color: #666;
        }

        .metric-value {
            font-weight: 600;
            color: #2e7d32;
        }

        .analysis-description {
            background: white;
            border-radius: 8px;
            padding: 15px;
        }

        .analysis-description p {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .analysis-description p:last-child {
            margin-bottom: 0;
        }

        .recommendation-section {
            background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%);
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            border: 2px solid #4caf50;
        }

        .recommendation-title {
            color: #2e7d32;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .recommendation-title .icon {
            margin-right: 10px;
            font-size: 20px;
        }

        .recommendation-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .recommendation-text {
            color: #2e7d32;
            font-size: 14px;
            line-height: 1.6;
        }

        .recommendation-summary {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .recommended-supplier {
            font-size: 18px;
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .recommendation-score {
            font-size: 24px;
            font-weight: 700;
            color: #4caf50;
            margin-bottom: 5px;
        }

        .recommendation-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #2e7d32;
            color: white;
        }

        .btn-primary:hover {
            background: #1b5e20;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #ddd;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2e7d32;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .main-content {
                margin-left: 200px;
            }
            
            .methodology-grid {
                grid-template-columns: 1fr;
            }
            
            .criteria-grid {
                grid-template-columns: 1fr;
            }
            
            .analysis-content {
                grid-template-columns: 1fr;
            }
            
            .recommendation-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="logo">
                <div style="font-size: 24px; margin-bottom: 5px;">üè¢</div>
                <h2>Portal do Comprador</h2>
                <p>Sistema de Gest√£o de Propostas</p>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">PRINCIPAL</div>
                <button class="nav-item" onclick="navigateTo('dashboard')">
                    <span class="icon">üìä</span> Dashboard
                </button>
                <button class="nav-item" onclick="navigateTo('aprovacao-trs')">
                    <span class="icon">üìã</span> Aprova√ß√£o de TRs
                </button>
                <button class="nav-item" onclick="navigateTo('criar-processo')">
                    <span class="icon">üèóÔ∏è</span> Criar Processo
                </button>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">PROPOSTAS</div>
                <button class="nav-item" onclick="navigateTo('propostas-recebidas')">
                    <span class="icon">üìÑ</span> Propostas Recebidas
                </button>
                <button class="nav-item active" onclick="navigateTo('analise-tecnica')">
                    <span class="icon">üî¨</span> An√°lise T√©cnica
                </button>
                <button class="nav-item" onclick="navigateTo('analise-comparativa')">
                    <span class="icon">üìä</span> An√°lise Comparativa
                </button>
                <button class="nav-item" onclick="navigateTo('relatorios')">
                    <span class="icon">üìà</span> Relat√≥rios
                </button>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">SISTEMA</div>
                <button class="nav-item" onclick="logout()">
                    <span class="icon">üö™</span> Sair
                </button>
            </div>
        </nav>

        <main class="main-content">
            <div class="header">
                <h1>üî¨ An√°lise Comparativa T√©cnica</h1>
                <p>Avalia√ß√£o t√©cnica detalhada das propostas recebidas com metodologias avan√ßadas</p>
            </div>

            <div id="loadingSection" class="loading">
                <div class="loading-spinner"></div>
                <p>Carregando an√°lise t√©cnica...</p>
            </div>

            <div id="analysisContent" class="analysis-container" style="display: none;">
                <!-- Se√ß√£o de Metodologias -->
                <div class="methodology-section">
                    <h2 class="section-title">
                        <span class="icon">‚öôÔ∏è</span>
                        Metodologias de An√°lise T√©cnica
                    </h2>
                    
                    <div class="methodology-grid" id="methodologyGrid">
                        <!-- Metodologias ser√£o carregadas aqui -->
                    </div>
                    
                    <div class="criteria-section">
                        <h3 class="section-title">
                            <span class="icon">üìã</span>
                            Crit√©rios de Avalia√ß√£o
                        </h3>
                        <div class="criteria-grid" id="criteriaGrid">
                            <!-- Crit√©rios ser√£o carregados aqui -->
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o de Compara√ß√£o de Propostas -->
                <div class="methodology-section">
                    <h2 class="section-title">
                        <span class="icon">üìä</span>
                        Compara√ß√£o T√©cnica das Propostas
                    </h2>
                    
                    <div class="proposals-comparison">
                        <table class="comparison-table" id="comparisonTable">
                            <!-- Tabela ser√° carregada aqui -->
                        </table>
                    </div>
                </div>

                <!-- Se√ß√£o de An√°lise Detalhada -->
                <div class="methodology-section">
                    <h2 class="section-title">
                        <span class="icon">üîç</span>
                        An√°lise T√©cnica Detalhada
                    </h2>
                    
                    <div class="technical-analysis" id="technicalAnalysis">
                        <!-- An√°lises detalhadas ser√£o carregadas aqui -->
                    </div>
                </div>

                <!-- Se√ß√£o de Recomenda√ß√£o -->
                <div class="recommendation-section">
                    <h2 class="recommendation-title">
                        <span class="icon">üéØ</span>
                        Recomenda√ß√£o T√©cnica
                    </h2>
                    
                    <div class="recommendation-content" id="recommendationContent">
                        <!-- Recomenda√ß√£o ser√° carregada aqui -->
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="exportAnalysis()">
                        üìÑ Exportar An√°lise
                    </button>
                    <button class="btn btn-secondary" onclick="saveAsDraft()">
                        üíæ Salvar Rascunho
                    </button>
                    <button class="btn btn-info" onclick="abrirComparativoProcesso()">
                        <i class="fas fa-balance-scale"></i>
                        Comparar Propostas
                    </button>
                    <button class="btn btn-primary" onclick="finalizeAnalysis()">
                        ‚úÖ Finalizar An√°lise
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Dados das metodologias de an√°lise t√©cnica
        const methodologies = [
            {
                id: 'ahp',
                name: 'AHP - Analytic Hierarchy Process',
                description: 'Metodologia de an√°lise hier√°rquica que permite compara√ß√£o par a par dos crit√©rios e alternativas.',
                features: [
                    'Compara√ß√£o par a par',
                    'Matriz de consist√™ncia',
                    'Pesos relativos autom√°ticos',
                    'An√°lise de sensibilidade'
                ],
                selected: true
            },
            {
                id: 'topsis',
                name: 'TOPSIS - Technique for Order Preference',
                description: 'T√©cnica baseada na proximidade com a solu√ß√£o ideal positiva e dist√¢ncia da solu√ß√£o ideal negativa.',
                features: [
                    'Solu√ß√£o ideal positiva/negativa',
                    'Dist√¢ncia euclidiana',
                    'Coeficiente de proximidade',
                    'Ranking autom√°tico'
                ]
            },
            {
                id: 'electre',
                name: 'ELECTRE - Elimination and Choice',
                description: 'M√©todo de elimina√ß√£o e escolha baseado em rela√ß√µes de sobreclassifica√ß√£o.',
                features: [
                    'Rela√ß√µes de sobreclassifica√ß√£o',
                    'Limiares de prefer√™ncia',
                    'An√°lise de concord√¢ncia',
                    'An√°lise de discord√¢ncia'
                ]
            },
            {
                id: 'promethee',
                name: 'PROMETHEE - Preference Ranking',
                description: 'M√©todo de ordena√ß√£o por prefer√™ncia baseado em fun√ß√µes de prefer√™ncia.',
                features: [
                    'Fun√ß√µes de prefer√™ncia',
                    'Fluxos de prefer√™ncia',
                    'Ranking parcial/completo',
                    'An√°lise GAIA'
                ]
            }
        ];

        // Crit√©rios de avalia√ß√£o t√©cnica
        const technicalCriteria = [
            {
                name: 'Experi√™ncia da Equipe',
                weight: 25,
                description: 'Avalia√ß√£o da experi√™ncia e qualifica√ß√£o da equipe t√©cnica proposta'
            },
            {
                name: 'Metodologia Proposta',
                weight: 20,
                description: 'Adequa√ß√£o e qualidade da metodologia de desenvolvimento/execu√ß√£o'
            },
            {
                name: 'Cronograma de Execu√ß√£o',
                weight: 15,
                description: 'Viabilidade e detalhamento do cronograma apresentado'
            },
            {
                name: 'Recursos T√©cnicos',
                weight: 15,
                description: 'Adequa√ß√£o dos recursos t√©cnicos e tecnol√≥gicos propostos'
            },
            {
                name: 'Qualidade da Proposta',
                weight: 10,
                description: 'Clareza, completude e organiza√ß√£o da proposta t√©cnica'
            },
            {
                name: 'Inova√ß√£o e Diferencial',
                weight: 10,
                description: 'Solu√ß√µes inovadoras e diferenciais competitivos apresentados'
            },
            {
                name: 'Sustentabilidade',
                weight: 5,
                description: 'Aspectos ambientais e de sustentabilidade da solu√ß√£o proposta'
            }
        ];

        // Dados das propostas para an√°lise
        const proposalsData = [
            {
                id: 1,
                supplier: 'Alpha Tecnologia Ltda',
                cnpj: '11.222.333/0001-44',
                scores: {
                    experiencia: 85,
                    metodologia: 90,
                    cronograma: 80,
                    recursos: 88,
                    qualidade: 92,
                    inovacao: 75,
                    sustentabilidade: 70
                },
                totalScore: 0,
                ranking: 0
            },
            {
                id: 2,
                supplier: 'Beta Solutions S.A.',
                cnpj: '22.333.444/0001-55',
                scores: {
                    experiencia: 92,
                    metodologia: 88,
                    cronograma: 95,
                    recursos: 90,
                    qualidade: 85,
                    inovacao: 80,
                    sustentabilidade: 85
                },
                totalScore: 0,
                ranking: 0
            },
            {
                id: 3,
                supplier: 'Gamma Tech Inova√ß√£o',
                cnpj: '33.444.555/0001-66',
                scores: {
                    experiencia: 78,
                    metodologia: 82,
                    cronograma: 75,
                    recursos: 85,
                    qualidade: 80,
                    inovacao: 95,
                    sustentabilidade: 90
                },
                totalScore: 0,
                ranking: 0
            }
        ];

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                loadAnalysisContent();
            }, 2000);
        });

        function loadAnalysisContent() {
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('analysisContent').style.display = 'block';
            
            renderMethodologies();
            renderCriteria();
            calculateScores();
            renderComparisonTable();
            renderTechnicalAnalysis();
            renderRecommendation();
        }

        function renderMethodologies() {
            const grid = document.getElementById('methodologyGrid');
            
            grid.innerHTML = methodologies.map(method => `
                <div class="methodology-card ${method.selected ? 'selected' : ''}" 
                     onclick="selectMethodology('${method.id}')">
                    <h3>${method.name}</h3>
                    <p>${method.description}</p>
                    <ul class="methodology-features">
                        ${method.features.map(feature => `<li>${feature}</li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }

        function renderCriteria() {
            const grid = document.getElementById('criteriaGrid');
            
            grid.innerHTML = technicalCriteria.map(criteria => `
                <div class="criteria-item">
                    <h4>${criteria.name}</h4>
                    <div class="weight">Peso: ${criteria.weight}%</div>
                    <div class="description">${criteria.description}</div>
                </div>
            `).join('');
        }

        function calculateScores() {
            proposalsData.forEach(proposal => {
                let totalScore = 0;
                
                totalScore += (proposal.scores.experiencia * 0.25);
                totalScore += (proposal.scores.metodologia * 0.20);
                totalScore += (proposal.scores.cronograma * 0.15);
                totalScore += (proposal.scores.recursos * 0.15);
                totalScore += (proposal.scores.qualidade * 0.10);
                totalScore += (proposal.scores.inovacao * 0.10);
                totalScore += (proposal.scores.sustentabilidade * 0.05);
                
                proposal.totalScore = Math.round(totalScore * 100) / 100;
            });
            
            // Ordenar por pontua√ß√£o e definir ranking
            proposalsData.sort((a, b) => b.totalScore - a.totalScore);
            proposalsData.forEach((proposal, index) => {
                proposal.ranking = index + 1;
            });
        }

        function renderComparisonTable() {
            const table = document.getElementById('comparisonTable');
            
            const headers = [
                'Fornecedor',
                'Experi√™ncia (25%)',
                'Metodologia (20%)',
                'Cronograma (15%)',
                'Recursos (15%)',
                'Qualidade (10%)',
                'Inova√ß√£o (10%)',
                'Sustentabilidade (5%)',
                'Pontua√ß√£o Total',
                'Ranking'
            ];
            
            const headerRow = `<tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>`;
            
            const dataRows = proposalsData.map(proposal => `
                <tr>
                    <td><strong>${proposal.supplier}</strong><br><small>${proposal.cnpj}</small></td>
                    <td class="score-cell">${getScoreClass(proposal.scores.experiencia)}</td>
                    <td class="score-cell">${getScoreClass(proposal.scores.metodologia)}</td>
                    <td class="score-cell">${getScoreClass(proposal.scores.cronograma)}</td>
                    <td class="score-cell">${getScoreClass(proposal.scores.recursos)}</td>
                    <td class="score-cell">${getScoreClass(proposal.scores.qualidade)}</td>
                    <td class="score-cell">${getScoreClass(proposal.scores.inovacao)}</td>
                    <td class="score-cell">${getScoreClass(proposal.scores.sustentabilidade)}</td>
                    <td class="score-cell"><strong>${proposal.totalScore}</strong></td>
                    <td class="score-cell"><strong>${proposal.ranking}¬∫</strong></td>
                </tr>
            `).join('');
            
            table.innerHTML = `<thead>${headerRow}</thead><tbody>${dataRows}</tbody>`;
        }

        function getScoreClass(score) {
            if (score >= 85) return `<span class="score-excellent">${score}</span>`;
            if (score >= 70) return `<span class="score-good">${score}</span>`;
            return `<span class="score-regular">${score}</span>`;
        }

        function renderTechnicalAnalysis() {
            const container = document.getElementById('technicalAnalysis');
            
            const analyses = [
                {
                    title: 'An√°lise de Experi√™ncia da Equipe',
                    metrics: {
                        'M√©dia Geral': '85.0 pontos',
                        'Melhor Avalia√ß√£o': 'Beta Solutions (92 pts)',
                        'Desvio Padr√£o': '7.2 pontos',
                        'Coeficiente de Varia√ß√£o': '8.5%'
                    },
                    description: `A an√°lise da experi√™ncia da equipe revela que a Beta Solutions apresenta a equipe mais experiente, 
                    com profissionais seniores e certifica√ß√µes relevantes. A Alpha Tecnologia demonstra boa experi√™ncia t√©cnica, 
                    enquanto a Gamma Tech, apesar de menor experi√™ncia m√©dia, compensa com especializa√ß√£o em tecnologias emergentes.`
                },
                {
                    title: 'An√°lise de Metodologia Proposta',
                    metrics: {
                        'M√©dia Geral': '86.7 pontos',
                        'Melhor Avalia√ß√£o': 'Alpha Tecnologia (90 pts)',
                        'Metodologia Predominante': 'Agile/Scrum',
                        'Conformidade PMBOK': '100%'
                    },
                    description: `A Alpha Tecnologia apresenta a metodologia mais robusta, com framework h√≠brido adaptado √†s necessidades 
                    do projeto. Todas as propostas demonstram ader√™ncia √†s melhores pr√°ticas de gerenciamento de projetos, 
                    com destaque para a implementa√ß√£o de metodologias √°geis.`
                },
                {
                    title: 'An√°lise de Recursos T√©cnicos',
                    metrics: {
                        'M√©dia Geral': '87.7 pontos',
                        'Melhor Avalia√ß√£o': 'Beta Solutions (90 pts)',
                        'Tecnologias Modernas': '95% das propostas',
                        'Cloud Computing': '100% das propostas'
                    },
                    description: `Todas as propostas demonstram adequa√ß√£o tecnol√≥gica excelente, com uso de tecnologias modernas 
                    e arquiteturas em nuvem. A Beta Solutions se destaca pela infraestrutura mais robusta e ferramentas 
                    de monitoramento avan√ßadas.`
                }
            ];
            
            container.innerHTML = analyses.map(analysis => `
                <div class="analysis-item">
                    <h4>${analysis.title}</h4>
                    <div class="analysis-content">
                        <div class="analysis-metrics">
                            ${Object.entries(analysis.metrics).map(([key, value]) => `
                                <div class="metric">
                                    <span class="metric-label">${key}:</span>
                                    <span class="metric-value">${value}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="analysis-description">
                            <p>${analysis.description}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderRecommendation() {
            const container = document.getElementById('recommendationContent');
            const winner = proposalsData[0]; // Primeiro colocado
            
            container.innerHTML = `
                <div class="recommendation-text">
                    <p><strong>Com base na an√°lise t√©cnica detalhada utilizando a metodologia AHP (Analytic Hierarchy Process)</strong>, 
                    recomenda-se a contrata√ß√£o da <strong>${winner.supplier}</strong>.</p>
                    
                    <p>Esta recomenda√ß√£o baseia-se nos seguintes fatores:</p>
                    <ul style="margin: 15px 0; padding-left: 20px;">
                        <li><strong>Pontua√ß√£o t√©cnica superior:</strong> ${winner.totalScore} pontos de 100 poss√≠veis</li>
                        <li><strong>Equipe experiente:</strong> ${winner.scores.experiencia} pontos em experi√™ncia</li>
                        <li><strong>Cronograma vi√°vel:</strong> ${winner.scores.cronograma} pontos em planejamento</li>
                        <li><strong>Recursos adequados:</strong> ${winner.scores.recursos} pontos em recursos t√©cnicos</li>
                        <li><strong>Metodologia robusta:</strong> ${winner.scores.metodologia} pontos em metodologia</li>
                    </ul>
                    
                    <p>A proposta apresenta excelente rela√ß√£o entre qualidade t√©cnica e viabilidade de execu√ß√£o, 
                    demonstrando capacidade para atender plenamente aos requisitos do Termo de Refer√™ncia.</p>
                </div>
                
                <div class="recommendation-summary">
                    <div class="recommended-supplier">${winner.supplier}</div>
                    <div class="recommendation-score">${winner.totalScore}</div>
                    <div class="recommendation-label">Pontua√ß√£o T√©cnica</div>
                </div>
            `;
        }

        function selectMethodology(methodId) {
            methodologies.forEach(method => {
                method.selected = method.id === methodId;
            });
            renderMethodologies();
            
            // Recalcular an√°lise com nova metodologia
            setTimeout(() => {
                calculateScores();
                renderComparisonTable();
                renderTechnicalAnalysis();
                renderRecommendation();
            }, 500);
        }

        function exportAnalysis() {
            alert('Funcionalidade de exporta√ß√£o ser√° implementada. A an√°lise ser√° exportada em formato PDF.');
        }

        function saveAsDraft() {
            const analysisData = {
                methodology: methodologies.find(m => m.selected)?.id || 'ahp',
                criteria: technicalCriteria,
                proposals: proposalsData,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('technical_analysis_draft', JSON.stringify(analysisData));
            alert('An√°lise salva como rascunho com sucesso!');
        }

        function finalizeAnalysis() {
            if (confirm('Deseja finalizar a an√°lise t√©cnica? Esta a√ß√£o n√£o poder√° ser desfeita.')) {
                const analysisData = {
                    methodology: methodologies.find(m => m.selected)?.id || 'ahp',
                    criteria: technicalCriteria,
                    proposals: proposalsData,
                    recommendation: proposalsData[0],
                    status: 'FINALIZADA',
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('technical_analysis_final', JSON.stringify(analysisData));
                alert('An√°lise t√©cnica finalizada com sucesso! Os dados foram salvos e a an√°lise est√° pronta para envio ao requisitante.');
            }
        }

        function navigateTo(page) {
            const pages = {
                'dashboard': 'dashboard-comprador-funcional.html',
                'aprovacao-trs': 'dashboard-comprador-aprovacao-tr.html',
                'criar-processo': 'dashboard-comprador-criar-processo.html',
                'propostas-recebidas': 'dashboard-comprador-integrado.html',
                'analise-comparativa': 'dashboard-comprador-comparativo.html',
                'relatorios': 'dashboard-comprador-comparativo.html'
            };
            
            if (pages[page]) {
                window.location.href = pages[page];
            }
        }

        function logout() {
            if (confirm('Deseja sair do sistema?')) {
                localStorage.removeItem('user_session');
                window.location.href = 'index.html';
            }
        }

        function abrirComparativoProcesso() {
            const processoId = obterProcessoAtual();
            if (processoId) {
                window.open(`dashboard-comparativo-real.html?processo=${processoId}`, '_blank');
            } else {
                alert('Selecione um processo para compara√ß√£o.');
            }
        }

        function obterProcessoAtual() {
            // Implementar l√≥gica para obter ID do processo atual
            // Pode ser de um campo hidden, URL parameter, etc.
            return document.getElementById('processo-id')?.value || 
                   new URLSearchParams(window.location.search).get('processo');
        }
                
    </script>
        <!-- Scripts de Integra√ß√£o - Adicionar AP√ìS os scripts existentes -->
        <script src="js/auth.js"></script>
        <script src="js/api-client.js"></script>
        <script src="js/integration.js"></script>
        <script src="js/integracao-modulos.js"></script>

    <!-- Script de Corre√ß√£o para Visualiza√ß√£o de Propostas -->
    <script>
        // Script de corre√ß√£o para integra√ß√£o das propostas no m√≥dulo Comprador
    
        // Fun√ß√£o para corrigir a busca de propostas no m√≥dulo Comprador
        function corrigirBuscaPropostas() {
            // Sobrescrever a fun√ß√£o carregarProcessos no dashboard-comprador-funcional
            if (typeof carregarProcessos !== 'undefined') {
                const carregarProcessosOriginal = carregarProcessos;
                
                window.carregarProcessos = function() {
                    const processos = SistemaLocal.carregar(SistemaLocal.CHAVES.PROCESSOS, []);
                    const container = document.getElementById('processos-list');
    
                    if (processos.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #666;">
                                <i class="fas fa-info-circle" style="font-size: 64px; margin-bottom: 20px; opacity: 0.5;"></i>
                                <h3>Nenhum processo criado</h3>
                                <p>Os processos licitat√≥rios criados aparecer√£o aqui.</p>
                                <button class="btn btn-primary" onclick="mostrarPagina('criar-processo')">
                                    <i class="fas fa-plus-circle"></i> Criar Primeiro Processo
                                </button>
                            </div>
                        `;
                        return;
                    }
    
                    let html = '';
                    processos.forEach(processo => {
                        const dataAbertura = new Date(processo.dataAbertura).toLocaleDateString('pt-BR');
                        const dataLimite = new Date(processo.dataLimite).toLocaleDateString('pt-BR');
                        const dataCriacao = new Date(processo.dataCriacao).toLocaleDateString('pt-BR');
                        
                        // CORRE√á√ÉO: Buscar propostas de TODAS as fontes
                        const propostasCompletas = SistemaLocal.carregar('propostas_completas', []);
                        const propostasFornecedores = SistemaLocal.carregar('propostas_fornecedores', []);
                        
                        // Filtrar propostas deste processo
                        const propostasProcesso = propostasCompletas.filter(p => p.processoId === processo.id);
                        const propostasFormatadas = propostasFornecedores.filter(p => p.processoId === processo.id);
                        
                        // Combinar todas as propostas
                        const todasPropostas = [...propostasProcesso];
                        
                        // Adicionar propostas do fornecedor que n√£o est√£o duplicadas
                        propostasFormatadas.forEach(pf => {
                            if (!todasPropostas.some(p => p.id === pf.id)) {
                                // Formatar proposta do fornecedor para o formato esperado
                                const propostaFormatada = {
                                    id: pf.id,
                                    processoId: pf.processoId,
                                    fornecedor: {
                                        id: pf.fornecedorId,
                                        razaoSocial: pf.fornecedorRazaoSocial,
                                        cnpj: pf.fornecedorCNPJ
                                    },
                                    propostaComercial: {
                                        valorTotal: pf.valor
                                    },
                                    propostaTecnica: {
                                        prazoExecucao: pf.prazoExecucao
                                    },
                                    dataEnvio: pf.dataEnvio,
                                    dadosCompletos: pf.dadosCompletos
                                };
                                todasPropostas.push(propostaFormatada);
                            }
                        });
                        
                        const statusColor = processo.status === 'ATIVO' ? '#28a745' : '#6c757d';
                        const statusIcon = processo.status === 'ATIVO' ? 'fa-check-circle' : 'fa-pause-circle';
                        
                        html += `
                            <div class="tr-item" style="border-left: 5px solid ${statusColor};">
                                <div class="tr-status-badge" style="background: ${statusColor};">
                                    <i class="fas ${statusIcon}"></i> ${processo.status}
                                </div>
                                
                                <div class="tr-title">${processo.numeroProcesso}</div>
                                <div class="tr-meta">
                                    <span><i class="fas fa-tag"></i> ${processo.modalidade}</span>
                                    <span><i class="fas fa-calendar"></i> Criado: ${dataCriacao}</span>
                                    <span><i class="fas fa-calendar-alt"></i> Abertura: ${dataAbertura}</span>
                                    <span><i class="fas fa-clock"></i> Limite: ${dataLimite}</span>
                                    <span><i class="fas fa-users"></i> ${processo.fornecedores?.length || 0} fornecedor(es)</span>
                                </div>
                                <div class="tr-objective">
                                    <strong>TR Vinculado:</strong> ${processo.trVinculado?.titulo || 'N√£o informado'}<br>
                                    <strong>Local:</strong> ${processo.localAbertura}<br>
                                    <strong>Valor Estimado:</strong> R$ ${parseFloat(processo.trVinculado?.valorEstimado || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                                </div>
                                
                                ${todasPropostas.length > 0 ? `
                                    <div style="margin-top: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                                        <h5 style="color: #333; margin-bottom: 10px;">
                                            <i class="fas fa-envelope"></i> Propostas Recebidas (${todasPropostas.length})
                                        </h5>
                                        ${todasPropostas.map(proposta => `
                                            <div style="background: white; padding: 10px; margin-bottom: 8px; border-radius: 4px; border-left: 3px solid #11998e;">
                                                <strong>${proposta.fornecedor.razaoSocial}</strong><br>
                                                <small>
                                                    <i class="fas fa-money-bill"></i> Valor Total: R$ ${parseFloat(proposta.propostaComercial?.valorTotal || proposta.valor || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})} | 
                                                    <i class="fas fa-clock"></i> ${proposta.propostaTecnica?.prazoExecucao || proposta.prazoExecucao || 'N/A'} | 
                                                    <i class="fas fa-calendar"></i> ${new Date(proposta.dataEnvio).toLocaleDateString('pt-BR')}
                                                </small>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : `
                                    <div style="margin-top: 15px; background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffeaa7;">
                                        <i class="fas fa-info-circle" style="color: #856404;"></i>
                                        <span style="color: #856404; margin-left: 8px;">Nenhuma proposta recebida ainda</span>
                                    </div>
                                `}
                                
                                <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button class="btn btn-info" onclick="visualizarProcesso('${processo.id}')">
                                        <i class="fas fa-eye"></i> Visualizar
                                    </button>
                                    <button class="btn btn-primary" onclick="gerenciarFornecedores('${processo.id}')">
                                        <i class="fas fa-users"></i> Fornecedores
                                    </button>
                                    ${todasPropostas.length > 0 ? `
                                        <button class="btn btn-success" onclick="analisarPropostas('${processo.id}')">
                                            <i class="fas fa-chart-bar"></i> An√°lise Comparativa
                                        </button>
                                        <button class="btn btn-primary" onclick="visualizarPropostasDetalhadas('${processo.id}')">
                                            <i class="fas fa-file-invoice"></i> Ver Propostas Detalhadas
                                        </button>
                                    ` : ''}
                                    ${processo.status === 'ATIVO' ? `
                                        <button class="btn btn-secondary" onclick="finalizarProcessoLicitatorio('${processo.id}')">
                                            <i class="fas fa-stop"></i> Finalizar
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    });
    
                    container.innerHTML = html;
                };
            }
        }
    
        // Fun√ß√£o para corrigir a visualiza√ß√£o detalhada de propostas
        function corrigirVisualizacaoDetalhada() {
            if (typeof visualizarPropostasDetalhadas !== 'undefined') {
                window.visualizarPropostasDetalhadas = function(processoId) {
                    // Buscar propostas de todas as fontes
                    const propostasCompletas = SistemaLocal.carregar('propostas_completas', []);
                    const propostasFornecedores = SistemaLocal.carregar('propostas_fornecedores', []);
                    
                    // Combinar propostas
                    const todasPropostas = [];
                    
                    // Adicionar propostas completas
                    propostasCompletas.filter(p => p.processoId === processoId).forEach(p => {
                        todasPropostas.push(p);
                    });
                    
                    // Adicionar propostas do fornecedor formatadas
                    propostasFornecedores.filter(p => p.processoId === processoId).forEach(pf => {
                        if (!todasPropostas.some(p => p.id === pf.id)) {
                            todasPropostas.push(pf);
                        }
                    });
                    
                    if (todasPropostas.length === 0) {
                        alert('Nenhuma proposta encontrada para este processo!');
                        return;
                    }
    
                    // Criar modal com detalhes
                    const modal = document.createElement('div');
                    modal.className = 'modal-overlay';
                    modal.innerHTML = `
                        <div class="modal-content" style="max-width: 1200px;">
                            <div class="modal-header">
                                <h3 style="margin: 0;">Propostas Detalhadas - Processo ${processoId}</h3>
                                <button class="btn-fechar-modal" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
                            </div>
                            <div class="modal-body">
                                ${todasPropostas.map(proposta => {
                                    const dadosCompletos = proposta.dadosCompletos;
                                    const fornecedor = proposta.fornecedor || {
                                        razaoSocial: proposta.fornecedorRazaoSocial,
                                        cnpj: proposta.fornecedorCNPJ
                                    };
                                    
                                    return `
                                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                                            <h4>${fornecedor.razaoSocial}</h4>
                                            
                                            <div class="proposta-tabs" style="margin-top: 15px;">
                                                <button class="proposta-tab active" onclick="mostrarDetalheProposta('${proposta.id}', 'tecnica', this)">Proposta T√©cnica</button>
                                                <button class="proposta-tab" onclick="mostrarDetalheProposta('${proposta.id}', 'comercial', this)">Proposta Comercial</button>
                                            </div>
                                            
                                            <div id="detalhe-${proposta.id}-tecnica" class="proposta-section active">
                                                <h5>Dados T√©cnicos</h5>
                                                ${dadosCompletos && dadosCompletos.propostaTecnica ? `
                                                    <p><strong>Experi√™ncia:</strong> ${dadosCompletos.propostaTecnica.experiencia || 'N/A'}</p>
                                                    <p><strong>Equipe T√©cnica:</strong> ${dadosCompletos.propostaTecnica.equipeTecnica || 'N/A'}</p>
                                                    <p><strong>Metodologia:</strong> ${dadosCompletos.propostaTecnica.metodologia || 'N/A'}</p>
                                                    <p><strong>Prazo:</strong> ${dadosCompletos.propostaTecnica.prazoExecucao || proposta.prazoExecucao || 'N/A'}</p>
                                                ` : `
                                                    <p><strong>Prazo:</strong> ${proposta.prazoExecucao || 'N/A'}</p>
                                                    <p><strong>Descri√ß√£o T√©cnica:</strong> ${proposta.descricao_tecnica || 'N/A'}</p>
                                                `}
                                            </div>
                                            
                                            <div id="detalhe-${proposta.id}-comercial" class="proposta-section" style="display: none;">
                                                <h5>Dados Comerciais</h5>
                                                ${dadosCompletos && dadosCompletos.propostaComercial ? `
                                                    <p><strong>Valor Servi√ßos:</strong> R$ ${parseFloat(dadosCompletos.propostaComercial.valorServicos || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                                    <p><strong>Valor Materiais:</strong> R$ ${parseFloat(dadosCompletos.propostaComercial.valorMateriais || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                                    <p><strong>BDI:</strong> ${dadosCompletos.propostaComercial.bdi || 0}%</p>
                                                    <p><strong>Valor Total:</strong> R$ ${parseFloat(dadosCompletos.propostaComercial.valorTotal || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                                    <p><strong>Condi√ß√µes de Pagamento:</strong> ${dadosCompletos.propostaComercial.condicoesPagamento || 'N/A'}</p>
                                                ` : `
                                                    <p><strong>Valor Total:</strong> R$ ${parseFloat(proposta.valor || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                                                    <p><strong>Condi√ß√µes de Pagamento:</strong> ${proposta.condicoesPagamento || 'N/A'}</p>
                                                `}
                                            </div>
                                            
                                            <div style="margin-top: 15px;">
                                                <button class="btn btn-info" onclick="enviarPropostaTecnicaRequisitante('${proposta.id}')">
                                                    <i class="fas fa-share"></i> Enviar ao Requisitante (T√©cnica)
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary btn-fechar-modal">Fechar</button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // Event listeners
                    modal.querySelectorAll('.btn-fechar-modal').forEach(btn => {
                        btn.addEventListener('click', () => modal.remove());
                    });
                    
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) modal.remove();
                    });
                };
            }
        }
    
            // Fun√ß√£o para corrigir o envio ao requisitante
        function corrigirEnvioRequisitante() {
            if (typeof enviarPropostaTecnicaRequisitante !== 'undefined') {
                window.enviarPropostaTecnicaRequisitante = function(propostaId) {
                    // Buscar proposta de todas as fontes
                    let proposta = null;
                    const propostasCompletas = SistemaLocal.carregar('propostas_completas', []);
                    const propostasFornecedores = SistemaLocal.carregar('propostas_fornecedores', []);
                    
                    // Procurar primeiro nas propostas completas
                    proposta = propostasCompletas.find(p => p.id === propostaId);
                    
                    // Se n√£o encontrar, procurar nas propostas dos fornecedores
                    if (!proposta) {
                        proposta = propostasFornecedores.find(p => p.id === propostaId);
                    }
                    
                    if (!proposta) {
                        alert('Proposta n√£o encontrada!');
                        return;
                    }
    
                    // Preparar dados t√©cnicos SEM valores comerciais
                    const dadosTecnicos = {
                        id: SistemaLocal.gerarId(),
                        propostaId: proposta.id,
                        processoId: proposta.processoId,
                        fornecedor: proposta.fornecedor || {
                            razaoSocial: proposta.fornecedorRazaoSocial,
                            cnpj: proposta.fornecedorCNPJ,
                            id: proposta.fornecedorId
                        },
                        propostaTecnica: proposta.dadosCompletos?.propostaTecnica || {
                            prazoExecucao: proposta.prazoExecucao,
                            metodologia: proposta.descricao_tecnica || 'N√£o informado',
                            experiencia: 'Conforme proposta t√©cnica',
                            equipeTecnica: 'Conforme proposta t√©cnica'
                        },
                        dataEnvio: new Date().toISOString(),
                        enviadoPor: SistemaLocal.obterUsuario().nome,
                        status: 'AGUARDANDO_ANALISE',
                        parecerRequisitante: null
                    };
    
                    // Salvar para an√°lise do requisitante
                    const analisesRequisitante = SistemaLocal.carregar('analise_tecnica_requisitante', []);
                    analisesRequisitante.push(dadosTecnicos);
                    SistemaLocal.salvar('analise_tecnica_requisitante', analisesRequisitante);
    
                    alert(`Proposta t√©cnica de ${dadosTecnicos.fornecedor.razaoSocial} enviada para an√°lise do requisitante!\n\nATEN√á√ÉO: Apenas os dados t√©cnicos foram enviados, sem valores comerciais.`);
                };
            }
        }
    
        // Fun√ß√£o para corrigir an√°lise comparativa
        function corrigirAnaliseComparativa() {
            if (typeof carregarAnaliseComparativa !== 'undefined') {
                const carregarAnaliseComparativaOriginal = carregarAnaliseComparativa;
                
                window.carregarAnaliseComparativa = function() {
                    const processos = SistemaLocal.carregar(SistemaLocal.CHAVES.PROCESSOS, []);
                    const propostasCompletas = SistemaLocal.carregar('propostas_completas', []);
                    const propostasFornecedores = SistemaLocal.carregar('propostas_fornecedores', []);
                    
                    // Combinar todas as propostas
                    const todasPropostas = [];
                    
                    // Adicionar propostas completas
                    propostasCompletas.forEach(p => {
                        todasPropostas.push(p);
                    });
                    
                    // Adicionar propostas dos fornecedores formatadas
                    propostasFornecedores.forEach(pf => {
                        if (!todasPropostas.some(p => p.id === pf.id)) {
                            const propostaFormatada = {
                                id: pf.id,
                                processoId: pf.processoId,
                                fornecedor: {
                                    id: pf.fornecedorId,
                                    razaoSocial: pf.fornecedorRazaoSocial,
                                    cnpj: pf.fornecedorCNPJ
                                },
                                propostaComercial: {
                                    valorTotal: pf.valor,
                                    valorServicos: pf.valor * 0.7,
                                    valorMateriais: pf.valor * 0.3,
                                    bdi: 25,
                                    condicoesPagamento: pf.condicoesPagamento || '30 dias'
                                },
                                propostaTecnica: {
                                    prazoExecucao: pf.prazoExecucao,
                                    experiencia: pf.experiencia || 'Conforme documenta√ß√£o',
                                    equipeTecnica: pf.equipeTecnica || 'Equipe qualificada',
                                    metodologia: pf.descricao_tecnica || 'Conforme especifica√ß√µes'
                                },
                                dataEnvio: pf.dataEnvio,
                                dadosCompletos: pf.dadosCompletos
                            };
                            todasPropostas.push(propostaFormatada);
                        }
                    });
                    
                    const container = document.getElementById('analise-content');
                    
                    // Se foi selecionado um processo espec√≠fico
                    const processoSelecionadoId = sessionStorage.getItem('processoAnalise');
                    
                    if (processoSelecionadoId) {
                        const processoEspecifico = processos.find(p => p.id === processoSelecionadoId);
                        const propostasDoProcesso = todasPropostas.filter(p => p.processoId === processoSelecionadoId);
                        
                        if (propostasDoProcesso.length === 0) {
                            container.innerHTML = `
                                <div style="text-align: center; padding: 40px; color: #666;">
                                    <i class="fas fa-info-circle" style="font-size: 64px; margin-bottom: 20px; opacity: 0.5;"></i>
                                    <h3>Nenhuma proposta recebida para este processo</h3>
                                    <p>Aguarde os fornecedores enviarem suas propostas.</p>
                                    <button class="btn btn-primary" onclick="mostrarPagina('processos')">
                                        <i class="fas fa-arrow-left"></i> Voltar aos Processos
                                    </button>
                                </div>
                            `;
                            return;
                        }
                        
                        let html = `<h3 style="margin-bottom: 20px;">An√°lise do Processo: ${processoEspecifico.numeroProcesso}</h3>`;
                        html += '<div class="proposta-tabs">';
                        html += '<button class="proposta-tab active" onclick="mostrarAba(\'tecnica\')">An√°lise T√©cnica</button>';
                        html += '<button class="proposta-tab" onclick="mostrarAba(\'comercial\')">An√°lise Comercial</button>';
                        html += '<button class="proposta-tab" onclick="mostrarAba(\'geral\')">An√°lise Geral</button>';
                        html += '</div>';
    
                        html += '<div id="tecnica" class="proposta-section active">';
                        html += renderizarAnaliseTecnica([processoEspecifico], propostasDoProcesso);
                        html += '</div>';
    
                        html += '<div id="comercial" class="proposta-section">';
                        html += renderizarAnaliseComercial([processoEspecifico], propostasDoProcesso);
                        html += '</div>';
    
                        html += '<div id="geral" class="proposta-section">';
                        html += renderizarAnaliseGeral([processoEspecifico], propostasDoProcesso);
                        html += '</div>';
    
                        container.innerHTML = html;
                        
                        // Limpar sele√ß√£o
                        sessionStorage.removeItem('processoAnalise');
                        
                    } else {
                        // An√°lise geral de todos os processos
                        if (processos.length === 0) {
                            container.innerHTML = `
                                <div style="text-align: center; padding: 40px; color: #666;">
                                    <i class="fas fa-info-circle" style="font-size: 64px; margin-bottom: 20px; opacity: 0.5;"></i>
                                    <h3>Nenhum processo dispon√≠vel</h3>
                                    <p>Crie um processo para realizar an√°lises comparativas.</p>
                                </div>
                            `;
                            return;
                        }
    
                        let html = '<div class="proposta-tabs">';
                        html += '<button class="proposta-tab active" onclick="mostrarAba(\'tecnica\')">An√°lise T√©cnica</button>';
                        html += '<button class="proposta-tab" onclick="mostrarAba(\'comercial\')">An√°lise Comercial</button>';
                        html += '<button class="proposta-tab" onclick="mostrarAba(\'geral\')">An√°lise Geral</button>';
                        html += '</div>';
    
                        html += '<div id="tecnica" class="proposta-section active">';
                        html += renderizarAnaliseTecnica(processos, todasPropostas);
                        html += '</div>';
    
                        html += '<div id="comercial" class="proposta-section">';
                        html += renderizarAnaliseComercial(processos, todasPropostas);
                        html += '</div>';
    
                        html += '<div id="geral" class="proposta-section">';
                        html += renderizarAnaliseGeral(processos, todasPropostas);
                        html += '</div>';
    
                        container.innerHTML = html;
                    }
                };
            }
        }
    
        // Aplicar corre√ß√µes quando o documento carregar
        document.addEventListener('DOMContentLoaded', function() {
            // Aguardar um momento para garantir que o c√≥digo original carregou
            setTimeout(() => {
                console.log('Aplicando corre√ß√µes no m√≥dulo Comprador...');
                corrigirBuscaPropostas();
                corrigirVisualizacaoDetalhada();
                corrigirEnvioRequisitante();
                corrigirAnaliseComparativa();
                console.log('Corre√ß√µes aplicadas com sucesso!');
                
                // Recarregar dados se estivermos na p√°gina correta
                if (typeof mostrarPagina !== 'undefined' && document.getElementById('processos-list')) {
                    carregarProcessos();
                }
            }, 1000);
        });
    
        // Fun√ß√£o auxiliar para mostrar detalhe da proposta
        window.mostrarDetalheProposta = function(propostaId, tipo, elemento) {
            document.querySelectorAll(`[id^="detalhe-${propostaId}-"]`).forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById(`detalhe-${propostaId}-${tipo}`).style.display = 'block';
            
            // Atualizar tabs
            if (elemento) {
                elemento.parentElement.querySelectorAll('.proposta-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                elemento.classList.add('active');
            }
        };
            <!-- Integra√ß√£o com Azure AI para An√°lise Inteligente -->
    <script>
        // Configura√ß√£o do Azure AI
        const AzureAI = {
            // Substitua com suas credenciais reais do Azure
            endpoint: 'https://seu-recurso.cognitiveservices.azure.com/',
            apiKey: 'SUA_CHAVE_API_AQUI',
            
            // Fun√ß√£o para an√°lise inteligente de propostas
            analisarPropostasIA: async function(propostas) {
                try {
                    // Simula√ß√£o de an√°lise AI (substitua com chamada real √† API do Azure)
                    const analise = {
                        melhorValor: this.encontrarMelhorValor(propostas),
                        melhorPrazo: this.encontrarMelhorPrazo(propostas),
                        melhorTecnica: this.analisarQualidadeTecnica(propostas),
                        riscos: this.identificarRiscos(propostas),
                        recomendacao: this.gerarRecomendacao(propostas)
                    };
                    
                    return analise;
                } catch (error) {
                    console.error('Erro na an√°lise AI:', error);
                    return null;
                }
            },
            
            encontrarMelhorValor: function(propostas) {
                return propostas.reduce((melhor, atual) => {
                    const valorAtual = parseFloat(atual.propostaComercial?.valorTotal || atual.valor || 0);
                    const valorMelhor = parseFloat(melhor.propostaComercial?.valorTotal || melhor.valor || 0);
                    return valorAtual < valorMelhor ? atual : melhor;
                });
            },
            
            encontrarMelhorPrazo: function(propostas) {
                return propostas.reduce((melhor, atual) => {
                    const prazoAtual = parseInt(atual.propostaTecnica?.prazoExecucao || atual.prazoExecucao || '999');
                    const prazoMelhor = parseInt(melhor.propostaTecnica?.prazoExecucao || melhor.prazoExecucao || '999');
                    return prazoAtual < prazoMelhor ? atual : melhor;
                });
            },
            
            analisarQualidadeTecnica: function(propostas) {
                // An√°lise simplificada - implementar l√≥gica mais complexa com Azure AI
                return propostas.map(p => ({
                    fornecedor: p.fornecedor?.razaoSocial || p.fornecedorRazaoSocial,
                    pontuacao: Math.random() * 100, // Substituir com an√°lise real
                    criterios: {
                        experiencia: Math.random() * 100,
                        metodologia: Math.random() * 100,
                        equipe: Math.random() * 100
                    }
                }));
            },
            
            identificarRiscos: function(propostas) {
                // An√°lise de riscos simplificada
                const riscos = [];
                
                propostas.forEach(p => {
                    const valor = parseFloat(p.propostaComercial?.valorTotal || p.valor || 0);
                    const prazo = parseInt(p.propostaTecnica?.prazoExecucao || p.prazoExecucao || '0');
                    
                    // Identificar propostas suspeitas
                    if (valor < 1000) {
                        riscos.push({
                            fornecedor: p.fornecedor?.razaoSocial || p.fornecedorRazaoSocial,
                            tipo: 'VALOR_MUITO_BAIXO',
                            descricao: 'Valor proposto pode indicar inexequibilidade'
                        });
                    }
                    
                    if (prazo < 10) {
                        riscos.push({
                            fornecedor: p.fornecedor?.razaoSocial || p.fornecedorRazaoSocial,
                            tipo: 'PRAZO_MUITO_CURTO',
                            descricao: 'Prazo pode ser insuficiente para execu√ß√£o adequada'
                        });
                    }
                });
                
                return riscos;
            },
            
            gerarRecomendacao: function(propostas) {
                const melhorValor = this.encontrarMelhorValor(propostas);
                const melhorPrazo = this.encontrarMelhorPrazo(propostas);
                const qualidadeTecnica = this.analisarQualidadeTecnica(propostas);
                
                // Encontrar melhor pontua√ß√£o t√©cnica
                const melhorTecnica = qualidadeTecnica.reduce((melhor, atual) => 
                    atual.pontuacao > melhor.pontuacao ? atual : melhor
                );
                
                return {
                    fornecedorRecomendado: melhorTecnica.fornecedor,
                    justificativa: `Baseado na an√°lise integrada de crit√©rios t√©cnicos e comerciais, 
                                   considerando qualidade t√©cnica, valor e prazo de execu√ß√£o.`,
                    pontuacaoFinal: melhorTecnica.pontuacao
                };
            }
        };
    
        // Adicionar bot√£o de an√°lise AI nos processos
        function adicionarBotaoAnaliseIA() {
            const processosComPropostas = document.querySelectorAll('.tr-item');
            
            processosComPropostas.forEach(processo => {
                const botoesContainer = processo.querySelector('div[style*="margin-top: 15px"]');
                if (botoesContainer && !botoesContainer.querySelector('.btn-ai-analysis')) {
                    const btnAI = document.createElement('button');
                    btnAI.className = 'btn btn-warning btn-ai-analysis';
                    btnAI.innerHTML = '<i class="fas fa-brain"></i> An√°lise IA';
                    btnAI.onclick = function() {
                        const processoId = processo.querySelector('[onclick*="visualizarProcesso"]')
                            ?.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                        if (processoId) executarAnaliseIA(processoId);
                    };
                    botoesContainer.appendChild(btnAI);
                }
            });
        }
    
        // Executar an√°lise AI
        async function executarAnaliseIA(processoId) {
            // Buscar propostas
            const propostasCompletas = SistemaLocal.carregar('propostas_completas', []);
            const propostasFornecedores = SistemaLocal.carregar('propostas_fornecedores', []);
            
            const todasPropostas = [
                ...propostasCompletas.filter(p => p.processoId === processoId),
                ...propostasFornecedores.filter(p => p.processoId === processoId)
            ];
            
            if (todasPropostas.length === 0) {
                alert('Nenhuma proposta encontrada para an√°lise.');
                return;
            }
            
            // Mostrar loading
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3><i class="fas fa-brain"></i> An√°lise Inteligente com Azure AI</h3>
                        <button class="btn-fechar-modal" onclick="this.closest('.modal-overlay').remove()">&times;</button>
                    </div>
                    <div class="modal-body" style="text-align: center; padding: 40px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 48px; color: #007bff; margin-bottom: 20px;"></i>
                        <p>Analisando propostas com intelig√™ncia artificial...</p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Executar an√°lise
            const resultado = await AzureAI.analisarPropostasIA(todasPropostas);
            
            // Mostrar resultados
            if (resultado) {
                // Construir HTML principal com recomenda√ß√£o, comparativo e riscos
                let html = `
                    <div style="text-align: left;">
                        <h4>Resultado da An√°lise AI</h4>
                        <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h5><i class="fas fa-trophy"></i> Recomenda√ß√£o</h5>
                            <p><strong>Fornecedor Recomendado:</strong> ${resultado.recomendacao.fornecedorRecomendado}</p>
                            <p><strong>Pontua√ß√£o:</strong> ${resultado.recomendacao.pontuacaoFinal.toFixed(2)}/100</p>
                            <p><strong>Justificativa:</strong> ${resultado.recomendacao.justificativa}</p>
                        </div>
                        <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h5><i class="fas fa-chart-line"></i> An√°lise Comparativa</h5>
                            <p><strong>Melhor Valor:</strong> ${resultado.melhorValor.fornecedor?.razaoSocial || resultado.melhorValor.fornecedorRazaoSocial}</p>
                            <p><strong>Melhor Prazo:</strong> ${resultado.melhorPrazo.fornecedor?.razaoSocial || resultado.melhorPrazo.fornecedorRazaoSocial}</p>
                        </div>
                `;
                // Adicionar riscos, se existirem
                if (resultado.riscos.length > 0) {
                    html += `
                        <div style="background: #ffebee; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h5><i class="fas fa-exclamation-triangle"></i> Riscos Identificados</h5>
                            ${resultado.riscos.map(r => `<p><strong>${r.fornecedor}:</strong> ${r.descricao}</p>`).join('')}
                        </div>
                    `;
                }
                // Bot√µes de a√ß√£o
                html += `
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-success" id="btn-enviar-comparativo">
                            <i class="fas fa-share"></i> Enviar An√°lise ao Requisitante
                        </button>
                        <button class="btn btn-primary" id="btn-fechar-analise" style="margin-left: 10px;">
                            Fechar An√°lise
                        </button>
                    </div>
                </div>`;
                // Aplicar ao modal
                const body = modal.querySelector('.modal-body');
                body.innerHTML = html;
                // Adicionar listeners aos bot√µes
                const enviarBtn = body.querySelector('#btn-enviar-comparativo');
                const fecharBtn = body.querySelector('#btn-fechar-analise');
                if (enviarBtn) {
                    enviarBtn.addEventListener('click', () => {
                        try {
                            enviarComparativoParaRequisitante(resultado, processoId);
                            alert('An√°lise comparativa enviada ao requisitante para parecer!');
                            modal.remove();
                        } catch (err) {
                            console.error(err);
                            alert('Erro ao enviar a an√°lise ao requisitante. Consulte o console.');
                        }
                    });
                }
                if (fecharBtn) {
                    fecharBtn.addEventListener('click', () => {
                        modal.remove();
                    });
                }
            }
        }

        /**
         * Envia o resultado de uma an√°lise comparativa para o m√≥dulo Requisitante.
         * Este m√©todo cria um objeto simplificado contendo os dados da an√°lise e
         * o armazena em "propostas_para_requisitante" no localStorage, al√©m de
         * gerar uma notifica√ß√£o para o requisitante. A fun√ß√£o n√£o altera
         * propostas existentes; ela substitui an√°lises anteriores do mesmo
         * processo.
         *
         * @param {Object} resultadoAnalise - Objeto retornado por AzureAI.analisarPropostasIA
         * @param {string} processoId - Identificador do processo analisado
         */
        function enviarComparativoParaRequisitante(resultadoAnalise, processoId) {
            if (!resultadoAnalise || !processoId) return;
            // Determinar t√≠tulo do processo a partir do localStorage
            let processoTitulo = '';
            try {
                const processosCompra = JSON.parse(localStorage.getItem('processos_compra') || '[]');
                const processo = processosCompra.find(p => p.id == processoId);
                if (processo) {
                    // usar objeto ou n√∫mero do processo como t√≠tulo
                    processoTitulo = processo.objeto || processo.numeroProcesso || `Processo ${processoId}`;
                } else {
                    processoTitulo = `Processo ${processoId}`;
                }
            } catch (e) {
                processoTitulo = `Processo ${processoId}`;
            }
            // Determinar comprador respons√°vel
            let compradorResponsavel = '';
            try {
                const comprador = JSON.parse(localStorage.getItem('comprador_logado') || '{}');
                compradorResponsavel = comprador.nome || comprador.email || '';
            } catch (e) {
                compradorResponsavel = '';
            }
            // Construir objeto a ser enviado
            const propostaAnalise = {
                id: Date.now(),
                processo_id: processoId,
                processo_titulo: processoTitulo,
                fornecedor_cnpj: '',
                prazo: '',
                data_envio_requisitante: new Date().toLocaleDateString('pt-BR'),
                comprador_responsavel: compradorResponsavel,
                descricao_tecnica: resultadoAnalise.recomendacao.justificativa || '',
                parecer_comprador: `Fornecedor recomendado: ${resultadoAnalise.recomendacao.fornecedorRecomendado}. Pontua√ß√£o: ${resultadoAnalise.recomendacao.pontuacaoFinal.toFixed(2)}/100`,
                status: 'PENDENTE_PARECER',
                analise_comparativa: resultadoAnalise
            };
            // Carregar propostas existentes e remover an√°lises anteriores deste processo
            let propostas = [];
            try {
                propostas = JSON.parse(localStorage.getItem('propostas_para_requisitante') || '[]');
            } catch (e) {
                propostas = [];
            }
            const propostasAtualizadas = propostas.filter(p => !(p.processo_id == processoId && p.analise_comparativa));
            propostasAtualizadas.push(propostaAnalise);
            localStorage.setItem('propostas_para_requisitante', JSON.stringify(propostasAtualizadas));
            // Criar notifica√ß√£o para o requisitante
            let notificacoes = [];
            try {
                notificacoes = JSON.parse(localStorage.getItem('notificacoes_requisitante') || '[]');
            } catch (e) {
                notificacoes = [];
            }
            notificacoes.push({
                id: Date.now(),
                titulo: 'Nova An√°lise Comparativa',
                mensagem: `Foi enviada uma an√°lise comparativa do processo ${processoTitulo} para seu parecer.`,
                data: new Date().toLocaleDateString('pt-BR'),
                lida: false
            });
            localStorage.setItem('notificacoes_requisitante', JSON.stringify(notificacoes));
        }
    
        // Adicionar bot√µes AI quando carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                adicionarBotaoAnaliseIA();
                
                // Observar mudan√ßas no DOM para adicionar bot√µes em novos elementos
                const observer = new MutationObserver(() => {
                    adicionarBotaoAnaliseIA();
                });
                
                const targetNode = document.getElementById('processos-list');
                if (targetNode) {
                    observer.observe(targetNode, { childList: true, subtree: true });
                }
            }, 2000);
        });
    </script>

    <script type="module" src="/static/firebase.js"></script>
    <script type="module" src="/static/js/auth.js"></script>

<script type="module" src="/static/js/firebase.js"></script>
<script type="module" src="/static/js/realtime-sync.js"></script>
</body>
</html>

