<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Requisitante - Sistema de Propostas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.95em;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-info {
            background: #3498db;
            color: white;
        }
        
        .btn-sm {
            padding: 5px 15px;
            font-size: 13px;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #5a6c7d;
            border-bottom: 2px solid #e9ecef;
        }
        
        .table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-rascunho {
            background: #e9ecef;
            color: #6c757d;
        }
        
        .status-enviado {
            background: #d4edda;
            color: #155724;
        }
        
        .status-analise {
            background: #fff3cd;
            color: #856404;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            border-radius: 10px;
            padding: 30px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close {
            font-size: 28px;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
        }
        
        .actions-cell {
            display: flex;
            gap: 5px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .search-box {
            position: relative;
            width: 300px;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
        }
        
        .search-box i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div>
                <h1>Dashboard Requisitante</h1>
                <p>Sistema de Gest√£o de Propostas</p>
            </div>
            <div class="user-info">
                <span>üë§ Ol√°, <strong id="nomeUsuario">Requisitante</strong></span>
                <button class="btn btn-sm" style="background: rgba(255,255,255,0.2); color: white;" onclick="logout()">
                    Sair
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="alertContainer"></div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalTRs">0</div>
                <div class="stat-label">Total de TRs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="trsRascunho">0</div>
                <div class="stat-label">Em Rascunho</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="trsEnviados">0</div>
                <div class="stat-label">Enviados</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="trsAnalise">0</div>
                <div class="stat-label">Em An√°lise</div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>üìã Meus Termos de Refer√™ncia</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <div class="search-box">
                        <input type="text" id="pesquisaTR" placeholder="Pesquisar TR..." onkeyup="pesquisarTRs()">
                        <i>üîç</i>
                    </div>
                    <button class="btn btn-primary" onclick="novoTR()">
                        ‚ûï Novo TR
                    </button>
                </div>
            </div>

            <table class="table">
                <thead>
                    <tr>
                        <th>N√∫mero</th>
                        <th>Objeto</th>
                        <th>Modalidade</th>
                        <th>Valor Estimado</th>
                        <th>Status</th>
                        <th>Data Cria√ß√£o</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="tabelaTRs">
                    <tr>
                        <td colspan="7" style="text-align: center; color: #7f8c8d;">
                            Nenhum Termo de Refer√™ncia cadastrado
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal Editar TR -->
    <div id="modalEditarTR" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Editar Termo de Refer√™ncia</h2>
                <span class="close" onclick="fecharModal('modalEditarTR')">&times;</span>
            </div>
            
            <form id="formEditarTR">
                <input type="hidden" id="editTrId">
                
                <div class="form-group">
                    <label>N√∫mero do TR:</label>
                    <input type="text" id="editNumero" readonly>
                </div>
                
                <div class="form-group">
                    <label>Objeto:*</label>
                    <textarea id="editObjeto" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Modalidade:*</label>
                    <select id="editModalidade" required>
                        <option value="">Selecione...</option>
                        <option value="Preg√£o Eletr√¥nico">Preg√£o Eletr√¥nico</option>
                        <option value="Preg√£o Presencial">Preg√£o Presencial</option>
                        <option value="Concorr√™ncia">Concorr√™ncia</option>
                        <option value="Tomada de Pre√ßos">Tomada de Pre√ßos</option>
                        <option value="Convite">Convite</option>
                        <option value="Concurso">Concurso</option>
                        <option value="Leil√£o">Leil√£o</option>
                        <option value="Dispensa de Licita√ß√£o">Dispensa de Licita√ß√£o</option>
                        <option value="Inexigibilidade">Inexigibilidade</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Valor Estimado:*</label>
                    <input type="text" id="editValorEstimado" required onkeyup="formatarMoeda(this)">
                </div>
                
                <div class="form-group">
                    <label>Justificativa:*</label>
                    <textarea id="editJustificativa" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Prazo de Execu√ß√£o:*</label>
                    <input type="text" id="editPrazoExecucao" required>
                </div>
                
                <div class="form-group">
                    <label>Local de Execu√ß√£o:*</label>
                    <input type="text" id="editLocalExecucao" required>
                </div>
                
                <div class="form-group">
                    <label>Observa√ß√µes:</label>
                    <textarea id="editObservacoes"></textarea>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">
                        üíæ Salvar Altera√ß√µes
                    </button>
                    <button type="button" class="btn btn-sm" style="background: #6c757d; color: white;" onclick="fecharModal('modalEditarTR')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Dados mockados para exemplo
        let termosReferencia = [
            {
                id: 'TR001',
                numero: 'TR-2025-001',
                objeto: 'Contrata√ß√£o de servi√ßos de desenvolvimento de software',
                modalidade: 'Preg√£o Eletr√¥nico',
                valorEstimado: 'R$ 150.000,00',
                status: 'enviado',
                dataCriacao: '2025-01-10',
                justificativa: 'Necessidade de moderniza√ß√£o dos sistemas',
                prazoExecucao: '6 meses',
                localExecucao: 'Sede da empresa',
                observacoes: 'Projeto priorit√°rio'
            },
            {
                id: 'TR002',
                numero: 'TR-2025-002',
                objeto: 'Aquisi√ß√£o de equipamentos de inform√°tica',
                modalidade: 'Preg√£o Eletr√¥nico',
                valorEstimado: 'R$ 80.000,00',
                status: 'rascunho',
                dataCriacao: '2025-01-15',
                justificativa: 'Renova√ß√£o do parque tecnol√≥gico',
                prazoExecucao: '30 dias',
                localExecucao: 'Almoxarifado central',
                observacoes: ''
            }
        ];

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            carregarDashboard();
            carregarTRs();
            
            // Configurar formul√°rio de edi√ß√£o
            document.getElementById('formEditarTR').addEventListener('submit', salvarEdicaoTR);
        });

        function carregarDashboard() {
            const stats = {
                total: termosReferencia.length,
                rascunho: termosReferencia.filter(tr => tr.status === 'rascunho').length,
                enviado: termosReferencia.filter(tr => tr.status === 'enviado').length,
                analise: termosReferencia.filter(tr => tr.status === 'analise').length
            };

            document.getElementById('totalTRs').textContent = stats.total;
            document.getElementById('trsRascunho').textContent = stats.rascunho;
            document.getElementById('trsEnviados').textContent = stats.enviado;
            document.getElementById('trsAnalise').textContent = stats.analise;
        }

        function carregarTRs() {
            const tbody = document.getElementById('tabelaTRs');
            
            if (termosReferencia.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; color: #7f8c8d;">
                            Nenhum Termo de Refer√™ncia cadastrado
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = termosReferencia.map(tr => `
                <tr>
                    <td>${tr.numero}</td>
                    <td>${tr.objeto}</td>
                    <td>${tr.modalidade}</td>
                    <td>${tr.valorEstimado}</td>
                    <td>
                        <span class="status-badge status-${tr.status}">
                            ${getStatusLabel(tr.status)}
                        </span>
                    </td>
                    <td>${formatarData(tr.dataCriacao)}</td>
                    <td class="actions-cell">
                        <button class="btn btn-info btn-sm" onclick="visualizarTR('${tr.id}')">
                            üëÅÔ∏è Ver
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="editarTR('${tr.id}')">
                            ‚úèÔ∏è Editar
                        </button>
                        <button class="btn btn-success btn-sm" onclick="baixarTR('${tr.id}')">
                            üì• Word
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="excluirTR('${tr.id}')">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusLabel(status) {
            const labels = {
                rascunho: 'Rascunho',
                enviado: 'Enviado',
                analise: 'Em An√°lise',
                aprovado: 'Aprovado',
                rejeitado: 'Rejeitado'
            };
            return labels[status] || status;
        }

        function formatarData(data) {
            return new Date(data).toLocaleDateString('pt-BR');
        }

        function novoTR() {
            window.location.href = 'modulo-termo-referencia-seguro.html';
        }

        function visualizarTR(id) {
            const tr = termosReferencia.find(t => t.id === id);
            if (tr) {
                // Criar modal de visualiza√ß√£o
                mostrarAlert('info', `Visualizando TR: ${tr.numero}`);
                // Aqui voc√™ pode implementar um modal de visualiza√ß√£o completo
            }
        }

        function editarTR(id) {
            const tr = termosReferencia.find(t => t.id === id);
            if (!tr) return;

            // Preencher formul√°rio
            document.getElementById('editTrId').value = tr.id;
            document.getElementById('editNumero').value = tr.numero;
            document.getElementById('editObjeto').value = tr.objeto;
            document.getElementById('editModalidade').value = tr.modalidade;
            document.getElementById('editValorEstimado').value = tr.valorEstimado;
            document.getElementById('editJustificativa').value = tr.justificativa;
            document.getElementById('editPrazoExecucao').value = tr.prazoExecucao;
            document.getElementById('editLocalExecucao').value = tr.localExecucao;
            document.getElementById('editObservacoes').value = tr.observacoes || '';

            // Abrir modal
            document.getElementById('modalEditarTR').style.display = 'block';
        }

        function salvarEdicaoTR(e) {
            e.preventDefault();
            
            const id = document.getElementById('editTrId').value;
            const trIndex = termosReferencia.findIndex(t => t.id === id);
            
            if (trIndex === -1) return;

            // Atualizar dados
            termosReferencia[trIndex] = {
                ...termosReferencia[trIndex],
                objeto: document.getElementById('editObjeto').value,
                modalidade: document.getElementById('editModalidade').value,
                valorEstimado: document.getElementById('editValorEstimado').value,
                justificativa: document.getElementById('editJustificativa').value,
                prazoExecucao: document.getElementById('editPrazoExecucao').value,
                localExecucao: document.getElementById('editLocalExecucao').value,
                observacoes: document.getElementById('editObservacoes').value
            };

            // Fechar modal e recarregar
            fecharModal('modalEditarTR');
            carregarTRs();
            carregarDashboard();
            mostrarAlert('success', 'Termo de Refer√™ncia atualizado com sucesso!');
        }

        function baixarTR(id) {
            const tr = termosReferencia.find(t => t.id === id);
            if (!tr) return;

            // Simular download
            mostrarAlert('success', `Baixando TR ${tr.numero} em formato Word...`);
            
            // Aqui voc√™ implementaria a gera√ß√£o real do documento Word
            // usando a API backend
        }

        function excluirTR(id) {
            if (!confirm('Tem certeza que deseja excluir este Termo de Refer√™ncia?')) return;

            const index = termosReferencia.findIndex(t => t.id === id);
            if (index !== -1) {
                const tr = termosReferencia[index];
                termosReferencia.splice(index, 1);
                carregarTRs();
                carregarDashboard();
                mostrarAlert('success', `TR ${tr.numero} exclu√≠do com sucesso!`);
            }
        }

        function pesquisarTRs() {
            const termo = document.getElementById('pesquisaTR').value.toLowerCase();
            const linhas = document.querySelectorAll('#tabelaTRs tr');
            
            linhas.forEach(linha => {
                const texto = linha.textContent.toLowerCase();
                linha.style.display = texto.includes(termo) ? '' : 'none';
            });
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function formatarMoeda(input) {
            let valor = input.value.replace(/\D/g, '');
            valor = (valor / 100).toFixed(2) + '';
            valor = valor.replace('.', ',');
            valor = valor.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
            input.value = 'R$ ' + valor;
        }

        function mostrarAlert(tipo, mensagem) {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${tipo}`;
            alert.textContent = mensagem;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function logout() {
            if (confirm('Deseja realmente sair?')) {
                window.location.href = 'index.html';
            }
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>
