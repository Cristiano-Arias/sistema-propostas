<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal do Fornecedor - Sistema Integrado de Licitações</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* TELA DE LOGIN MODERNIZADA */
        .login-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 80px 60px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15), 0 10px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .login-container:hover {
            transform: translateY(-5px);
        }

        .logo {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 40px;
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .logo i {
            color: white;
            font-size: 60px;
        }

        .login-container h1 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 42px;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .login-container p {
            color: #718096;
            margin-bottom: 50px;
            font-size: 18px;
            font-weight: 400;
        }

        .form-group {
            margin-bottom: 30px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            color: #4a5568;
            font-weight: 600;
            font-size: 16px;
            letter-spacing: 0.3px;
        }

        .form-group label .required {
            color: #e53e3e;
            margin-left: 3px;
        }

        .form-group input {
            width: 100%;
            padding: 20px 24px;
            border: 2px solid transparent;
            background: #f7fafc;
            border-radius: 15px;
            font-size: 18px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-group input.error {
            border-color: #e53e3e;
        }

        .error-text {
            color: #e53e3e;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .login-btn {
            width: 100%;
            padding: 22px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .login-info {
            margin-top: 40px;
            padding: 25px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 20px;
            font-size: 16px;
            color: #718096;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        /* ALERTAS E NOTIFICAÇÕES */
        .alert {
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            display: none;
            font-weight: 500;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-error {
            background: #fff5f5;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .alert-success {
            background: #f0fdf4;
            color: #276749;
            border: 1px solid #9ae6b4;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fffaf0 0%, #fff5e6 100%);
            color: #744210;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid #feb2b2;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-warning i {
            color: #f6ad55;
            font-size: 20px;
        }

        .alert-info {
            background: #ebf8ff;
            color: #2b6cb0;
            border: 1px solid #90cdf4;
        }

        /* ====================== INÍCIO DAS MUDANÇAS FLEXBOX ====================== */
        
        /* DASHBOARD MODERNIZADO - ATUALIZADO PARA FLEXBOX */
        .dashboard-container {
            display: flex;                    /* MUDANÇA: de "display: none" para "display: flex" */
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 100%;                      /* ADICIONADO: garante largura total */
            position: relative;               /* ADICIONADO: para contexto de posicionamento */
        }

        /* SIDEBAR MODERNA - ATUALIZADA PARA FLEXBOX */
        .sidebar {
            width: 240px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            padding: 0;
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.1);
            /* REMOVIDO: position: fixed; */
            /* REMOVIDO: height: 100vh; */
            /* REMOVIDO: z-index: 100; */
            min-height: 100vh;                /* ADICIONADO: altura mínima */
            flex-shrink: 0;                   /* ADICIONADO: previne que a sidebar encolha */
            overflow-y: auto;
        }

        /* ====================== FIM DAS MUDANÇAS DA SIDEBAR ====================== */

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 3px;
        }

        .sidebar .logo {
            padding: 30px 20px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            animation: none;
        }

        .sidebar .logo i {
            font-size: 40px;
            margin-bottom: 15px;
            display: block;
        }

        .sidebar .logo h2 {
            color: white;
            font-size: 18px;
            margin: 0 0 5px 0;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .sidebar .logo p {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
            font-weight: 400;
        }

        .nav-section {
            padding: 20px 20px 10px;
        }

        .nav-title {
            font-size: 11px;
            font-weight: 700;
            color: #a0aec0;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .nav-item {
            width: 100%;
            padding: 14px 20px;
            background: none;
            border: none;
            text-align: left;
            color: #4a5568;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            margin-bottom: 5px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            z-index: -1;
        }

        .nav-item:hover {
            background: #f7fafc;
            color: #667eea;
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .nav-item.active::before {
            width: 100%;
        }

        .nav-item i {
            font-size: 16px;
            width: 20px;
        }

        /* ====================== INÍCIO DAS MUDANÇAS MAIN-CONTENT ====================== */
        
        /* ÁREA PRINCIPAL MODERNA - ATUALIZADA PARA FLEXBOX */
        .main-content {
            /* REMOVIDO: margin-left: 240px; */
            /* REMOVIDO: width: calc(100% - 240px); */
            flex: 1;                          /* ADICIONADO: ocupa todo espaço restante */
            padding: 30px;
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            overflow-y: auto;                 /* ADICIONADO: permite scroll se necessário */
        }

        /* ====================== FIM DAS MUDANÇAS MAIN-CONTENT ====================== */

        .content-section {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .section-title i {
            font-size: 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* CARDS DE ESTATÍSTICAS MODERNOS */
        .stats-grid {
            display: flex !important;
            gap: 20px !important;
            margin-bottom: 40px !important;
        }

        .stat-card {
            flex: 1 !important;
            background: linear-gradient(135deg, #ffffff 0%, #f7fafc 100%);
            padding: 25px !important;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 36px !important;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px !important;
        }

        .stat-label {
            color: #718096;
            font-size: 14px !important;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        /* CARDS DE AÇÃO MODERNOS */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .action-card {
            background: linear-gradient(135deg, #ffffff 0%, #f7fafc 100%);
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .action-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            transform: rotate(45deg);
            transition: all 0.5s ease;
            opacity: 0;
        }

        .action-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .action-card:hover::before {
            opacity: 1;
        }

        .action-card i {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            z-index: 1;
        }

        .action-card h3 {
            color: #2d3748;
            margin-bottom: 12px;
            font-size: 20px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .action-card p {
            color: #718096;
            font-size: 14px;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        /* BOTÕES MODERNOS */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.3px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #cbd5e0 0%, #a0aec0 100%);
            color: #2d3748;
        }

        /* CARDS DE PROCESSO MODERNOS */
        .processo-item {
            background: linear-gradient(135deg, #ffffff 0%, #f7fafc 100%);
            border: none;
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .processo-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .processo-item:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
        }

        .processo-status {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 25px;
            letter-spacing: 0.5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .status-ativo {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
        }

        .status-vencido {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
        }

        .status-enviada {
            background: linear-gradient(135deg, #cce5ff 0%, #b8daff 100%);
            color: #004085;
        }

        .status-aceita {
            background: linear-gradient(135deg, #d1ecf1 0%, #b8e0d2 100%);
            color: #0c5460;
        }

        .status-rejeitada {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
        }

        .processo-item h3 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #2d3748;
            font-weight: 700;
        }

        .processo-item p {
            font-size: 16px;
            margin-bottom: 12px;
            color: #4a5568;
            line-height: 1.6;
        }

        .processo-item p strong {
            color: #2d3748;
            font-weight: 600;
        }

        /* MODAIS MODERNOS */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f7fafc 100%);
            margin: 3% auto;
            padding: 50px;
            border-radius: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }

        .close {
            color: #a0aec0;
            float: right;
            font-size: 36px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.3s ease;
            line-height: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f7fafc;
        }

        .close:hover {
            color: #667eea;
            background: #edf2f7;
            transform: rotate(90deg);
        }

        /* INFORMAÇÕES DA EMPRESA MODERNAS */
        .empresa-info {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            padding: 35px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .empresa-info h3 {
            color: #2d3748;
            margin-bottom: 25px;
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .empresa-info h3 i {
            color: #667eea;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
            font-size: 16px;
        }

        .info-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .info-label {
            font-weight: 600;
            color: #718096;
        }

        .info-value {
            color: #2d3748;
            font-weight: 500;
        }

        /* FORMULÁRIOS MODERNOS */
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            background: #f7fafc;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            height: 140px;
            resize: vertical;
            font-family: inherit;
        }

        /* LOADING */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 80px;
            color: #718096;
        }

        .empty-state i {
            font-size: 80px;
            margin-bottom: 30px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 28px;
            color: #4a5568;
            margin-bottom: 15px;
        }

        .empty-state p {
            font-size: 18px;
        }

        /* FEEDBACK VISUAL */
        .feedback-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .feedback-aceito {
            background: #d4edda;
            color: #155724;
        }

        .feedback-rejeitado {
            background: #f8d7da;
            color: #721c24;
        }

        .feedback-pendente {
            background: #fff3cd;
            color: #856404;
        }

        /* TR Info Box */
        .tr-info-box {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .tr-info-box h4 {
            color: #1976d2;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }

        .tr-info-box p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        /* Proposta status */
        .proposta-status-box {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .proposta-rascunho {
            background: #f8f9fa;
            border: 2px dashed #6c757d;
        }

        .proposta-enviada {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
        }

        /* Estilos para visualização do TR - NOVO */
        .tr-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1050;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .tr-modal-content {
            background: white;
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            border-radius: 20px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }

        .tr-modal-header {
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex-shrink: 0;
            position: relative;
        }

        .tr-modal-header h2 {
            font-size: 28px;
            margin: 0;
            font-weight: 700;
        }

        .tr-modal-header p {
            margin: 5px 0 0 0;
            opacity: 0.9;
            font-size: 16px;
        }

        .tr-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .tr-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .tr-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            background: #f7fafc;
        }

        .tr-modal-body::-webkit-scrollbar {
            width: 10px;
        }

        .tr-modal-body::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .tr-modal-body::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 5px;
        }

        .tr-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #667eea;
        }

        .tr-section-title {
            font-size: 20px;
            color: #2d3748;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tr-section-title i {
            color: #667eea;
            font-size: 18px;
        }

        .tr-section-content {
            color: #4a5568;
            line-height: 1.8;
            font-size: 16px;
        }

        .tr-meta-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .tr-meta-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-left: 3px solid #667eea;
        }

        .tr-meta-label {
            font-size: 12px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .tr-meta-value {
            font-size: 18px;
            color: #2d3748;
            font-weight: 600;
        }

        .tr-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .tr-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tr-table th,
        .tr-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .tr-table tbody tr:hover {
            background: #f7fafc;
        }

        .tr-table tbody tr:last-child td {
            border-bottom: none;
        }

        .tr-modal-footer {
            padding: 20px 30px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            flex-shrink: 0;
        }

        /* ====================== INÍCIO DAS MUDANÇAS RESPONSIVIDADE ====================== */
        
        /* Responsividade Aprimorada */
        @media (max-width: 1200px) {
            .sidebar {
                width: 220px;
            }
            /* REMOVIDO: .main-content { margin-left: 220px; } */
            .cards-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            /* MUDANÇAS PARA MOBILE */
            .dashboard-container {
                flex-direction: column;       /* ADICIONADO: sidebar em cima do conteúdo no mobile */
            }
            
            .sidebar {
                width: 100%;                  /* MUDANÇA: largura total no mobile */
                min-height: auto;             /* MUDANÇA: altura automática no mobile */
                position: fixed;              /* ADICIONADO: volta a ser fixed no mobile */
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1000;                /* ADICIONADO: fica acima do conteúdo */
                height: 100vh;                /* ADICIONADO: altura total no mobile */
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                /* Já está com flex: 1, não precisa mudanças */
                padding: 20px;
            }
            
            /* ADICIONADO: botão menu hamburguer para mobile */
            .menu-toggle {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1001;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 10px 15px;
                border-radius: 10px;
                cursor: pointer;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }
            
            .login-container {
                max-width: 100%;
                margin: 20px;
                padding: 40px 30px;
            }
            
            .stats-grid {
                flex-direction: column !important;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 20px;
                padding: 30px;
                width: calc(100% - 40px);
            }
        }

        /* ADICIONADO: esconder botão menu em desktop */
        .menu-toggle {
            display: none;
        }

        /* ====================== FIM DAS MUDANÇAS RESPONSIVIDADE ====================== */
    </style>
</head>
<body>
    <!-- ADICIONADO: Botão menu para mobile -->
    <button class="menu-toggle" id="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('active')">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Tela de Login -->
    <div id="login-screen" class="login-container">
        <div class="logo">
            <i class="fas fa-building"></i>
        </div>
        <h1>Portal do Fornecedor</h1>
        <p>Sistema Integrado de Licitações</p>

        <div id="login-alert" class="alert alert-error"></div>

        <form id="login-form">
            <div class="form-group">
                <label for="email">E-mail <span class="required">*</span></label>
                <input type="email" id="email" placeholder="seu@email.com" required>
                <span class="error-text">E-mail inválido</span>
            </div>
            <div class="form-group">
                <label for="senha">Senha <span class="required">*</span></label>
                <input type="password" id="senha" placeholder="Digite sua senha" required>
                <span class="error-text">Senha é obrigatória</span>
            </div>
            <button type="submit" class="login-btn" id="btn-login">
                <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
            </button>
        </form>

        <div class="login-info">
            <i class="fas fa-info-circle"></i> Credenciais fornecidas pelo setor de compras
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard-screen" class="dashboard-container">
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-building"></i>
                <h2>Portal do Fornecedor</h2>
                <p id="empresa-nome"></p>
            </div>

            <div class="nav-section">
                <div class="nav-title">FORNECEDOR</div>
                <button class="nav-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-item" data-section="processos">
                    <i class="fas fa-file-contract"></i> Processos Disponíveis
                </button>
                <button class="nav-item" data-section="propostas">
                    <i class="fas fa-paper-plane"></i> Minhas Propostas
                </button>
                <button class="nav-item" data-section="historico">
                    <i class="fas fa-history"></i> Histórico
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">CONFIGURAÇÕES</div>
                <button class="nav-item" data-section="perfil">
                    <i class="fas fa-user"></i> Meu Perfil
                </button>
                <button class="nav-item" data-section="documentos">
                    <i class="fas fa-folder"></i> Documentos
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">SISTEMA</div>
                <button class="nav-item" onclick="Sistema.logout()">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </div>

        <div class="main-content">
            <!-- Dashboard -->
            <div id="dashboard" class="content-section active">
                <div class="section-title">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </div>
                <p style="color: #718096; margin-bottom: 50px; font-size: 18px;">
                    Acompanhe seus processos licitatórios e propostas em tempo real
                </p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-processos">0</div>
                        <div class="stat-label">Processos Disponíveis</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-propostas">0</div>
                        <div class="stat-label">Propostas Enviadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-rascunhos">0</div>
                        <div class="stat-label">Rascunhos Salvos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-aceitas">0</div>
                        <div class="stat-label">Propostas Aceitas</div>
                    </div>
                </div>

                <div class="cards-grid">
                    <div class="action-card" onclick="Sistema.mostrarSecao('processos')">
                        <i class="fas fa-file-contract"></i>
                        <h3>Processos Disponíveis</h3>
                        <p>Visualizar processos licitatórios para participação</p>
                    </div>
                    <div class="action-card" onclick="Sistema.mostrarSecao('propostas')">
                        <i class="fas fa-paper-plane"></i>
                        <h3>Minhas Propostas</h3>
                        <p>Acompanhar propostas enviadas</p>
                    </div>
                    <div class="action-card" onclick="Sistema.mostrarSecao('historico')">
                        <i class="fas fa-history"></i>
                        <h3>Histórico</h3>
                        <p>Consultar participações anteriores</p>
                    </div>
                    <div class="action-card" onclick="Sistema.mostrarSecao('perfil')">
                        <i class="fas fa-user"></i>
                        <h3>Meu Perfil</h3>
                        <p>Informações da empresa</p>
                    </div>
                </div>
            </div>

            <!-- Processos Disponíveis -->
            <div id="processos" class="content-section">
                <div class="section-title">
                    <i class="fas fa-file-contract"></i> Processos Disponíveis
                </div>
                <div id="processos-list">
                    <div class="empty-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Carregando processos...</h3>
                    </div>
                </div>
            </div>

            <!-- Minhas Propostas -->
            <div id="propostas" class="content-section">
                <div class="section-title">
                    <i class="fas fa-paper-plane"></i> Minhas Propostas
                </div>
                <div id="propostas-list">
                    <div class="empty-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Carregando propostas...</h3>
                    </div>
                </div>
            </div>

            <!-- Histórico -->
            <div id="historico" class="content-section">
                <div class="section-title">
                    <i class="fas fa-history"></i> Histórico de Participações
                </div>
                <div id="historico-list">
                    <div class="empty-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Carregando histórico...</h3>
                    </div>
                </div>
            </div>

            <!-- Meu Perfil -->
            <div id="perfil" class="content-section">
                <div class="section-title">
                    <i class="fas fa-user"></i> Meu Perfil
                </div>
                <div id="perfil-content">
                    <div class="empty-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Carregando perfil...</h3>
                    </div>
                </div>
            </div>

            <!-- Documentos -->
            <div id="documentos" class="content-section">
                <div class="section-title">
                    <i class="fas fa-folder"></i> Documentos
                </div>
                <div class="empty-state">
                    <i class="fas fa-tools"></i>
                    <h3>Área de Documentos</h3>
                    <p>Funcionalidade em desenvolvimento para upload e gerenciamento de documentos.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modais -->
    <div id="modal-detalhes-processo" class="modal">
        <div class="modal-content">
            <span class="close" onclick="Sistema.fecharModal('modal-detalhes-processo')">&times;</span>
            <h2 style="font-size: 28px; color: #2d3748; margin-bottom: 30px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-file-contract" style="color: #667eea;"></i> Detalhes do Processo
            </h2>
            <div id="detalhes-processo-content"></div>
        </div>
    </div>

    <div id="modal-enviar-proposta" class="modal">
        <div class="modal-content">
            <span class="close" onclick="Sistema.fecharModal('modal-enviar-proposta')">&times;</span>
            <h2 style="font-size: 28px; color: #2d3748; margin-bottom: 30px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-paper-plane" style="color: #667eea;"></i> Enviar Proposta
            </h2>
            <form id="form-proposta">
                <div id="processo-info"></div>
                <div id="proposta-existente-aviso"></div>
                
                <div class="form-group">
                    <label for="valor-proposta">Valor da Proposta (R$) <span class="required">*</span></label>
                    <input type="number" id="valor-proposta" step="0.01" required min="0">
                    <span class="error-text">Valor é obrigatório</span>
                </div>
                
                <div class="form-group">
                    <label for="prazo-execucao">Prazo de Execução (dias) <span class="required">*</span></label>
                    <input type="number" id="prazo-execucao" required min="1">
                    <span class="error-text">Prazo é obrigatório</span>
                </div>
                
                <div class="form-group">
                    <label for="condicoes-pagamento">Condições de Pagamento <span class="required">*</span></label>
                    <select id="condicoes-pagamento" required>
                        <option value="">Selecione...</option>
                        <option value="À vista">À vista</option>
                        <option value="30 dias">30 dias</option>
                        <option value="45 dias">45 dias</option>
                        <option value="60 dias">60 dias</option>
                        <option value="Parcelado">Parcelado</option>
                    </select>
                    <span class="error-text">Selecione uma condição de pagamento</span>
                </div>
                
                <div class="form-group">
                    <label for="garantia">Garantia Oferecida</label>
                    <input type="text" id="garantia" placeholder="Ex: 12 meses">
                </div>
                
                <div class="form-group">
                    <label for="observacoes">Observações Técnicas</label>
                    <textarea id="observacoes" placeholder="Descreva detalhes técnicos da proposta..."></textarea>
                </div>
                
                <div style="text-align: right; margin-top: 40px; display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="Sistema.fecharModal('modal-enviar-proposta')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-warning" id="btn-salvar-rascunho-proposta">
                        <i class="fas fa-save"></i> Salvar Rascunho
                    </button>
                    <button type="submit" class="btn btn-primary" id="btn-enviar-proposta">
                        <i class="fas fa-paper-plane"></i> Enviar Proposta
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-detalhes-proposta" class="modal">
        <div class="modal-content">
            <span class="close" onclick="Sistema.fecharModal('modal-detalhes-proposta')">&times;</span>
            <h2 style="font-size: 28px; color: #2d3748; margin-bottom: 30px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-eye" style="color: #667eea;"></i> Detalhes da Proposta
            </h2>
            <div id="detalhes-proposta-content"></div>
        </div>
    </div>

    <div id="modal-editar-proposta" class="modal">
        <div class="modal-content">
            <span class="close" onclick="Sistema.fecharModal('modal-editar-proposta')">&times;</span>
            <h2 style="font-size: 28px; color: #2d3748; margin-bottom: 30px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-edit" style="color: #667eea;"></i> Editar Rascunho da Proposta
            </h2>
            <form id="form-editar-proposta">
                <div id="editar-processo-info"></div>
                
                <div class="form-group">
                    <label for="editar-valor-proposta">Valor da Proposta (R$) <span class="required">*</span></label>
                    <input type="number" id="editar-valor-proposta" step="0.01" required min="0">
                </div>
                
                <div class="form-group">
                    <label for="editar-prazo-execucao">Prazo de Execução (dias) <span class="required">*</span></label>
                    <input type="number" id="editar-prazo-execucao" required min="1">
                </div>
                
                <div class="form-group">
                    <label for="editar-condicoes-pagamento">Condições de Pagamento <span class="required">*</span></label>
                    <select id="editar-condicoes-pagamento" required>
                        <option value="">Selecione...</option>
                        <option value="À vista">À vista</option>
                        <option value="30 dias">30 dias</option>
                        <option value="45 dias">45 dias</option>
                        <option value="60 dias">60 dias</option>
                        <option value="Parcelado">Parcelado</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="editar-garantia">Garantia Oferecida</label>
                    <input type="text" id="editar-garantia" placeholder="Ex: 12 meses">
                </div>
                
                <div class="form-group">
                    <label for="editar-observacoes">Observações Técnicas</label>
                    <textarea id="editar-observacoes" placeholder="Descreva detalhes técnicos da proposta..."></textarea>
                </div>
                
                <div style="text-align: right; margin-top: 40px; display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="Sistema.fecharModal('modal-editar-proposta')">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sistema de dados local padronizado
        const SistemaLocal = {
            // Chaves padronizadas do localStorage
            CHAVES: {
                USUARIOS_FORNECEDORES: 'usuarios_fornecedores',
                FORNECEDOR_LOGADO: 'fornecedor_logado',
                PROCESSOS_LICITATORIOS: 'processos_licitatorios',
                PROPOSTAS_FORNECEDORES: 'propostas_fornecedores',
                PROCESSOS_POR_FORNECEDOR: 'processos_por_fornecedor',
                TRS: 'sistema_trs'
            },

            // Carregar dados do localStorage
            carregar(chave, padrao = null) {
                try {
                    const dados = localStorage.getItem(chave);
                    return dados ? JSON.parse(dados) : padrao;
                } catch (error) {
                    console.error(`Erro ao carregar ${chave}:`, error);
                    return padrao;
                }
            },

            // Salvar dados no localStorage
            salvar(chave, dados) {
                try {
                    localStorage.setItem(chave, JSON.stringify(dados));
                    return true;
                } catch (error) {
                    console.error(`Erro ao salvar ${chave}:`, error);
                    return false;
                }
            },

            // Gerar ID único
            gerarId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
        };

        // Sistema principal
        const Sistema = {
            fornecedorLogado: null,
            processoAtual: null,
            propostaEditando: null,

            // Inicializar sistema
            init() {
                this.verificarLogin();
                this.configurarEventListeners();
            },

            // Verificar se está logado
            verificarLogin() {
                const fornecedor = SistemaLocal.carregar(SistemaLocal.CHAVES.FORNECEDOR_LOGADO);
                if (fornecedor) {
                    this.fornecedorLogado = fornecedor;
                    this.mostrarDashboard();
                }
            },

            // Configurar event listeners
            configurarEventListeners() {
                // Login form
                document.getElementById('login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.fazerLogin();
                });

                // Navegação
                document.querySelectorAll('.nav-item[data-section]').forEach(item => {
                    item.addEventListener('click', function() {
                        Sistema.mostrarSecao(this.getAttribute('data-section'));
                        // Fechar menu mobile ao clicar em item
                        if (window.innerWidth <= 768) {
                            document.querySelector('.sidebar').classList.remove('active');
                        }
                    });
                });

                // Formulário de proposta
                document.getElementById('form-proposta').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.enviarProposta();
                });

                // Botão salvar rascunho
                document.getElementById('btn-salvar-rascunho-proposta').addEventListener('click', () => {
                    this.salvarRascunhoProposta();
                });

                // Formulário de edição
                document.getElementById('form-editar-proposta').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.salvarEdicaoProposta();
                });

                // Fechar modais ao clicar fora
                window.addEventListener('click', (event) => {
                    if (event.target.classList.contains('modal')) {
                        event.target.style.display = 'none';
                    }
                });

                // Validação em tempo real
                this.configurarValidacoes();
            },

            // Configurar validações
            configurarValidacoes() {
                // Email
                document.getElementById('email').addEventListener('blur', function() {
                    const valid = this.checkValidity();
                    this.classList.toggle('error', !valid && this.value);
                    this.nextElementSibling.style.display = !valid && this.value ? 'block' : 'none';
                });

                // Campos obrigatórios
                document.querySelectorAll('input[required], select[required]').forEach(campo => {
                    campo.addEventListener('blur', function() {
                        const valid = this.value.trim() !== '';
                        this.classList.toggle('error', !valid);
                        const errorText = this.parentElement.querySelector('.error-text');
                        if (errorText) {
                            errorText.style.display = !valid ? 'block' : 'none';
                        }
                    });
                });
            },

            // Fazer login
            async fazerLogin() {
                const email = document.getElementById('email').value;
                const senha = document.getElementById('senha').value;
                const btnLogin = document.getElementById('btn-login');

                // Mostrar loading
                btnLogin.innerHTML = '<span class="loading"></span> Entrando...';
                btnLogin.disabled = true;

                // Simular delay de verificação
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Verificar credenciais
                const usuarios = SistemaLocal.carregar(SistemaLocal.CHAVES.USUARIOS_FORNECEDORES, []);
                const fornecedor = usuarios.find(u => u.email === email && u.senha === senha);

                if (fornecedor) {
                    this.fornecedorLogado = fornecedor;
                    SistemaLocal.salvar(SistemaLocal.CHAVES.FORNECEDOR_LOGADO, fornecedor);
                    this.mostrarDashboard();
                } else {
                    this.mostrarAlerta('login-alert', 'E-mail ou senha incorretos. Verifique suas credenciais.', 'error');
                    btnLogin.innerHTML = '<i class="fas fa-sign-in-alt"></i> Entrar no Sistema';
                    btnLogin.disabled = false;
                }
            },

            // Mostrar dashboard
            mostrarDashboard() {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard-screen').style.display = 'flex';
                document.getElementById('empresa-nome').textContent = this.fornecedorLogado.razaoSocial;
                
                this.carregarDados();
            },

            // Carregar todos os dados
            carregarDados() {
                this.carregarEstatisticas();
                this.carregarProcessos();
                this.carregarPropostas();
                this.carregarHistorico();
                this.carregarPerfil();
            },

            // Carregar estatísticas
            carregarEstatisticas() {
                const processos = this.obterProcessosFornecedor();
                const propostas = this.obterPropostasFornecedor();
                
                const agora = new Date();
                const processosVencidos = processos.filter(p => new Date(p.dataLimite) < agora).length;
                const propostasAceitas = propostas.filter(p => p.status === 'ACEITA').length;
                const rascunhos = propostas.filter(p => p.status === 'RASCUNHO').length;
                
                document.getElementById('stat-processos').textContent = processos.length;
                document.getElementById('stat-propostas').textContent = propostas.filter(p => p.status === 'ENVIADA').length;
                document.getElementById('stat-rascunhos').textContent = rascunhos;
                document.getElementById('stat-aceitas').textContent = propostasAceitas;
            },

            // Obter processos do fornecedor
            obterProcessosFornecedor() {
                const processosPorFornecedor = SistemaLocal.carregar(SistemaLocal.CHAVES.PROCESSOS_POR_FORNECEDOR, []);
                return processosPorFornecedor.filter(p => 
                    p.fornecedorEmail === this.fornecedorLogado.email || 
                    p.fornecedorCNPJ === this.fornecedorLogado.cnpj
                );
            },

            // Obter propostas do fornecedor
            obterPropostasFornecedor() {
                const propostas = SistemaLocal.carregar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, []);
                return propostas.filter(p => 
                    p.fornecedorEmail === this.fornecedorLogado.email || 
                    p.fornecedorCNPJ === this.fornecedorLogado.cnpj
                );
            },

            // Obter TR completo do processo
            obterTRDoProcesso(processoId) {
                const processos = SistemaLocal.carregar(SistemaLocal.CHAVES.PROCESSOS_LICITATORIOS, []);
                const processo = processos.find(p => p.id === processoId);
                
                if (processo && processo.trVinculado) {
                    return processo.trVinculado;
                }
                
                // Se não encontrar no processo, tentar buscar pelo TR ID
                const trs = SistemaLocal.carregar(SistemaLocal.CHAVES.TRS, []);
                return trs.find(tr => tr.processoVinculado === processoId);
            },

            // Carregar processos
            carregarProcessos() {
                const processos = this.obterProcessosFornecedor();
                const container = document.getElementById('processos-list');
                
                if (processos.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <h3>Nenhum processo disponível</h3>
                            <p>Você ainda não foi convidado para participar de processos licitatórios.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                processos.forEach(processo => {
                    const agora = new Date();
                    const dataLimite = new Date(processo.dataLimite);
                    const status = dataLimite < agora ? 'VENCIDO' : 'ATIVO';
                    const statusClass = status === 'ATIVO' ? 'status-ativo' : 'status-vencido';
                    
                    // Verificar se já existe proposta
                    const propostas = this.obterPropostasFornecedor();
                    const propostaExistente = propostas.find(p => p.processoId === processo.processoId);
                    const jaEnviouProposta = propostaExistente && propostaExistente.status === 'ENVIADA';
                    const temRascunho = propostaExistente && propostaExistente.status === 'RASCUNHO';
                    
                    html += `
                        <div class="processo-item">
                            <div class="processo-status ${statusClass}">${status}</div>
                            <h3>${processo.numeroProcesso}</h3>
                            <p><strong>Modalidade:</strong> ${processo.modalidade}</p>
                            <p><strong>Objeto:</strong> ${processo.objeto || processo.trTitulo || 'Não informado'}</p>
                            <p><strong>Data de Abertura:</strong> ${new Date(processo.dataAbertura).toLocaleDateString('pt-BR')}</p>
                            <p><strong>Data Limite:</strong> ${dataLimite.toLocaleDateString('pt-BR')}</p>
                            <p><strong>Local:</strong> ${processo.localAbertura || 'A definir'}</p>
                            
                            ${jaEnviouProposta ? `
                                <div class="alert-warning">
                                    <i class="fas fa-check-circle"></i> Você já enviou uma proposta para este processo
                                </div>
                            ` : temRascunho ? `
                                <div class="alert-info" style="background: #e3f2fd; color: #1976d2; border: 1px solid #bbdefb;">
                                    <i class="fas fa-save"></i> Você tem um rascunho salvo para este processo
                                </div>
                            ` : ''}
                            
                            <div style="margin-top: 25px; display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="Sistema.verDetalhesProcesso('${processo.processoId}')">
                                    <i class="fas fa-eye"></i> Ver Detalhes
                                </button>
                                ${status === 'ATIVO' && !jaEnviouProposta ? `
                                    <button class="btn btn-success" onclick="Sistema.abrirFormularioProposta('${processo.processoId}')">
                                        <i class="fas fa-paper-plane"></i> ${temRascunho ? 'Continuar Proposta' : 'Enviar Proposta'}
                                    </button>
                                ` : ''}
                                <button class="btn btn-warning" onclick="Sistema.visualizarTRCompleto('${processo.processoId}')">
                                    <i class="fas fa-eye"></i> Ver TR Completo
                                </button>
                                <button class="btn btn-info" onclick="Sistema.baixarTRCompleto('${processo.processoId}')">
                                    <i class="fas fa-download"></i> Baixar TR
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            },

            // Visualizar TR Completo - NOVA IMPLEMENTAÇÃO MELHORADA
            visualizarTRCompleto(processoId) {
                const tr = this.obterTRDoProcesso(processoId);
                const processo = this.obterProcessosFornecedor().find(p => p.processoId === processoId);
                
                if (!tr || !processo) {
                    this.mostrarNotificacao('TR não encontrado para este processo.', 'error');
                    return;
                }

                // Criar modal de visualização
                const modal = document.createElement('div');
                modal.className = 'tr-modal-overlay';
                
                // Renderizar tabela de serviços
                let tabelaServicos = '';
                if (tr.servicos && tr.servicos.length > 0) {
                    tabelaServicos = `
                        <div class="tr-section">
                            <h3 class="tr-section-title">
                                <i class="fas fa-list"></i> Tabela de Serviços
                            </h3>
                            <table class="tr-table">
                                <thead>
                                    <tr>
                                        <th width="80">Item</th>
                                        <th>Descrição do Serviço</th>
                                        <th width="100">Unidade</th>
                                        <th width="120">Quantidade</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tr.servicos.map(servico => `
                                        <tr>
                                            <td style="text-align: center; font-weight: 600;">${servico.item}</td>
                                            <td>${servico.descricao}</td>
                                            <td style="text-align: center;">${servico.unidade}</td>
                                            <td style="text-align: center; font-weight: 600;">${servico.quantidade}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }

                // Renderizar matriz de responsabilidade
                let matrizResp = '';
                if (tr.matrizResponsabilidade && tr.matrizResponsabilidade.length > 0) {
                    matrizResp = `
                        <div class="tr-section">
                            <h3 class="tr-section-title">
                                <i class="fas fa-tasks"></i> Matriz de Responsabilidade
                            </h3>
                            <table class="tr-table">
                                <thead>
                                    <tr>
                                        <th>Item/Atividade</th>
                                        <th width="150" style="text-align: center;">Contratada</th>
                                        <th width="150" style="text-align: center;">Contratante</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tr.matrizResponsabilidade.map(item => `
                                        <tr>
                                            <td>${item.item}</td>
                                            <td style="text-align: center;">
                                                ${item.responsavel === 'contratada' ? '<i class="fas fa-check-circle" style="color: #48bb78; font-size: 20px;"></i>' : '-'}
                                            </td>
                                            <td style="text-align: center;">
                                                ${item.responsavel === 'contratante' ? '<i class="fas fa-check-circle" style="color: #48bb78; font-size: 20px;"></i>' : '-'}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }

                modal.innerHTML = `
                    <div class="tr-modal-content">
                        <div class="tr-modal-header">
                            <div>
                                <h2>${tr.numeroTR || 'TR-' + processo.numeroProcesso}</h2>
                                <p>${tr.titulo}</p>
                            </div>
                            <button class="tr-modal-close" onclick="this.closest('.tr-modal-overlay').remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="tr-modal-body">
                            <!-- Informações Gerais -->
                            <div class="tr-meta-info">
                                <div class="tr-meta-card">
                                    <div class="tr-meta-label">Modalidade</div>
                                    <div class="tr-meta-value">${tr.modalidade}</div>
                                </div>
                                <div class="tr-meta-card">
                                    <div class="tr-meta-label">Valor Estimado</div>
                                    <div class="tr-meta-value">R$ ${this.formatarMoeda(tr.valorEstimado || 0)}</div>
                                </div>
                                <div class="tr-meta-card">
                                    <div class="tr-meta-label">Prazo de Execução</div>
                                    <div class="tr-meta-value">${tr.prazo || tr.prazoExecucao || 'A definir'}</div>
                                </div>
                                <div class="tr-meta-card">
                                    <div class="tr-meta-label">Visita ao Local</div>
                                    <div class="tr-meta-value">${tr.visitaLocal || 'Não especificado'}</div>
                                </div>
                            </div>

                            <!-- Seções do TR -->
                            <div class="tr-section">
                                <h3 class="tr-section-title">
                                    <i class="fas fa-bullseye"></i> 1. Objetivo
                                </h3>
                                <div class="tr-section-content">${tr.objetivo}</div>
                            </div>

                            <div class="tr-section">
                                <h3 class="tr-section-title">
                                    <i class="fas fa-certificate"></i> 2. Conformidade ao Termo de Referência
                                </h3>
                                <div class="tr-section-content">${tr.conformidade}</div>
                            </div>

                            <div class="tr-section">
                                <h3 class="tr-section-title">
                                    <i class="fas fa-map-marker-alt"></i> 3. Local/Acesso
                                </h3>
                                <div class="tr-section-content">${tr.local}</div>
                            </div>

                            <div class="tr-section">
                                <h3 class="tr-section-title">
                                    <i class="fas fa-cogs"></i> 4. Escopo Técnico
                                </h3>
                                <div class="tr-section-content">${tr.escopo}</div>
                            </div>

                            <div class="tr-section">
                                <h3 class="tr-section-title">
                                    <i class="fas fa-info-circle"></i> 5. Situação Atual
                                </h3>
                                <div class="tr-section-content">${tr.situacaoAtual}</div>
                            </div>

                            <div class="tr-section">
                                <h3 class="tr-section-title">
                                    <i class="fas fa-lightbulb"></i> 6. Situação Proposta
                                </h3>
                                <div class="tr-section-content">${tr.situacaoProposta}</div>
                            </div>

                            <div class="tr-section">
                                <h3 class="tr-section-title">
                                    <i class="fas fa-file-alt"></i> 7. Especificação Técnica
                                </h3>
                                <div class="tr-section-content">${tr.especificacao}</div>
                            </div>

                            ${tr.premissas ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-exclamation-triangle"></i> 8. Premissas, Requisitos e Restrições
                                    </h3>
                                    <div class="tr-section-content">${tr.premissas}</div>
                                </div>
                            ` : ''}

                            ${tr.planilhaQuantidade ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-calculator"></i> 9. Planilha de Quantidade
                                    </h3>
                                    <div class="tr-section-content">${tr.planilhaQuantidade}</div>
                                </div>
                            ` : ''}

                            ${tabelaServicos}

                            ${tr.escopoGeral ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-globe"></i> 10. Escopo Geral
                                    </h3>
                                    <div class="tr-section-content">${tr.escopoGeral}</div>
                                </div>
                            ` : ''}

                            <div class="tr-section">
                                <h3 class="tr-section-title">
                                    <i class="fas fa-clock"></i> 11. Prazos
                                </h3>
                                <div class="tr-section-content">${tr.prazos || tr.prazo || 'A definir'}</div>
                            </div>

                            ${matrizResp}

                            ${tr.mobilizacao ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-hard-hat"></i> 12. Mobilização, Segurança e Saúde do Trabalho
                                    </h3>
                                    <div class="tr-section-content">${tr.mobilizacao}</div>
                                </div>
                            ` : ''}

                            ${tr.canteiro ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-home"></i> 13. Canteiro de Obras e Infraestrutura Temporárias
                                    </h3>
                                    <div class="tr-section-content">${tr.canteiro}</div>
                                </div>
                            ` : ''}

                            ${tr.credenciamento ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-plane"></i> 14. Credenciamento Aeroportuário
                                    </h3>
                                    <div class="tr-section-content">${tr.credenciamento}</div>
                                </div>
                            ` : ''}

                            ${tr.meioAmbiente ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-leaf"></i> 15. Meio Ambiente
                                    </h3>
                                    <div class="tr-section-content">${tr.meioAmbiente}</div>
                                </div>
                            ` : ''}

                            ${tr.engenharia ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-drafting-compass"></i> 16. Engenharia
                                    </h3>
                                    <div class="tr-section-content">${tr.engenharia}</div>
                                </div>
                            ` : ''}

                            ${tr.aquisicoes ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-shopping-cart"></i> 17. Aquisições
                                    </h3>
                                    <div class="tr-section-content">${tr.aquisicoes}</div>
                                </div>
                            ` : ''}

                            ${tr.planejamentoGestao ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-chart-line"></i> 18. Planejamento/Gestão de Contratos
                                    </h3>
                                    <div class="tr-section-content">${tr.planejamentoGestao}</div>
                                </div>
                            ` : ''}

                            ${tr.planejamentoExecutivo ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-project-diagram"></i> 19. Planejamento Executivo
                                    </h3>
                                    <div class="tr-section-content">${tr.planejamentoExecutivo}</div>
                                </div>
                            ` : ''}

                            ${tr.testes ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-vial"></i> 20. Testes, Comissionamento e Treinamento
                                    </h3>
                                    <div class="tr-section-content">${tr.testes}</div>
                                </div>
                            ` : ''}

                            ${tr.encerramento ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-flag-checkered"></i> 21. Ao Encerramento da Obra
                                    </h3>
                                    <div class="tr-section-content">${tr.encerramento}</div>
                                </div>
                            ` : ''}

                            ${tr.cap ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-file-contract"></i> 22. Certificado de Aceitação Provisória (CAP)
                                    </h3>
                                    <div class="tr-section-content">${tr.cap}</div>
                                </div>
                            ` : ''}

                            ${tr.caf ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-award"></i> 23. Certificado de Aceitação Final (CAF)
                                    </h3>
                                    <div class="tr-section-content">${tr.caf}</div>
                                </div>
                            ` : ''}

                            ${tr.garantia ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-shield-alt"></i> 24. Garantia
                                    </h3>
                                    <div class="tr-section-content">${tr.garantia}</div>
                                </div>
                            ` : ''}

                            <div class="tr-section">
                                <h3 class="tr-section-title">
                                    <i class="fas fa-balance-scale"></i> 25. Critérios de Avaliação de Propostas
                                </h3>
                                <div class="tr-section-content">${tr.criterios}</div>
                            </div>

                            ${tr.anexos ? `
                                <div class="tr-section">
                                    <h3 class="tr-section-title">
                                        <i class="fas fa-paperclip"></i> 26. Anexos
                                    </h3>
                                    <div class="tr-section-content">${tr.anexos}</div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="tr-modal-footer">
                            <button class="btn btn-secondary" onclick="this.closest('.tr-modal-overlay').remove()">
                                <i class="fas fa-times"></i> Fechar
                            </button>
                            <button class="btn btn-warning" onclick="Sistema.baixarTRCompleto('${processoId}')">
                                <i class="fas fa-download"></i> Baixar TR Completo
                            </button>
                            <button class="btn btn-primary" onclick="this.closest('.tr-modal-overlay').remove(); Sistema.abrirFormularioProposta('${processoId}')">
                                <i class="fas fa-paper-plane"></i> Fazer Proposta
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            },

            // Carregar propostas
            carregarPropostas() {
                const propostas = this.obterPropostasFornecedor();
                const container = document.getElementById('propostas-list');
                
                if (propostas.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-paper-plane"></i>
                            <h3>Nenhuma proposta enviada</h3>
                            <p>Você ainda não enviou propostas para processos licitatórios.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                propostas.forEach(proposta => {
                    let statusClass = 'status-enviada';
                    let statusTexto = proposta.status || 'ENVIADA';
                    
                    switch(proposta.status) {
                        case 'RASCUNHO':
                            statusClass = 'processo-status';
                            statusTexto = 'RASCUNHO';
                            break;
                        case 'ACEITA':
                            statusClass = 'status-aceita';
                            break;
                        case 'REJEITADA':
                            statusClass = 'status-rejeitada';
                            break;
                        case 'EM_ANALISE':
                            statusTexto = 'EM ANÁLISE';
                            break;
                    }
                    
                    html += `
                        <div class="processo-item">
                            <div class="processo-status ${statusClass}">${statusTexto}</div>
                            <h3>Processo: ${proposta.numeroProcesso}</h3>
                            <p><strong>Valor da Proposta:</strong> R$ ${this.formatarMoeda(proposta.valor)}</p>
                            <p><strong>Prazo de Execução:</strong> ${proposta.prazoExecucao} dias</p>
                            <p><strong>Condições de Pagamento:</strong> ${proposta.condicoesPagamento}</p>
                            <p><strong>Data de ${proposta.status === 'RASCUNHO' ? 'Criação' : 'Envio'}:</strong> ${new Date(proposta.dataEnvio || proposta.dataCriacao).toLocaleDateString('pt-BR')}</p>
                            <p><strong>Garantia:</strong> ${proposta.garantia || 'Não informada'}</p>
                            
                            ${proposta.feedbackComprador ? `
                                <div class="empresa-info" style="margin-top: 20px;">
                                    <h3 style="font-size: 18px;"><i class="fas fa-comment-alt"></i> Feedback do Comprador</h3>
                                    <p style="color: #4a5568;">${proposta.feedbackComprador}</p>
                                    ${proposta.dataFeedback ? `
                                        <p style="font-size: 14px; color: #718096; margin-top: 10px;">
                                            <i class="fas fa-calendar"></i> ${new Date(proposta.dataFeedback).toLocaleDateString('pt-BR')}
                                        </p>
                                    ` : ''}
                                </div>
                            ` : ''}
                            
                            <div style="margin-top: 25px; display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="Sistema.verDetalhesProposta('${proposta.id}')">
                                    <i class="fas fa-eye"></i> Ver Detalhes
                                </button>
                                ${proposta.status === 'RASCUNHO' ? `
                                    <button class="btn btn-warning" onclick="Sistema.editarProposta('${proposta.id}')">
                                        <i class="fas fa-edit"></i> Editar Rascunho
                                    </button>
                                    <button class="btn btn-success" onclick="Sistema.enviarRascunho('${proposta.id}')">
                                        <i class="fas fa-paper-plane"></i> Enviar Proposta
                                    </button>
                                    <button class="btn btn-danger" onclick="Sistema.excluirRascunho('${proposta.id}')">
                                        <i class="fas fa-trash"></i> Excluir Rascunho
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            },

            // Carregar histórico
            carregarHistorico() {
                const processos = this.obterProcessosFornecedor();
                const propostas = this.obterPropostasFornecedor();
                const container = document.getElementById('historico-list');
                
                // Combinar processos e propostas para criar histórico
                let historico = [];
                
                processos.forEach(processo => {
                    const proposta = propostas.find(p => p.processoId === processo.processoId);
                    
                    historico.push({
                        tipo: 'processo',
                        processo: processo,
                        proposta: proposta,
                        data: processo.dataAbertura,
                        status: proposta ? (proposta.status === 'RASCUNHO' ? 'RASCUNHO SALVO' : 'PARTICIPOU') : 'NÃO PARTICIPOU'
                    });
                });
                
                // Ordenar por data (mais recente primeiro)
                historico.sort((a, b) => new Date(b.data) - new Date(a.data));
                
                if (historico.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <h3>Nenhum histórico disponível</h3>
                            <p>Seu histórico de participações aparecerá aqui.</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                historico.forEach(item => {
                    const statusClass = item.status === 'PARTICIPOU' ? 'status-ativo' : item.status === 'RASCUNHO SALVO' ? 'processo-status' : 'status-vencido';
                    
                    html += `
                        <div class="processo-item">
                            <div class="processo-status ${statusClass}">${item.status}</div>
                            <h3>${item.processo.numeroProcesso}</h3>
                            <p><strong>Modalidade:</strong> ${item.processo.modalidade}</p>
                            <p><strong>Objeto:</strong> ${item.processo.objeto || item.processo.trTitulo || 'Não informado'}</p>
                            <p><strong>Data de Abertura:</strong> ${new Date(item.processo.dataAbertura).toLocaleDateString('pt-BR')}</p>
                            
                            ${item.proposta ? `
                                <p><strong>Valor da Proposta:</strong> R$ ${this.formatarMoeda(item.proposta.valor)}</p>
                                <p><strong>Status da Proposta:</strong> ${item.proposta.status || 'ENVIADA'}
                                    ${item.proposta.status === 'ACEITA' ? '<span class="feedback-badge feedback-aceito">Aceita</span>' : ''}
                                    ${item.proposta.status === 'REJEITADA' ? '<span class="feedback-badge feedback-rejeitado">Rejeitada</span>' : ''}
                                    ${item.proposta.status === 'RASCUNHO' ? '<span class="feedback-badge feedback-pendente">Rascunho</span>' : ''}
                                </p>
                            ` : ''}
                            
                            <div style="margin-top: 25px; display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="Sistema.verDetalhesProcesso('${item.processo.processoId}')">
                                    <i class="fas fa-eye"></i> Ver Processo
                                </button>
                                ${item.proposta ? `
                                    <button class="btn btn-success" onclick="Sistema.verDetalhesProposta('${item.proposta.id}')">
                                        <i class="fas fa-paper-plane"></i> Ver Proposta
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            },

            // Carregar perfil
            carregarPerfil() {
                const container = document.getElementById('perfil-content');
                const processos = this.obterProcessosFornecedor();
                const propostas = this.obterPropostasFornecedor();
                const propostasEnviadas = propostas.filter(p => p.status === 'ENVIADA');
                const rascunhos = propostas.filter(p => p.status === 'RASCUNHO');
                const propostasAceitas = propostas.filter(p => p.status === 'ACEITA').length;
                const propostasRejeitadas = propostas.filter(p => p.status === 'REJEITADA').length;
                const propostasEmAnalise = propostas.filter(p => p.status === 'EM_ANALISE').length;
                
                container.innerHTML = `
                    <div class="empresa-info">
                        <h3><i class="fas fa-building"></i> Dados da Empresa</h3>
                        <div class="info-item">
                            <span class="info-label">Razão Social:</span>
                            <span class="info-value">${this.fornecedorLogado.razaoSocial}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">CNPJ:</span>
                            <span class="info-value">${this.formatarCNPJ(this.fornecedorLogado.cnpj)}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">E-mail:</span>
                            <span class="info-value">${this.fornecedorLogado.email}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Telefone:</span>
                            <span class="info-value">${this.fornecedorLogado.telefone || 'Não informado'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Status:</span>
                            <span class="info-value" style="color: #48bb78; font-weight: bold;">
                                <i class="fas fa-check-circle"></i> Ativo
                            </span>
                        </div>
                    </div>
                    
                    <div class="empresa-info">
                        <h3><i class="fas fa-chart-bar"></i> Estatísticas de Participação</h3>
                        <div class="info-item">
                            <span class="info-label">Processos Convidados:</span>
                            <span class="info-value">${processos.length}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Propostas Enviadas:</span>
                            <span class="info-value">${propostasEnviadas.length}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Rascunhos Salvos:</span>
                            <span class="info-value">${rascunhos.length}
                                ${rascunhos.length > 0 ? '<span class="feedback-badge feedback-pendente">Pendentes</span>' : ''}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Propostas Aceitas:</span>
                            <span class="info-value">${propostasAceitas}
                                ${propostasAceitas > 0 ? '<span class="feedback-badge feedback-aceito">Sucesso!</span>' : ''}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Propostas Rejeitadas:</span>
                            <span class="info-value">${propostasRejeitadas}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Em Análise:</span>
                            <span class="info-value">${propostasEmAnalise}
                                ${propostasEmAnalise > 0 ? '<span class="feedback-badge feedback-pendente">Aguardando</span>' : ''}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Taxa de Sucesso:</span>
                            <span class="info-value">
                                ${propostasEnviadas.length > 0 ? ((propostasAceitas / propostasEnviadas.length * 100).toFixed(1) + '%') : 'N/A'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="empresa-info">
                        <h3><i class="fas fa-info-circle"></i> Informações do Sistema</h3>
                        <p style="color: #718096; margin-bottom: 20px; line-height: 1.6;">
                            Suas credenciais de acesso foram fornecidas pelo setor de compras. 
                            Para alterações nos dados cadastrais ou problemas de acesso, entre em contato com o setor responsável.
                        </p>
                        <p style="color: #4a5568; font-weight: 600;">
                            <i class="fas fa-envelope" style="color: #667eea; margin-right: 5px;"></i> 
                            Suporte: compras@prefeitura.gov.br
                        </p>
                        <p style="color: #4a5568; font-weight: 600; margin-top: 10px;">
                            <i class="fas fa-phone" style="color: #667eea; margin-right: 5px;"></i> 
                            Telefone: (11) 3333-4444
                        </p>
                        <p style="color: #4a5568; font-weight: 600; margin-top: 10px;">
                            <i class="fas fa-clock" style="color: #667eea; margin-right: 5px;"></i> 
                            Horário: Segunda a Sexta, 8h às 17h
                        </p>
                    </div>
                `;
            },

            // Ver detalhes do processo com TR completo
            verDetalhesProcesso(processoId) {
                const processos = this.obterProcessosFornecedor();
                const processo = processos.find(p => p.processoId === processoId);
                
                if (!processo) return;
                
                const agora = new Date();
                const dataLimite = new Date(processo.dataLimite);
                const status = dataLimite < agora ? 'VENCIDO' : 'ATIVO';
                
                // Obter TR completo
                const tr = this.obterTRDoProcesso(processoId);
                
                document.getElementById('detalhes-processo-content').innerHTML = `
                    <div class="empresa-info">
                        <div class="info-item">
                            <span class="info-label">Número do Processo:</span>
                            <span class="info-value">${processo.numeroProcesso}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Modalidade:</span>
                            <span class="info-value">${processo.modalidade}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Status:</span>
                            <span class="info-value" style="color: ${status === 'ATIVO' ? '#48bb78' : '#f56565'}; font-weight: bold;">
                                ${status}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Data de Abertura:</span>
                            <span class="info-value">${new Date(processo.dataAbertura).toLocaleDateString('pt-BR')}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Data Limite:</span>
                            <span class="info-value">${dataLimite.toLocaleDateString('pt-BR')}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Local de Abertura:</span>
                            <span class="info-value">${processo.localAbertura || 'A definir'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Valor Estimado:</span>
                            <span class="info-value">R$ ${this.formatarMoeda(processo.valorEstimado || tr?.valorEstimado || 0)}</span>
                        </div>
                    </div>
                    
                    ${tr ? `
                        <div class="tr-info-box">
                            <h4><i class="fas fa-file-alt"></i> Resumo do Termo de Referência</h4>
                            <p><strong>TR Nº:</strong> ${tr.numeroTR || 'N/A'}</p>
                            <p><strong>Título:</strong> ${tr.titulo}</p>
                            <p><strong>Objeto:</strong> ${tr.objetivo}</p>
                            <p><strong>Modalidade Sugerida:</strong> ${tr.modalidade}</p>
                            <p><strong>Prazo de Execução:</strong> ${tr.prazo || tr.prazoExecucao || 'Conforme TR'}</p>
                        </div>
                        
                        <div class="empresa-info">
                            <h3><i class="fas fa-crosshairs"></i> Escopo Técnico</h3>
                            <p style="color: #4a5568; line-height: 1.6;">${tr.escopo || 'Não informado'}</p>
                        </div>
                        
                        <div class="empresa-info">
                            <h3><i class="fas fa-clipboard-check"></i> Especificações Técnicas</h3>
                            <p style="color: #4a5568; line-height: 1.6;">${tr.especificacao || 'Não informado'}</p>
                        </div>
                        
                        <div class="empresa-info">
                            <h3><i class="fas fa-tasks"></i> Critérios de Avaliação</h3>
                            <p style="color: #4a5568; line-height: 1.6;">${tr.criterios || 'Conforme edital'}</p>
                        </div>
                    ` : `
                        <div class="empresa-info">
                            <h3><i class="fas fa-file-alt"></i> Objeto da Licitação</h3>
                            <p style="color: #4a5568; line-height: 1.6;">
                                ${processo.objeto || processo.trTitulo || 'Conforme especificações do edital'}
                            </p>
                        </div>
                    `}
                    
                    <div style="text-align: right; margin-top: 40px; display: flex; gap: 15px; justify-content: flex-end;">
                        <button class="btn btn-secondary" onclick="Sistema.fecharModal('modal-detalhes-processo')">
                            <i class="fas fa-times"></i> Fechar
                        </button>
                        <button class="btn btn-info" onclick="Sistema.visualizarTRCompleto('${processoId}')">
                            <i class="fas fa-eye"></i> Ver TR Completo
                        </button>
                        <button class="btn btn-warning" onclick="Sistema.baixarTRCompleto('${processoId}')">
                            <i class="fas fa-download"></i> Baixar TR
                        </button>
                        ${status === 'ATIVO' ? `
                            <button class="btn btn-primary" onclick="Sistema.fecharModal('modal-detalhes-processo'); Sistema.abrirFormularioProposta('${processoId}')">
                                <i class="fas fa-paper-plane"></i> Enviar Proposta
                            </button>
                        ` : ''}
                    </div>
                `;
                
                this.abrirModal('modal-detalhes-processo');
            },

            // Baixar TR completo
            baixarTRCompleto(processoId) {
                const processo = this.obterProcessosFornecedor().find(p => p.processoId === processoId);
                const tr = this.obterTRDoProcesso(processoId);
                
                if (!processo) {
                    this.mostrarNotificacao('Processo não encontrado.', 'error');
                    return;
                }
                
                if (!tr) {
                    this.mostrarNotificacao('Termo de Referência não encontrado para este processo.', 'error');
                    return;
                }
                
                const nomeArquivo = `TR_${tr.numeroTR || processo.numeroProcesso}_Completo.html`;
                
                // Gerar conteúdo HTML completo do TR
                const conteudoHTML = `
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Termo de Referência - ${tr.numeroTR || processo.numeroProcesso}</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            line-height: 1.6; 
            color: #333;
        }
        .header { 
            text-align: center; 
            margin-bottom: 40px; 
            border-bottom: 2px solid #333; 
            padding-bottom: 20px; 
        }
        h1, h2, h3 { color: #2c3e50; }
        .section { 
            margin-bottom: 30px; 
            page-break-inside: avoid;
        }
        .section-title { 
            background: #f0f0f0; 
            padding: 10px; 
            margin-bottom: 15px; 
            font-weight: bold; 
            border-left: 4px solid #3498db;
        }
        .info-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .info-item { 
            padding: 10px; 
            background: #f9f9f9; 
            border-radius: 5px;
        }
        .info-label { 
            font-weight: bold; 
            color: #2c3e50;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .table th,
        .table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .table th {
            background: #3498db;
            color: white;
        }
        .table tr:nth-child(even) {
            background: #f9f9f9;
        }
        .footer {
            margin-top: 50px;
            text-align: center;
            color: #666;
            font-size: 12px;
        }
        @media print { 
            body { margin: 20px; }
            .section { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>TERMO DE REFERÊNCIA</h1>
        <h2>${tr.numeroTR || 'S/N'}</h2>
        <h3>${tr.titulo}</h3>
    </div>
    
    <div class="info-grid">
        <div class="info-item">
            <span class="info-label">Processo Licitatório:</span><br>
            ${processo.numeroProcesso}
        </div>
        <div class="info-item">
            <span class="info-label">Modalidade:</span><br>
            ${tr.modalidade || processo.modalidade}
        </div>
        <div class="info-item">
            <span class="info-label">Valor Estimado:</span><br>
            R$ ${parseFloat(tr.valorEstimado || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}
        </div>
        <div class="info-item">
            <span class="info-label">Data de Criação:</span><br>
            ${new Date(tr.dataCriacao || processo.dataCriacao).toLocaleDateString('pt-BR')}
        </div>
    </div>
    
    <div class="section">
        <div class="section-title">1. OBJETIVO</div>
        <p>${tr.objetivo || 'Não informado'}</p>
    </div>
    
    <div class="section">
        <div class="section-title">2. CONFORMIDADE AO TERMO DE REFERÊNCIA</div>
        <p>${tr.conformidade || 'Conforme normas e regulamentos aplicáveis'}</p>
    </div>
    
    <div class="section">
        <div class="section-title">3. LOCAL/ACESSO</div>
        <p>${tr.local || processo.localAbertura || 'A definir'}</p>
    </div>
    
    <div class="section">
        <div class="section-title">4. ESCOPO TÉCNICO</div>
        <p>${tr.escopo || 'Conforme especificações técnicas'}</p>
    </div>
    
    <div class="section">
        <div class="section-title">5. SITUAÇÃO ATUAL</div>
        <p>${tr.situacaoAtual || 'Conforme diagnóstico apresentado'}</p>
    </div>
    
    <div class="section">
        <div class="section-title">6. SITUAÇÃO PROPOSTA</div>
        <p>${tr.situacaoProposta || 'Conforme objetivos do projeto'}</p>
    </div>
    
    <div class="section">
        <div class="section-title">7. ESPECIFICAÇÃO TÉCNICA</div>
        <p>${tr.especificacao || 'Detalhamento técnico conforme projeto'}</p>
    </div>
    
    ${tr.premissas ? `
        <div class="section">
            <div class="section-title">8. PREMISSAS, REQUISITOS E RESTRIÇÕES</div>
            <p>${tr.premissas}</p>
        </div>
    ` : ''}
    
    ${tr.planilhaQuantidade ? `
        <div class="section">
            <div class="section-title">9. PLANILHA DE QUANTIDADE</div>
            <p>${tr.planilhaQuantidade}</p>
        </div>
    ` : ''}
    
    ${tr.servicos && tr.servicos.length > 0 ? `
        <div class="section">
            <div class="section-title">TABELA DE SERVIÇOS</div>
            <table class="table">
                <thead>
                    <tr>
                        <th width="10%">Item</th>
                        <th width="60%">Descrição</th>
                        <th width="15%">Unidade</th>
                        <th width="15%">Quantidade</th>
                    </tr>
                </thead>
                <tbody>
                    ${tr.servicos.map(s => `
                        <tr>
                            <td style="text-align: center;">${s.item}</td>
                            <td>${s.descricao}</td>
                            <td style="text-align: center;">${s.unidade}</td>
                            <td style="text-align: center;">${s.quantidade}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    ` : ''}
    
    ${tr.escopoGeral ? `
        <div class="section">
            <div class="section-title">10. ESCOPO GERAL</div>
            <p>${tr.escopoGeral}</p>
        </div>
    ` : ''}
    
    <div class="section">
        <div class="section-title">11. PRAZOS</div>
        <p>${tr.prazo || tr.prazoExecucao || tr.prazos || 'Conforme cronograma do projeto'}</p>
    </div>
    
    ${tr.matrizResponsabilidade && tr.matrizResponsabilidade.length > 0 ? `
        <div class="section">
            <div class="section-title">12. MATRIZ DE RESPONSABILIDADE</div>
            <table class="table">
                <thead>
                    <tr>
                        <th width="60%">Item/Atividade</th>
                        <th width="20%">Contratada</th>
                        <th width="20%">Contratante</th>
                    </tr>
                </thead>
                <tbody>
                    ${tr.matrizResponsabilidade.map(item => `
                        <tr>
                            <td>${item.item}</td>
                            <td style="text-align: center;">${item.responsavel === 'contratada' ? '✓' : '-'}</td>
                            <td style="text-align: center;">${item.responsavel === 'contratante' ? '✓' : '-'}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    ` : ''}
    
    ${tr.mobilizacao ? `
        <div class="section">
            <div class="section-title">13. MOBILIZAÇÃO, SEGURANÇA E SAÚDE DO TRABALHO</div>
            <p>${tr.mobilizacao}</p>
        </div>
    ` : ''}
    
    ${tr.canteiro ? `
        <div class="section">
            <div class="section-title">14. CANTEIRO DE OBRAS E INFRAESTRUTURA TEMPORÁRIAS</div>
            <p>${tr.canteiro}</p>
        </div>
    ` : ''}
    
    ${tr.credenciamento ? `
        <div class="section">
            <div class="section-title">15. CREDENCIAMENTO AEROPORTUÁRIO</div>
            <p>${tr.credenciamento}</p>
        </div>
    ` : ''}
    
    ${tr.meioAmbiente ? `
        <div class="section">
            <div class="section-title">16. MEIO AMBIENTE</div>
            <p>${tr.meioAmbiente}</p>
        </div>
    ` : ''}
    
    ${tr.engenharia ? `
        <div class="section">
            <div class="section-title">17. ENGENHARIA</div>
            <p>${tr.engenharia}</p>
        </div>
    ` : ''}
    
    ${tr.aquisicoes ? `
        <div class="section">
            <div class="section-title">18. AQUISIÇÕES</div>
            <p>${tr.aquisicoes}</p>
        </div>
    ` : ''}
    
    ${tr.planejamentoGestao ? `
        <div class="section">
            <div class="section-title">19. PLANEJAMENTO/GESTÃO DE CONTRATOS</div>
            <p>${tr.planejamentoGestao}</p>
        </div>
    ` : ''}
    
    ${tr.planejamentoExecutivo ? `
        <div class="section">
            <div class="section-title">20. PLANEJAMENTO EXECUTIVO</div>
            <p>${tr.planejamentoExecutivo}</p>
        </div>
    ` : ''}
    
    ${tr.testes ? `
        <div class="section">
            <div class="section-title">21. TESTES, COMISSIONAMENTO E TREINAMENTO</div>
            <p>${tr.testes}</p>
        </div>
    ` : ''}
    
    ${tr.encerramento ? `
        <div class="section">
            <div class="section-title">22. AO ENCERRAMENTO DA OBRA</div>
            <p>${tr.encerramento}</p>
        </div>
    ` : ''}
    
    ${tr.cap ? `
        <div class="section">
            <div class="section-title">23. CERTIFICADO DE ACEITAÇÃO PROVISÓRIA (CAP)</div>
            <p>${tr.cap}</p>
        </div>
    ` : ''}
    
    ${tr.caf ? `
        <div class="section">
            <div class="section-title">24. CERTIFICADO DE ACEITAÇÃO FINAL (CAF)</div>
            <p>${tr.caf}</p>
        </div>
    ` : ''}
    
    ${tr.garantia ? `
        <div class="section">
            <div class="section-title">25. GARANTIA</div>
            <p>${tr.garantia}</p>
        </div>
    ` : ''}
    
    <div class="section">
        <div class="section-title">26. CRITÉRIOS DE AVALIAÇÃO DE PROPOSTAS</div>
        <p>${tr.criterios || 'Menor preço global, atendendo às especificações técnicas'}</p>
    </div>
    
    ${tr.anexos ? `
        <div class="section">
            <div class="section-title">27. ANEXOS</div>
            <p>${tr.anexos}</p>
        </div>
    ` : ''}
    
    <div class="footer">
        <p>Documento gerado em ${new Date().toLocaleDateString('pt-BR')} às ${new Date().toLocaleTimeString('pt-BR')}</p>
        <p>Portal do Fornecedor - Sistema Integrado de Licitações</p>
    </div>
</body>
</html>
                `;
                
                // Criar e baixar arquivo
                const blob = new Blob([conteudoHTML], { type: 'text/html;charset=utf-8' });
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = nomeArquivo;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
                
                this.mostrarNotificacao(`Termo de Referência baixado com sucesso!`, 'success');
            },

            // Abrir formulário de proposta
            abrirFormularioProposta(processoId) {
                const processos = this.obterProcessosFornecedor();
                const processo = processos.find(p => p.processoId === processoId);
                
                if (!processo) return;
                
                // Verificar se já existe proposta ou rascunho
                const propostas = this.obterPropostasFornecedor();
                const propostaExistente = propostas.find(p => p.processoId === processoId);
                
                if (propostaExistente && propostaExistente.status === 'ENVIADA') {
                    this.mostrarNotificacao('Você já enviou uma proposta para este processo. Não é possível enviar outra.', 'warning');
                    return;
                }
                
                this.processoAtual = processo;
                
                // Obter TR para mostrar mais informações
                const tr = this.obterTRDoProcesso(processoId);
                
                document.getElementById('processo-info').innerHTML = `
                    <div class="empresa-info">
                        <h3><i class="fas fa-file-contract"></i> ${processo.numeroProcesso}</h3>
                        <p><strong>Modalidade:</strong> ${processo.modalidade}</p>
                        <p><strong>Objeto:</strong> ${processo.objeto || processo.trTitulo || 'Não informado'}</p>
                        <p><strong>Data Limite:</strong> ${new Date(processo.dataLimite).toLocaleDateString('pt-BR')}</p>
                        ${tr ? `<p><strong>Prazo de Execução Sugerido:</strong> ${tr.prazo || 'Conforme proposta'}</p>` : ''}
                    </div>
                `;
                
                // Se existe rascunho, carregar dados
                if (propostaExistente && propostaExistente.status === 'RASCUNHO') {
                    document.getElementById('prazo-execucao').value = propostaExistente.prazoExecucao || '';
                    document.getElementById('condicoes-pagamento').value = propostaExistente.condicoesPagamento || '';
                    document.getElementById('garantia').value = propostaExistente.garantia || '';
                    document.getElementById('observacoes').value = propostaExistente.observacoes || '';
                    
                    // Guardar ID do rascunho
                    document.getElementById('form-proposta').setAttribute('data-rascunho-id', propostaExistente.id);
                } else {
                    document.getElementById('proposta-existente-aviso').innerHTML = '';
                    document.getElementById('form-proposta').reset();
                    document.getElementById('form-proposta').removeAttribute('data-rascunho-id');
                }
                
                this.abrirModal('modal-enviar-proposta');
            },proposta-existente-aviso').innerHTML = `
                        <div class="proposta-status-box proposta-rascunho">
                            <i class="fas fa-info-circle"></i> Você está editando um rascunho salvo anteriormente
                        </div>
                    `;
                    
                    // Preencher formulário com dados do rascunho
                    document.getElementById('valor-proposta').value = propostaExistente.valor || '';
                    document.getElementById('prazo-execucao').value = propostaExistente.prazoExecucao || '';
                    document.getElementById('condicoes-pagamento').value = propostaExistente.condicoesPagamento || '';
                    document.getElementById('garantia').value = propostaExistente.garantia || '';
                    document.getElementById('observacoes').value = propostaExistente.observacoes || '';
                    
                    // Guardar ID do rascunho
                    document.getElementById('form-proposta').setAttribute('data-rascunho-id', propostaExistente.id);
                } else {
                    document.getElementById('proposta-existente-aviso').innerHTML = '';
                    document.getElementById('form-proposta').reset();
                    document.getElementById('form-proposta').removeAttribute('data-rascunho-id');
                }
                
                this.abrirModal('modal-enviar-proposta');
            },

            // Salvar rascunho da proposta
            async salvarRascunhoProposta() {
                if (!this.validarFormularioProposta()) {
                    this.mostrarNotificacao('Preencha todos os campos obrigatórios antes de salvar o rascunho.', 'warning');
                    return;
                }
                
                const btnSalvar = document.getElementById('btn-salvar-rascunho-proposta');
                btnSalvar.innerHTML = '<span class="loading"></span> Salvando...';
                btnSalvar.disabled = true;
                
                // Simular salvamento
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const rascunhoId = document.getElementById('form-proposta').getAttribute('data-rascunho-id');
                const todasPropostas = SistemaLocal.carregar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, []);
                
                const proposta = {
                    id: rascunhoId || SistemaLocal.gerarId(),
                    processoId: this.processoAtual.processoId,
                    numeroProcesso: this.processoAtual.numeroProcesso,
                    fornecedorEmail: this.fornecedorLogado.email,
                    fornecedorCNPJ: this.fornecedorLogado.cnpj,
                    fornecedorRazaoSocial: this.fornecedorLogado.razaoSocial,
                    valor: document.getElementById('valor-proposta').value,
                    prazoExecucao: document.getElementById('prazo-execucao').value,
                    condicoesPagamento: document.getElementById('condicoes-pagamento').value,
                    observacoes: document.getElementById('observacoes').value,
                    garantia: document.getElementById('garantia').value,
                    dataCriacao: rascunhoId ? 
                        (todasPropostas.find(p => p.id === rascunhoId)?.dataCriacao || new Date().toISOString()) : 
                        new Date().toISOString(),
                    dataAtualizacao: new Date().toISOString(),
                    status: 'RASCUNHO'
                };
                
                // Atualizar ou adicionar proposta
                if (rascunhoId) {
                    const index = todasPropostas.findIndex(p => p.id === rascunhoId);
                    if (index !== -1) {
                        todasPropostas[index] = proposta;
                    }
                } else {
                    todasPropostas.push(proposta);
                    document.getElementById('form-proposta').setAttribute('data-rascunho-id', proposta.id);
                }
                
                SistemaLocal.salvar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, todasPropostas);
                
                this.mostrarNotificacao('Rascunho salvo com sucesso!', 'success');
                
                btnSalvar.innerHTML = '<i class="fas fa-save"></i> Salvar Rascunho';
                btnSalvar.disabled = false;
                
                // Atualizar estatísticas
                this.carregarEstatisticas();
            },

            // Enviar proposta
            async enviarProposta() {
                if (!this.validarFormularioProposta()) return;
                
                // Confirmação antes de enviar
                if (!confirm('Após enviar a proposta, você não poderá mais editá-la. Deseja continuar?')) {
                    return;
                }
                
                const btnEnviar = document.getElementById('btn-enviar-proposta');
                btnEnviar.innerHTML = '<span class="loading"></span> Enviando...';
                btnEnviar.disabled = true;
                
                // Simular envio
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                const rascunhoId = document.getElementById('form-proposta').getAttribute('data-rascunho-id');
                const todasPropostas = SistemaLocal.carregar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, []);
                
                const proposta = {
                    id: rascunhoId || SistemaLocal.gerarId(),
                    processoId: this.processoAtual.processoId,
                    numeroProcesso: this.processoAtual.numeroProcesso,
                    fornecedorEmail: this.fornecedorLogado.email,
                    fornecedorCNPJ: this.fornecedorLogado.cnpj,
                    fornecedorRazaoSocial: this.fornecedorLogado.razaoSocial,
                    valor: document.getElementById('valor-proposta').value,
                    prazoExecucao: document.getElementById('prazo-execucao').value,
                    condicoesPagamento: document.getElementById('condicoes-pagamento').value,
                    observacoes: document.getElementById('observacoes').value,
                    garantia: document.getElementById('garantia').value,
                    dataEnvio: new Date().toISOString(),
                    status: 'ENVIADA'
                };
                
                // Atualizar ou adicionar proposta
                if (rascunhoId) {
                    const index = todasPropostas.findIndex(p => p.id === rascunhoId);
                    if (index !== -1) {
                        todasPropostas[index] = proposta;
                    } else {
                        todasPropostas.push(proposta);
                    }
                } else {
                    todasPropostas.push(proposta);
                }
                
                SistemaLocal.salvar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, todasPropostas);
                
                this.fecharModal('modal-enviar-proposta');
                
                // Mostrar sucesso
                this.mostrarNotificacao('Proposta enviada com sucesso! Você receberá o resultado por e-mail.', 'success');
                
                // Recarregar dados
                this.carregarDados();
                
                btnEnviar.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar Proposta';
                btnEnviar.disabled = false;
            },

            // Enviar rascunho como proposta final
            async enviarRascunho(rascunhoId) {
                const propostas = this.obterPropostasFornecedor();
                const rascunho = propostas.find(p => p.id === rascunhoId);
                
                if (!rascunho || rascunho.status !== 'RASCUNHO') {
                    this.mostrarNotificacao('Rascunho não encontrado.', 'error');
                    return;
                }
                
                if (!confirm('Após enviar a proposta, você não poderá mais editá-la. Deseja continuar?')) {
                    return;
                }
                
                // Atualizar status do rascunho para enviado
                const todasPropostas = SistemaLocal.carregar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, []);
                const index = todasPropostas.findIndex(p => p.id === rascunhoId);
                
                if (index !== -1) {
                    todasPropostas[index].status = 'ENVIADA';
                    todasPropostas[index].dataEnvio = new Date().toISOString();
                    
                    SistemaLocal.salvar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, todasPropostas);
                    
                    this.mostrarNotificacao('Proposta enviada com sucesso!', 'success');
                    this.carregarDados();
                }
            },

            // Excluir rascunho
            excluirRascunho(rascunhoId) {
                if (!confirm('Deseja realmente excluir este rascunho?')) {
                    return;
                }
                
                const todasPropostas = SistemaLocal.carregar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, []);
                const propostasAtualizadas = todasPropostas.filter(p => p.id !== rascunhoId);
                
                SistemaLocal.salvar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, propostasAtualizadas);
                
                this.mostrarNotificacao('Rascunho excluído com sucesso!', 'success');
                this.carregarDados();
            },

            // Validar formulário de proposta
            validarFormularioProposta() {
                let valido = true;
                
                // Valor
                const valor = document.getElementById('valor-proposta');
                if (!valor.value || parseFloat(valor.value) <= 0) {
                    valor.classList.add('error');
                    valido = false;
                } else {
                    valor.classList.remove('error');
                }
                
                // Prazo
                const prazo = document.getElementById('prazo-execucao');
                if (!prazo.value || parseInt(prazo.value) <= 0) {
                    prazo.classList.add('error');
                    valido = false;
                } else {
                    prazo.classList.remove('error');
                }
                
                // Condições
                const condicoes = document.getElementById('condicoes-pagamento');
                if (!condicoes.value) {
                    condicoes.classList.add('error');
                    valido = false;
                } else {
                    condicoes.classList.remove('error');
                }
                
                return valido;
            },

            // Ver detalhes da proposta
            verDetalhesProposta(propostaId) {
                const propostas = this.obterPropostasFornecedor();
                const proposta = propostas.find(p => p.id === propostaId);
                
                if (!proposta) return;
                
                let statusInfo = '';
                switch(proposta.status) {
                    case 'RASCUNHO':
                        statusInfo = '<span style="color: #6c757d; font-weight: bold;"><i class="fas fa-save"></i> RASCUNHO</span>';
                        break;
                    case 'ACEITA':
                        statusInfo = '<span style="color: #48bb78; font-weight: bold;"><i class="fas fa-check-circle"></i> ACEITA</span>';
                        break;
                    case 'REJEITADA':
                        statusInfo = '<span style="color: #f56565; font-weight: bold;"><i class="fas fa-times-circle"></i> REJEITADA</span>';
                        break;
                    case 'EM_ANALISE':
                        statusInfo = '<span style="color: #ed8936; font-weight: bold;"><i class="fas fa-clock"></i> EM ANÁLISE</span>';
                        break;
                    default:
                        statusInfo = '<span style="color: #4299e1; font-weight: bold;"><i class="fas fa-paper-plane"></i> ENVIADA</span>';
                }
                
                document.getElementById('detalhes-proposta-content').innerHTML = `
                    <div class="empresa-info">
                        <h3><i class="fas fa-file-contract"></i> ${proposta.numeroProcesso}</h3>
                        <div class="info-item">
                            <span class="info-label">Status:</span>
                            <span class="info-value">${statusInfo}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Valor da Proposta:</span>
                            <span class="info-value" style="font-size: 20px; color: #667eea; font-weight: bold;">
                                R$ ${this.formatarMoeda(proposta.valor)}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Prazo de Execução:</span>
                            <span class="info-value">${proposta.prazoExecucao} dias</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Condições de Pagamento:</span>
                            <span class="info-value">${proposta.condicoesPagamento}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Data de ${proposta.status === 'RASCUNHO' ? 'Criação' : 'Envio'}:</span>
                            <span class="info-value">${new Date(proposta.dataEnvio || proposta.dataCriacao).toLocaleDateString('pt-BR')} às ${new Date(proposta.dataEnvio || proposta.dataCriacao).toLocaleTimeString('pt-BR')}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Garantia Oferecida:</span>
                            <span class="info-value">${proposta.garantia || 'Não informada'}</span>
                        </div>
                    </div>
                    
                    ${proposta.observacoes ? `
                        <div class="empresa-info">
                            <h3><i class="fas fa-comment"></i> Observações Técnicas</h3>
                            <p style="color: #718096; line-height: 1.6;">${proposta.observacoes}</p>
                        </div>
                    ` : ''}
                    
                    ${proposta.feedbackComprador ? `
                        <div class="empresa-info">
                            <h3><i class="fas fa-comment-alt"></i> Feedback do Comprador</h3>
                            <p style="color: #4a5568; line-height: 1.6;">${proposta.feedbackComprador}</p>
                            ${proposta.dataFeedback ? `
                                <p style="font-size: 14px; color: #718096; margin-top: 15px;">
                                    <i class="fas fa-calendar"></i> ${new Date(proposta.dataFeedback).toLocaleDateString('pt-BR')} às ${new Date(proposta.dataFeedback).toLocaleTimeString('pt-BR')}</p>
                            ` : ''}
                        </div>
                    ` : ''}
                    
                    <div style="text-align: right; margin-top: 40px;">
                        <button class="btn btn-secondary" onclick="Sistema.fecharModal('modal-detalhes-proposta')">
                            <i class="fas fa-times"></i> Fechar
                        </button>
                    </div>
                `;
                
                this.abrirModal('modal-detalhes-proposta');
            },

            // Editar proposta (apenas rascunhos)
            editarProposta(propostaId) {
                const propostas = this.obterPropostasFornecedor();
                const proposta = propostas.find(p => p.id === propostaId);
                
                if (!proposta || proposta.status !== 'RASCUNHO') {
                    this.mostrarNotificacao('Apenas rascunhos podem ser editados.', 'error');
                    return;
                }
                
                this.propostaEditando = proposta;
                
                // Preencher formulário
                document.getElementById('editar-processo-info').innerHTML = `
                    <div class="empresa-info">
                        <h3><i class="fas fa-file-contract"></i> ${proposta.numeroProcesso}</h3>
                        <p><strong>Status Atual:</strong> RASCUNHO</p>
                    </div>
                `;
                
                document.getElementById('editar-valor-proposta').value = proposta.valor;
                document.getElementById('editar-prazo-execucao').value = proposta.prazoExecucao;
                document.getElementById('editar-condicoes-pagamento').value = proposta.condicoesPagamento;
                document.getElementById('editar-garantia').value = proposta.garantia || '';
                document.getElementById('editar-observacoes').value = proposta.observacoes || '';
                
                this.abrirModal('modal-editar-proposta');
            },

            // Salvar edição da proposta
            async salvarEdicaoProposta() {
                const propostas = SistemaLocal.carregar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, []);
                const index = propostas.findIndex(p => p.id === this.propostaEditando.id);
                
                if (index === -1) return;
                
                // Atualizar dados
                propostas[index].valor = document.getElementById('editar-valor-proposta').value;
                propostas[index].prazoExecucao = document.getElementById('editar-prazo-execucao').value;
                propostas[index].condicoesPagamento = document.getElementById('editar-condicoes-pagamento').value;
                propostas[index].garantia = document.getElementById('editar-garantia').value;
                propostas[index].observacoes = document.getElementById('editar-observacoes').value;
                propostas[index].dataAtualizacao = new Date().toISOString();
                
                SistemaLocal.salvar(SistemaLocal.CHAVES.PROPOSTAS_FORNECEDORES, propostas);
                
                this.fecharModal('modal-editar-proposta');
                this.mostrarNotificacao('Rascunho atualizado com sucesso!', 'success');
                this.carregarPropostas();
            },

            // Mostrar seção
            mostrarSecao(secao) {
                // Remover classe active de todos os nav-items
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Adicionar classe active ao item clicado
                document.querySelector(`[data-section="${secao}"]`).classList.add('active');
                
                // Esconder todas as seções
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Mostrar seção selecionada
                document.getElementById(secao).classList.add('active');
                
                // Recarregar dados se necessário
                switch(secao) {
                    case 'dashboard':
                        this.carregarEstatisticas();
                        break;
                    case 'processos':
                        this.carregarProcessos();
                        break;
                    case 'propostas':
                        this.carregarPropostas();
                        break;
                    case 'historico':
                        this.carregarHistorico();
                        break;
                    case 'perfil':
                        this.carregarPerfil();
                        break;
                }
            },

            // Funções auxiliares
            abrirModal(modalId) {
                document.getElementById(modalId).style.display = 'block';
            },

            fecharModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            },

            mostrarAlerta(elementId, mensagem, tipo) {
                const alert = document.getElementById(elementId);
                alert.textContent = mensagem;
                alert.className = `alert alert-${tipo}`;
                alert.style.display = 'block';
                
                setTimeout(() => {
                    alert.style.display = 'none';
                }, 5000);
            },

            mostrarNotificacao(mensagem, tipo = 'info') {
                // Criar notificação
                const notificacao = document.createElement('div');
                notificacao.className = `alert alert-${tipo}`;
                notificacao.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    max-width: 400px;
                    z-index: 9999;
                    animation: slideIn 0.3s ease;
                `;
                
                // Ícone baseado no tipo
                let icone = 'fas fa-info-circle';
                if (tipo === 'success') icone = 'fas fa-check-circle';
                if (tipo === 'error') icone = 'fas fa-exclamation-circle';
                if (tipo === 'warning') icone = 'fas fa-exclamation-triangle';
                
                notificacao.innerHTML = `<i class="${icone}"></i> ${mensagem}`;
                document.body.appendChild(notificacao);
                
                // Remover após 5 segundos
                setTimeout(() => {
                    notificacao.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        document.body.removeChild(notificacao);
                    }, 300);
                }, 5000);
            },

            formatarMoeda(valor) {
                return parseFloat(valor).toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            },

            formatarCNPJ(cnpj) {
                return cnpj.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/, '$1.$2.$3/$4-$5');
            },

            logout() {
                if (confirm('Deseja realmente sair do sistema?')) {
                    // Limpar dados do localStorage
                    localStorage.removeItem(SistemaLocal.CHAVES.FORNECEDOR_LOGADO);
                    
                    // Redirecionar para a página de autenticação
                    window.location.href = 'https://portal-proposta.onrender.com/static/sistema-autenticacao-fornecedores.html';
                }
            }
        };

        // Inicializar sistema quando a página carregar
        window.addEventListener('load', () => {
            Sistema.init();
        });

        // Adicionar animações CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOut {
                from { opacity: 1; transform: translateX(0); }
                to { opacity: 0; transform: translateX(100%); }
            }
        `;
        document.head.appendChild(style);

        console.log('Portal do Fornecedor v4.0 - Sistema integrado com visualização e download de TR completo melhorados');
    </script>
</body>
</html>
