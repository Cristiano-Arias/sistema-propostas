<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o de Propostas</title>
    <script>
        // Configura√ß√£o da API
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:5000' 
            : window.location.origin;
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            width: 260px;
            background: #f8f9fa;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            padding: 20px;
            overflow-y: auto;
        }

        .nav-item {
            display: block;
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 8px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            text-align: left;
            transition: all 0.3s;
            color: #333;
            text-decoration: none;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
            border-left-color: #667eea;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            border-left-color: #764ba2;
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .page {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .page.active {
            display: block;
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 16px;
            opacity: 0.9;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        /* Novo estilo para cards de processo */
        .processo-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
            transition: all 0.3s;
            position: relative;
        }

        .processo-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .processo-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .processo-info {
            flex: 1;
        }

        .processo-titulo {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .processo-numero {
            color: #667eea;
            font-size: 14px;
            font-weight: 600;
        }

        .processo-status {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-ativo {
            background: #d4edda;
            color: #155724;
        }

        .status-encerrado {
            background: #f8d7da;
            color: #721c24;
        }

        .processo-detalhes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .detalhe-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detalhe-label {
            font-weight: 600;
            color: #6c757d;
            font-size: 13px;
        }

        .detalhe-valor {
            color: #2c3e50;
            font-size: 14px;
        }

        .processo-acoes {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .processo-stats {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-item-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-item-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        /* Filtros */
        .filtros-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filtro-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filtro-item label {
            font-size: 12px;
            font-weight: 600;
            color: #6c757d;
        }

        .filtro-item select,
        .filtro-item input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
        }

        /* Tabela de propostas dentro do processo */
        .propostas-processo {
            margin-top: 20px;
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .propostas-processo.active {
            display: block;
        }

        .propostas-table {
            width: 100%;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .propostas-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: #6c757d;
            border-bottom: 2px solid #dee2e6;
        }

        .propostas-table td {
            padding: 12px;
            border-bottom: 1px solid #f1f3f5;
            font-size: 14px;
        }

        .propostas-table tr:hover {
            background: #f8f9fa;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state img {
            width: 100px;
            opacity: 0.5;
            margin-bottom: 20px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 20px;
        }

        .modal-close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .modal-close:hover {
            background: rgba(255,255,255,0.2);
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .copy-link-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .copy-link-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .sync-info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sync-status {
            font-weight: bold;
        }

        /* Gr√°ficos do Dashboard */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .chart-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .mini-chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            padding: 10px;
        }

        .chart-bar {
            width: 30px;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: all 0.3s;
        }

        .chart-bar:hover {
            opacity: 0.8;
        }

        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            white-space: nowrap;
        }

        .chart-bar-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: bold;
        }

        /* Lista de atividades */
        .activity-list {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f1f3f5;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            background: #f8f9fa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 3px;
        }

        .activity-time {
            font-size: 12px;
            color: #6c757d;
        }

        /* Notifica√ß√µes */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            min-width: 300px;
            display: none;
            z-index: 2000;
        }

        .notification.success {
            border-left: 5px solid #28a745;
        }

        .notification.error {
            border-left: 5px solid #dc3545;
        }

        .notification.info {
            border-left: 5px solid #17a2b8;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 14px;
            color: #6c757d;
        }

        /* Tabela de todas as propostas */
        .all-proposals-table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .all-proposals-table th {
            background: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .all-proposals-table td {
            padding: 15px;
            border-bottom: 1px solid #f1f3f5;
        }

        .all-proposals-table tr:hover {
            background: #f8f9fa;
        }

        /* Lista de usu√°rios */
        .user-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .user-info p {
            color: #6c757d;
            font-size: 14px;
            margin: 2px 0;
        }

        .user-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-admin {
            background: #6f42c1;
            color: white;
        }

        .badge-comprador {
            background: #007bff;
            color: white;
        }

        .badge-fornecedor {
            background: #28a745;
            color: white;
        }

        /* CSS para o fluxo integrado */
        .tr-card, .processo-grupo {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tr-card {
            transition: all 0.3s;
        }

        .tr-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-warning {
            background: #ffc107;
            color: #212529;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .processo-grupo {
            border: 2px solid #e0e0e0;
        }

        .propostas-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .proposta-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .valor-comercial {
            font-weight: bold;
            color: #28a745;
        }

        /* Indicador de fluxo */
        .fluxo-indicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .fluxo-step {
            text-align: center;
            flex: 1;
            position: relative;
        }

        .fluxo-step:not(:last-child)::after {
            content: '‚Üí';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            color: #6c757d;
        }

        .fluxo-step.active {
            color: #667eea;
            font-weight: bold;
        }

        .fluxo-step.completed {
            color: #28a745;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                display: flex;
                overflow-x: auto;
                padding: 10px;
            }
            
            .nav-item {
                min-width: 120px;
                margin-right: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .processo-acoes {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                text-align: center;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script src="auth.js"></script>
</head>
<body>
    <div class="header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1>üè¢ Sistema de Gest√£o de Propostas</h1>
                <p>Gerencie processos licitat√≥rios e propostas de forma integrada</p>
            </div>
            <div id="infoUsuario" style="background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 8px;"></div>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <nav id="menuNavegacao">
                <!-- Menu ser√° gerado dinamicamente -->
            </nav>
        </div>

        <div class="main-content" id="main-content">
            <!-- Dashboard -->
            <div id="dashboard" class="page active">
                <h2>üìä Dashboard</h2>
                
                <div class="sync-info">
                    <span>üîÑ</span>
                    <span>Status da Sincroniza√ß√£o: <span class="sync-status" id="syncStatus">Conectado</span></span>
                    <span>| √öltima atualiza√ß√£o: <span id="lastSync">Agora</span></span>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProcessos">0</div>
                        <div class="stat-label">Processos Ativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalPropostas">0</div>
                        <div class="stat-label">Propostas Recebidas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="processosHoje">0</div>
                        <div class="stat-label">Vence Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="valorTotal">R$ 0</div>
                        <div class="stat-label">Valor Total em Propostas</div>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-box">
                        <h3 class="chart-title">üìä Propostas por Processo</h3>
                        <div class="mini-chart" id="chartPropostas"></div>
                    </div>
                    <div class="chart-box">
                        <h3 class="chart-title">üìà Processos por Status</h3>
                        <div class="mini-chart" id="chartStatus"></div>
                    </div>
                </div>

                <div class="recent-activities" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">üìÖ Atividades Recentes</h3>
                    <div class="activity-list" id="atividadesRecentes"></div>
                </div>
            </div>

            <!-- Processos -->
            <div id="processos" class="page">
                <h2>üìã Processos Cadastrados</h2>
                
                <div class="filtros-container">
                    <div class="filtro-item">
                        <label>Status</label>
                        <select id="filtroStatus" onchange="filtrarProcessos()">
                            <option value="todos">Todos</option>
                            <option value="ativo">Ativos</option>
                            <option value="encerrado">Encerrados</option>
                        </select>
                    </div>
                    <div class="filtro-item">
                        <label>Modalidade</label>
                        <select id="filtroModalidade" onchange="filtrarProcessos()">
                            <option value="todos">Todas</option>
                            <option value="Preg√£o">Preg√£o</option>
                            <option value="Concorr√™ncia">Concorr√™ncia</option>
                            <option value="Tomada de Pre√ßos">Tomada de Pre√ßos</option>
                            <option value="Convite">Convite</option>
                        </select>
                    </div>
                    <div class="filtro-item">
                        <label>Buscar</label>
                        <input type="text" id="filtroBusca" placeholder="N√∫mero ou objeto..." onkeyup="filtrarProcessos()">
                    </div>
                </div>
                
                <div id="listaProcessos"></div>
            </div>

            <!-- Cadastrar -->
            <div id="cadastrar" class="page">
                <h2>‚ûï Cadastrar Novo Processo</h2>
                
                <form id="formProcesso">
                    <div class="form-group">
                        <label>N√∫mero do Processo *</label>
                        <input type="text" id="numeroProc" required placeholder="Ex: LIC-2025-001">
                    </div>
                    
                    <div class="form-group">
                        <label>Objeto *</label>
                        <textarea id="objetoProc" rows="3" required placeholder="Descreva o objeto da licita√ß√£o"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Modalidade *</label>
                        <select id="modalidade" required>
                            <option value="">Selecione...</option>
                            <option value="Preg√£o">Preg√£o</option>
                            <option value="Concorr√™ncia">Concorr√™ncia</option>
                            <option value="Tomada de Pre√ßos">Tomada de Pre√ßos</option>
                            <option value="Convite">Convite</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Data e Hora Limite *</label>
                        <input type="datetime-local" id="prazoProc" required>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notificarFornecedores" style="width: auto; margin-right: 10px;">
                            Notificar fornecedores cadastrados por e-mail
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Cadastrar Processo</button>
                </form>
            </div>

            <!-- Todas as Propostas -->
            <div id="propostas" class="page">
                <h2>üìù Todas as Propostas Recebidas</h2>
                <div id="todasPropostas"></div>
            </div>

            <!-- Relat√≥rios -->
            <div id="relatorios" class="page">
                <h2>üìà Relat√≥rios</h2>
                
                <div class="alert alert-info" style="background: #d1ecf1; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>Relat√≥rios Dispon√≠veis:</strong>
                    <ul style="margin-top: 10px; margin-left: 20px;">
                        <li>Propostas por Processo</li>
                        <li>An√°lise de Valores</li>
                        <li>Hist√≥rico de Fornecedores</li>
                        <li>Estat√≠sticas Gerais</li>
                    </ul>
                </div>
                
                <button class="btn btn-primary" onclick="gerarRelatorioGeral()">
                    üìä Gerar Relat√≥rio Geral
                </button>
                
                <div id="conteudoRelatorio" style="margin-top: 30px;"></div>
            </div>
            
            <!-- Gerenciar Usu√°rios (Admin Only) -->
            <div id="usuarios" class="page">
                <h2>üë• Gerenciar Usu√°rios</h2>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="window.location.href='cadastro-comprador.html'">
                        ‚ûï Cadastrar Novo Comprador
                    </button>
                    <button class="btn btn-success" onclick="window.location.href='cadastro-fornecedor.html'">
                        ‚ûï Cadastrar Novo Fornecedor
                    </button>
                </div>
                
                <div id="listaUsuarios">
                    <!-- Lista ser√° preenchida dinamicamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal do Processo -->
    <div id="modalProcesso" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitulo">Detalhes do Processo</h3>
                <button class="modal-close" onclick="fecharModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalConteudo">
                <!-- Conte√∫do ser√° preenchido dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Sistema de Notifica√ß√µes -->
    <div id="notification" class="notification">
        <div class="notification-title" id="notificationTitle"></div>
        <div class="notification-message" id="notificationMessage"></div>
    </div>

    <script>
        // Vari√°vel global para o usu√°rio
        let usuarioAtual = null;
        
        // Dados do sistema
        let processos = [];
        let propostas = [];
        let usuarios = [];
        
        // Verificar autentica√ß√£o e inicializar
        window.addEventListener('DOMContentLoaded', function() {
            usuarioAtual = Auth.verificarAutenticacao(['admin', 'comprador']);
            
            if (usuarioAtual) {
                Auth.exibirInfoUsuario();
                Auth.protegerElementos();
                gerarMenuDinamico();
                
                // Prote√ß√£o de dados comerciais para requisitantes
                if (usuarioAtual.nivelAcesso === 'requisitante') {
                    // Ocultar elementos com classe valor-comercial
                    document.querySelectorAll('.valor-comercial').forEach(el => {
                        el.style.display = 'none';
                    });
                    
                    // Substituir por mensagem
                    document.querySelectorAll('[data-comercial="true"]').forEach(el => {
                        el.innerHTML = '<span style="color: #6c757d;">üîí Acesso Restrito</span>';
                    });
                }
                
                // Carregar dados iniciais
                carregarDados();
                
                // Sincronizar com API ao iniciar
                sincronizarPropostas();
                
                // Configurar formul√°rio
                document.getElementById('formProcesso').addEventListener('submit', cadastrarProcesso);
                
                // Atualizar a cada 30 segundos
                setInterval(() => {
                    sincronizarPropostas();
                    verificarNovasPropostas();
                }, 30000);
            }
        });
        
        // Fun√ß√£o para gerar menu din√¢mico baseado no tipo de usu√°rio e respeitando o fluxo
        function gerarMenuDinamico() {
            const menu = document.getElementById('menuNavegacao');
            menu.innerHTML = '';
            
            const usuario = usuarioAtual;
            let menuItems = [];
            
            // Menu para ADMIN - v√™ tudo
            if (usuario.tipo === 'admin') {
                menuItems = [
                    { id: 'dashboard', icon: 'üìä', label: 'Dashboard Geral', permissao: null },
                    
                    // Fluxo Requisitante
                    { separator: true, label: 'FASE 1 - REQUISI√á√ÉO' },
                    { id: 'criar-tr', icon: 'üìù', label: 'Criar Termo de Refer√™ncia', url: 'modulo-termo-referencia-seguro.html' },
                    { id: 'meus-trs', icon: 'üìÑ', label: 'Meus TRs', onclick: 'mostrarMeusTRs' },
                    
                    // Fluxo Comprador
                    { separator: true, label: 'FASE 2 - LICITA√á√ÉO' },
                    { id: 'trs-pendentes', icon: '‚è≥', label: 'TRs Aguardando An√°lise', onclick: 'mostrarTRsPendentes' },
                    { id: 'processos', icon: 'üìã', label: 'Processos/Concorr√™ncias', permissao: null },
                    { id: 'cadastrar', icon: '‚ûï', label: 'Criar Concorr√™ncia', permissao: 'criar_processo' },
                    
                    // An√°lise de Propostas
                    { separator: true, label: 'FASE 3 - AN√ÅLISE' },
                    { id: 'propostas', icon: 'üìù', label: 'Propostas Recebidas', permissao: null },
                    { id: 'analise-tecnica', icon: 'üîç', label: 'Enviar para An√°lise T√©cnica', onclick: 'enviarAnaliseTecnica' },
                    { id: 'pareceres', icon: '‚úÖ', label: 'Pareceres T√©cnicos', onclick: 'mostrarPareceres' },
                    
                    // Relat√≥rios e Admin
                    { separator: true, label: 'GEST√ÉO' },
                    { id: 'relatorios', icon: 'üìà', label: 'Relat√≥rios', permissao: 'gerar_relatorios' },
                    { id: 'usuarios', icon: 'üë•', label: 'Usu√°rios', permissao: 'gerenciar_usuarios' }
                ];
            }
            
            // Menu para REQUISITANTE
            else if (usuario.tipo === 'comprador' && usuario.nivelAcesso === 'requisitante') {
                menuItems = [
                    { id: 'dashboard-requisitante', icon: 'üë®‚Äçüíº', label: 'Meu Painel', url: 'dashboard-requisitante-seguro.html' },
                    
                    { separator: true, label: 'CRIAR REQUISI√á√ïES' },
                    { id: 'criar-tr', icon: 'üìù', label: 'Novo Termo de Refer√™ncia', url: 'modulo-termo-referencia-seguro.html' },
                    { id: 'meus-trs', icon: 'üìÑ', label: 'Meus TRs', onclick: 'mostrarMeusTRs' },
                    
                    { separator: true, label: 'AN√ÅLISES T√âCNICAS' },
                    { id: 'propostas-tecnicas', icon: 'üîç', label: 'Propostas para An√°lise', onclick: 'mostrarPropostasTecnicas' },
                    { id: 'meus-pareceres', icon: '‚úÖ', label: 'Meus Pareceres', onclick: 'mostrarMeusPareceres' }
                ];
            }
            
            // Menu para COMPRADOR
            else if (usuario.tipo === 'comprador') {
                menuItems = [
                    { id: 'dashboard-comprador', icon: 'üõí', label: 'Meu Painel', url: 'dashboard-comprador.html' },
                    
                    { separator: true, label: 'TRs RECEBIDOS' },
                    { id: 'trs-pendentes', icon: '‚è≥', label: 'TRs para An√°lise', onclick: 'mostrarTRsPendentes' },
                    
                    { separator: true, label: 'CONCORR√äNCIAS' },
                    { id: 'processos', icon: 'üìã', label: 'Minhas Concorr√™ncias', permissao: null },
                    { id: 'criar-concorrencia', icon: '‚ûï', label: 'Criar Concorr√™ncia de TR', onclick: 'criarConcorrenciaDeTR' },
                    
                    { separator: true, label: 'PROPOSTAS' },
                    { id: 'propostas', icon: 'üìù', label: 'Propostas Recebidas', permissao: null },
                    { id: 'enviar-analise', icon: 'üì§', label: 'Enviar p/ An√°lise T√©cnica', onclick: 'prepararAnaliseTecnica' },
                    { id: 'pareceres-recebidos', icon: 'üì•', label: 'Pareceres Recebidos', onclick: 'mostrarPareceresRecebidos' },
                    
                    { separator: true, label: 'RELAT√ìRIOS' },
                    { id: 'relatorios', icon: 'üìà', label: 'Relat√≥rios', permissao: 'gerar_relatorios' }
                ];
            }
            
            // Renderizar menu
            let lastWasSeparator = false;
            menuItems.forEach((item, index) => {
                // Se for separador
                if (item.separator) {
                    if (!lastWasSeparator) { // Evita separadores duplos
                        const separator = document.createElement('div');
                        separator.style.cssText = `
                            padding: 15px 16px 8px 16px;
                            font-size: 11px;
                            color: #6c757d;
                            font-weight: 700;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                            margin-top: ${index > 0 ? '20px' : '0'};
                            border-top: ${index > 0 ? '1px solid #e0e0e0' : 'none'};
                            padding-top: ${index > 0 ? '20px' : '15px'};
                        `;
                        separator.textContent = item.label;
                        menu.appendChild(separator);
                        lastWasSeparator = true;
                    }
                    return;
                }
                
                lastWasSeparator = false;
                
                // Verificar permiss√£o
                if (item.permissao && !Auth.temPermissao(item.permissao)) {
                    return;
                }
                
                const navItem = document.createElement('button');
                navItem.className = 'nav-item';
                navItem.innerHTML = `${item.icon} ${item.label}`;
                
                if (item.url) {
                    navItem.onclick = () => window.location.href = item.url;
                } else if (item.onclick) {
                    navItem.onclick = () => window[item.onclick]();
                } else {
                    navItem.onclick = () => mostrarPagina(item.id);
                }
                
                menu.appendChild(navItem);
            });
        }
        
        // Mostrar p√°gina espec√≠fica
        function mostrarPagina(paginaId) {
            // Esconder todas as p√°ginas
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remover active de todos os itens do menu
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Mostrar p√°gina selecionada
            document.getElementById(paginaId).classList.add('active');
            
            // Marcar item do menu como ativo
            const menuItems = document.querySelectorAll('.nav-item');
            menuItems.forEach((item, index) => {
                if (item.textContent.toLowerCase().includes(paginaId) || 
                    (paginaId === 'dashboard' && index === 0)) {
                    item.classList.add('active');
                }
            });
            
            // Carregar conte√∫do espec√≠fico da p√°gina
            if (paginaId === 'usuarios') {
                carregarUsuarios();
            }
        }
        
        // NOVAS FUN√á√ïES PARA O FLUXO INTEGRADO
        
        // Mostrar TRs do requisitante
        function mostrarMeusTRs() {
            const container = document.getElementById('main-content');
            container.innerHTML = `
                <div class="page active">
                    <h2>üìÑ Meus Termos de Refer√™ncia</h2>
                    <div id="lista-trs"></div>
                </div>
            `;
            
            // Carregar TRs do usu√°rio
            carregarTRsUsuario();
        }
        
        // Mostrar TRs pendentes para o comprador
        function mostrarTRsPendentes() {
            const container = document.getElementById('main-content');
            container.innerHTML = `
                <div class="page active">
                    <h2>‚è≥ TRs Aguardando An√°lise</h2>
                    <div class="alert alert-info">
                        Termos de Refer√™ncia enviados pelos requisitantes aguardando sua an√°lise para criar concorr√™ncia.
                    </div>
                    <div id="lista-trs-pendentes"></div>
                </div>
            `;
            
            carregarTRsPendentes();
        }
        
        // Criar concorr√™ncia a partir de TR
        function criarConcorrenciaDeTR() {
            const container = document.getElementById('main-content');
            container.innerHTML = `
                <div class="page active">
                    <h2>‚ûï Criar Concorr√™ncia de TR Aprovado</h2>
                    <div class="form-section">
                        <h3>Selecione o TR base:</h3>
                        <select id="tr-base" class="form-control" onchange="preencherDadosTR()">
                            <option value="">Selecione um TR aprovado...</option>
                        </select>
                        
                        <div id="form-concorrencia" style="display: none; margin-top: 20px;">
                            <!-- Formul√°rio ser√° preenchido com dados do TR -->
                        </div>
                    </div>
                </div>
            `;
            
            carregarTRsAprovados();
        }
        
        // Preparar envio para an√°lise t√©cnica
        function prepararAnaliseTecnica() {
            const container = document.getElementById('main-content');
            container.innerHTML = `
                <div class="page active">
                    <h2>üì§ Enviar Propostas para An√°lise T√©cnica</h2>
                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è Importante:</strong> O requisitante receber√° APENAS a proposta t√©cnica, sem acesso aos valores comerciais.
                    </div>
                    <div id="propostas-para-analise"></div>
                </div>
            `;
            
            carregarPropostasParaAnalise();
        }
        
        // Mostrar propostas t√©cnicas (para requisitante)
        function mostrarPropostasTecnicas() {
            const container = document.getElementById('main-content');
            container.innerHTML = `
                <div class="page active">
                    <h2>üîç Propostas T√©cnicas para An√°lise</h2>
                    <div class="alert alert-info">
                        <strong>‚ÑπÔ∏è Acesso Restrito:</strong> Voc√™ tem acesso apenas √†s informa√ß√µes t√©cnicas das propostas.
                    </div>
                    <div id="propostas-tecnicas-lista"></div>
                </div>
            `;
            
            carregarPropostasTecnicasParaRequisitante();
        }
        
        // FUN√á√ïES DE INTEGRA√á√ÉO COM API
        
        async function carregarTRsUsuario() {
            try {
                const usuario = Auth.getUsuarioAtual();
                const response = await fetch(`${API_URL}/api/trs?user_id=${usuario.usuarioId}`);
                const data = await response.json();
                
                if (data.success) {
                    renderizarListaTRs(data.trs, 'lista-trs');
                }
            } catch (error) {
                console.error('Erro ao carregar TRs:', error);
            }
        }
        
        async function carregarTRsPendentes() {
            try {
                const response = await fetch(`${API_URL}/api/trs?status=pendente_analise`);
                const data = await response.json();
                
                if (data.success) {
                    renderizarTRsPendentes(data.trs);
                }
            } catch (error) {
                console.error('Erro ao carregar TRs pendentes:', error);
            }
        }
        
        async function carregarPropostasParaAnalise() {
            try {
                const response = await fetch(`${API_URL}/api/propostas/para-analise`);
                const data = await response.json();
                
                if (data.success) {
                    renderizarPropostasParaAnalise(data.propostas);
                }
            } catch (error) {
                console.error('Erro ao carregar propostas:', error);
            }
        }
        
        // FUN√á√ïES DE RENDERIZA√á√ÉO
        
        function renderizarTRsPendentes(trs) {
            const container = document.getElementById('lista-trs-pendentes');
            
            if (trs.length === 0) {
                container.innerHTML = '<p>Nenhum TR pendente de an√°lise.</p>';
                return;
            }
            
            container.innerHTML = trs.map(tr => `
                <div class="tr-card" style="border-left: 4px solid #ffc107;">
                    <div class="tr-header">
                        <h4>${tr.titulo}</h4>
                        <span class="badge badge-warning">Pendente An√°lise</span>
                    </div>
                    <div class="tr-info">
                        <p><strong>Requisitante:</strong> ${tr.criado_por}</p>
                        <p><strong>Data:</strong> ${new Date(tr.criado_em).toLocaleDateString('pt-BR')}</p>
                        <p><strong>Objetivo:</strong> ${tr.objetivo}</p>
                    </div>
                    <div class="tr-actions">
                        <button class="btn btn-primary" onclick="analisarTR('${tr.id}')">
                            üìã Analisar TR
                        </button>
                        <button class="btn btn-success" onclick="aprovarTR('${tr.id}')">
                            ‚úÖ Aprovar e Criar Concorr√™ncia
                        </button>
                        <button class="btn btn-danger" onclick="rejeitarTR('${tr.id}')">
                            ‚ùå Solicitar Revis√£o
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function renderizarPropostasParaAnalise(propostas) {
            const container = document.getElementById('propostas-para-analise');
            
            // Agrupar por processo
            const propostasPorProcesso = {};
            propostas.forEach(proposta => {
                if (!propostasPorProcesso[proposta.processo]) {
                    propostasPorProcesso[proposta.processo] = [];
                }
                propostasPorProcesso[proposta.processo].push(proposta);
            });
            
            container.innerHTML = Object.entries(propostasPorProcesso).map(([processo, props]) => `
                <div class="processo-grupo">
                    <h3>Processo: ${processo}</h3>
                    <div class="propostas-list">
                        ${props.map(proposta => `
                            <div class="proposta-card">
                                <h4>${proposta.empresa}</h4>
                                <div class="proposta-info">
                                    <p><strong>Protocolo:</strong> ${proposta.protocolo}</p>
                                    <p><strong>Data:</strong> ${new Date(proposta.data).toLocaleDateString('pt-BR')}</p>
                                    <p><strong>Valor Total:</strong> <span class="valor-comercial">R$ ${proposta.valor}</span></p>
                                </div>
                                <label>
                                    <input type="checkbox" value="${proposta.protocolo}" name="propostas-enviar">
                                    Enviar para an√°lise t√©cnica
                                </label>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn btn-primary" onclick="enviarPropostasAnaliseTecnica('${processo}')">
                        üì§ Enviar Propostas Selecionadas para Requisitante
                    </button>
                </div>
            `).join('');
        }
        
        // FUN√á√ïES DE A√á√ÉO
        
        async function aprovarTR(trId) {
            if (!confirm('Deseja aprovar este TR e criar uma concorr√™ncia?')) return;
            
            try {
                // Atualizar status do TR
                const response = await fetch(`${API_URL}/api/trs/${trId}/aprovar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        aprovado_por: Auth.getUsuarioAtual().usuarioId,
                        data_aprovacao: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    alert('TR aprovado! Redirecionando para criar concorr√™ncia...');
                    // Redirecionar para criar concorr√™ncia com TR pr√©-selecionado
                    window.location.href = `#criar-concorrencia?tr=${trId}`;
                }
            } catch (error) {
                console.error('Erro ao aprovar TR:', error);
                alert('Erro ao aprovar TR');
            }
        }
        
        async function enviarPropostasAnaliseTecnica(processo) {
            const checkboxes = document.querySelectorAll('input[name="propostas-enviar"]:checked');
            const protocolos = Array.from(checkboxes).map(cb => cb.value);
            
            if (protocolos.length === 0) {
                alert('Selecione pelo menos uma proposta para enviar');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/propostas/enviar-analise-tecnica`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        processo: processo,
                        protocolos: protocolos,
                        enviado_por: Auth.getUsuarioAtual().usuarioId
                    })
                });
                
                if (response.ok) {
                    alert('Propostas enviadas para an√°lise t√©cnica!');
                    // Notificar requisitante
                    notificarRequisitante(processo);
                }
            } catch (error) {
                console.error('Erro ao enviar propostas:', error);
            }
        }
        
        // Carregar dados do sistema
        function carregarDados() {
            // Carregar do localStorage
            processos = JSON.parse(localStorage.getItem('processos') || '[]');
            propostas = JSON.parse(localStorage.getItem('propostas') || '[]');
            usuarios = JSON.parse(localStorage.getItem('usuarios_sistema') || '[]');
            
            // Filtrar dados baseado nas permiss√µes do usu√°rio
            processos = Auth.filtrarDadosPorPermissao(processos, 'processos');
            propostas = Auth.filtrarDadosPorPermissao(propostas, 'propostas');
            
            // Atualizar interface
            atualizarDashboard();
            carregarProcessos();
            carregarTodasPropostas();
        }
        
        // Sincronizar com a API
        async function sincronizarPropostas() {
            try {
                document.getElementById('syncStatus').textContent = 'Sincronizando...';
                
                const response = await fetch(`${API_URL}/api/propostas/listar`);
                const data = await response.json();
                
                if (data.propostas) {
                    // Mesclar com propostas locais
                    const propostasAPI = data.propostas;
                    const propostasLocais = JSON.parse(localStorage.getItem('propostas') || '[]');
                    
                    // Adicionar novas propostas
                    propostasAPI.forEach(propostaAPI => {
                        const existe = propostasLocais.find(p => p.protocolo === propostaAPI.protocolo);
                        if (!existe) {
                            propostasLocais.push(propostaAPI);
                        }
                    });
                    
                    // Salvar e atualizar
                    localStorage.setItem('propostas', JSON.stringify(propostasLocais));
                    propostas = Auth.filtrarDadosPorPermissao(propostasLocais, 'propostas');
                    
                    // Atualizar interface
                    atualizarDashboard();
                    carregarProcessos();
                    carregarTodasPropostas();
                    
                    document.getElementById('syncStatus').textContent = 'Conectado';
                    document.getElementById('lastSync').textContent = new Date().toLocaleTimeString('pt-BR');
                }
            } catch (error) {
                console.log('Usando apenas dados locais:', error);
                document.getElementById('syncStatus').textContent = 'Offline';
            }
        }
        
        // Atualizar dashboard com estat√≠sticas
        function atualizarDashboard() {
            const agora = new Date();
            
            // Processos ativos
            const processosAtivos = processos.filter(p => new Date(p.prazo) > agora);
            document.getElementById('totalProcessos').textContent = processosAtivos.length;
            
            // Total de propostas
            document.getElementById('totalPropostas').textContent = propostas.length;
            
            // Processos que vencem hoje
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const amanha = new Date(hoje);
            amanha.setDate(amanha.getDate() + 1);
            
            const processosHoje = processos.filter(p => {
                const prazo = new Date(p.prazo);
                return prazo >= hoje && prazo < amanha;
            });
            document.getElementById('processosHoje').textContent = processosHoje.length;
            
            // Valor total em propostas
            let valorTotal = 0;
            propostas.forEach(p => {
                if (p.valor) {
                    let valorStr = p.valor.toString().replace(/[^\d,.-]/g, '');
                    valorStr = valorStr.replace('.', '').replace(',', '.');
                    valorTotal += parseFloat(valorStr) || 0;
                }
            });
            document.getElementById('valorTotal').textContent = valorTotal.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
            
            // Gerar gr√°ficos
            gerarGraficoDashboard();
            
            // Carregar atividades recentes
            carregarAtividadesRecentes();
        }
        
        // Gerar gr√°ficos do dashboard
        function gerarGraficoDashboard() {
            // Gr√°fico de propostas por processo
            const chartPropostas = document.getElementById('chartPropostas');
            chartPropostas.innerHTML = '';
            
            // Contar propostas por processo
            const propostasPorProcesso = {};
            propostas.forEach(p => {
                if (!propostasPorProcesso[p.processo]) {
                    propostasPorProcesso[p.processo] = 0;
                }
                propostasPorProcesso[p.processo]++;
            });
            
            // Pegar top 5 processos com mais propostas
            const topProcessos = Object.entries(propostasPorProcesso)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const maxPropostas = topProcessos.length > 0 ? topProcessos[0][1] : 1;
            
            topProcessos.forEach(([processo, count]) => {
                const altura = (count / maxPropostas) * 150;
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = altura + 'px';
                bar.innerHTML = `
                    <div class="chart-bar-value">${count}</div>
                    <div class="chart-bar-label">${processo.substring(0, 10)}</div>
                `;
                chartPropostas.appendChild(bar);
            });
            
            // Gr√°fico de status
            const chartStatus = document.getElementById('chartStatus');
            chartStatus.innerHTML = '';
            
            const agora = new Date();
            const ativos = processos.filter(p => new Date(p.prazo) > agora).length;
            const encerrados = processos.length - ativos;
            
            const statusData = [
                { label: 'Ativos', value: ativos, color: '#28a745' },
                { label: 'Encerrados', value: encerrados, color: '#dc3545' }
            ];
            
            const maxStatus = Math.max(ativos, encerrados, 1);
            
            statusData.forEach(item => {
                const altura = (item.value / maxStatus) * 150;
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = altura + 'px';
                bar.style.background = item.color;
                bar.innerHTML = `
                    <div class="chart-bar-value">${item.value}</div>
                    <div class="chart-bar-label">${item.label}</div>
                `;
                chartStatus.appendChild(bar);
            });
        }
        
        // Carregar atividades recentes
        function carregarAtividadesRecentes() {
            const container = document.getElementById('atividadesRecentes');
            const atividades = [];
            
            // Processos recentes
            processos.slice(-3).forEach(p => {
                atividades.push({
                    icon: 'üìã',
                    titulo: `Processo ${p.numero} cadastrado`,
                    tempo: new Date(p.dataCadastro || Date.now()).toLocaleString('pt-BR'),
                    tipo: 'processo'
                });
            });
            
            // Propostas recentes
            propostas.slice(-3).forEach(p => {
                atividades.push({
                    icon: 'üìù',
                    titulo: `Nova proposta de ${p.empresa}`,
                    tempo: new Date(p.data).toLocaleString('pt-BR'),
                    tipo: 'proposta'
                });
            });
            
            // Ordenar por data
            atividades.sort((a, b) => new Date(b.tempo) - new Date(a.tempo));
            
            // Exibir atividades
            container.innerHTML = atividades.slice(0, 5).map(ativ => `
                <div class="activity-item">
                    <div class="activity-icon">${ativ.icon}</div>
                    <div class="activity-content">
                        <div class="activity-title">${ativ.titulo}</div>
                        <div class="activity-time">${ativ.tempo}</div>
                    </div>
                </div>
            `).join('');
            
            if (atividades.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d;">Nenhuma atividade recente</p>';
            }
        }
        
        // Carregar processos
        function carregarProcessos() {
            const container = document.getElementById('listaProcessos');
            
            if (processos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Nenhum processo cadastrado</h3>
                        <p>Clique em "Cadastrar Processo" para come√ßar</p>
                    </div>
                `;
                return;
            }
            
            const agora = new Date();
            container.innerHTML = processos.map(processo => {
                const prazo = new Date(processo.prazo);
                const status = prazo > agora ? 'ativo' : 'encerrado';
                const diasRestantes = Math.ceil((prazo - agora) / (1000 * 60 * 60 * 24));
                
                // Contar propostas deste processo
                const propostasProcesso = propostas.filter(p => p.processo === processo.numero);
                
                return `
                    <div class="processo-card" data-status="${status}" data-modalidade="${processo.modalidade}" data-numero="${processo.numero}">
                        <div class="processo-header">
                            <div class="processo-info">
                                <div class="processo-titulo">${processo.objeto}</div>
                                <div class="processo-numero">Processo: ${processo.numero}</div>
                            </div>
                            <div class="processo-status status-${status}">
                                ${status === 'ativo' ? 'Ativo' : 'Encerrado'}
                            </div>
                        </div>
                        
                        <div class="processo-detalhes">
                            <div class="detalhe-item">
                                <span class="detalhe-label">Modalidade:</span>
                                <span class="detalhe-valor">${processo.modalidade}</span>
                            </div>
                            <div class="detalhe-item">
                                <span class="detalhe-label">Prazo:</span>
                                <span class="detalhe-valor">${prazo.toLocaleString('pt-BR')}</span>
                            </div>
                            <div class="detalhe-item">
                                <span class="detalhe-label">Dias restantes:</span>
                                <span class="detalhe-valor">${status === 'ativo' ? diasRestantes + ' dias' : 'Encerrado'}</span>
                            </div>
                        </div>
                        
                        <div class="processo-stats">
                            <div class="stat-item">
                                <div class="stat-item-value">${propostasProcesso.length}</div>
                                <div class="stat-item-label">Propostas</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-value">${calcularMenorValor(propostasProcesso)}</div>
                                <div class="stat-item-label">Menor Valor</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-item-value">${calcularAmplitude(propostasProcesso)}%</div>
                                <div class="stat-item-label">Amplitude</div>
                            </div>
                        </div>
                        
                        <div class="processo-acoes">
                            <button class="btn btn-primary" onclick="verPropostasProcesso('${processo.numero}')">
                                üìã Ver Propostas (${propostasProcesso.length})
                            </button>
                            <button class="btn btn-secondary" onclick="abrirModal('${processo.numero}')">
                                üëÅÔ∏è Detalhes
                            </button>
                            ${propostasProcesso.length >= 2 ? `
                                <button class="btn btn-info" onclick="abrirRelatorioComparativo('${processo.numero}')">
                                    üìä An√°lise Comparativa
                                </button>
                            ` : ''}
                            ${Auth.podeEditarProcesso(processo) && status === 'ativo' ? `
                                <button class="btn btn-warning" onclick="editarProcesso('${processo.numero}')">
                                    ‚úèÔ∏è Editar
                                </button>
                            ` : ''}
                            <button class="btn btn-success" onclick="copiarLinkProcesso('${processo.numero}')">
                                üîó Link Portal
                            </button>
                        </div>
                        
                        <div class="propostas-processo" id="propostas-${processo.numero}">
                            <!-- Propostas ser√£o carregadas aqui -->
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Filtrar processos
        function filtrarProcessos() {
            const status = document.getElementById('filtroStatus').value;
            const modalidade = document.getElementById('filtroModalidade').value;
            const busca = document.getElementById('filtroBusca').value.toLowerCase();
            
            const cards = document.querySelectorAll('.processo-card');
            
            cards.forEach(card => {
                let mostrar = true;
                
                // Filtro de status
                if (status !== 'todos' && card.dataset.status !== status) {
                    mostrar = false;
                }
                
                // Filtro de modalidade
                if (modalidade !== 'todos' && card.dataset.modalidade !== modalidade) {
                    mostrar = false;
                }
                
                // Filtro de busca
                if (busca) {
                    const numero = card.dataset.numero.toLowerCase();
                    const titulo = card.querySelector('.processo-titulo').textContent.toLowerCase();
                    if (!numero.includes(busca) && !titulo.includes(busca)) {
                        mostrar = false;
                    }
                }
                
                card.style.display = mostrar ? 'block' : 'none';
            });
        }
        
        // Ver propostas de um processo espec√≠fico
        function verPropostasProcesso(numeroProcesso) {
            const container = document.getElementById(`propostas-${numeroProcesso}`);
            const propostasProcesso = propostas.filter(p => p.processo === numeroProcesso);
            
            if (container.classList.contains('active')) {
                container.classList.remove('active');
                return;
            }
            
            // Fechar outras propostas abertas
            document.querySelectorAll('.propostas-processo').forEach(el => {
                el.classList.remove('active');
            });
            
            if (propostasProcesso.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Nenhuma proposta recebida ainda.</p>';
            } else {
                container.innerHTML = `
                    <h4 style="margin-bottom: 15px;">Propostas Recebidas:</h4>
                    <table class="propostas-table">
                        <thead>
                            <tr>
                                <th>Protocolo</th>
                                <th>Empresa</th>
                                <th>CNPJ</th>
                                <th>Data</th>
                                <th>Valor</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${propostasProcesso.map(proposta => `
                                <tr>
                                    <td>${proposta.protocolo}</td>
                                    <td>${proposta.empresa}</td>
                                    <td>${proposta.cnpj}</td>
                                    <td>${new Date(proposta.data).toLocaleDateString('pt-BR')}</td>
                                    <td><strong>${proposta.valor || 'R$ 0,00'}</strong></td>
                                    <td>
                                        <button class="btn btn-info" style="padding: 5px 10px; font-size: 12px;" 
                                                onclick="verDetalheProposta('${proposta.protocolo}')">
                                            Ver Detalhes
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
            
            container.classList.add('active');
        }
        
        // Carregar todas as propostas
        function carregarTodasPropostas() {
            const container = document.getElementById('todasPropostas');
            
            if (propostas.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Nenhuma proposta recebida</h3>
                        <p>As propostas enviadas pelos fornecedores aparecer√£o aqui</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <table class="all-proposals-table">
                    <thead>
                        <tr>
                            <th>Protocolo</th>
                            <th>Processo</th>
                            <th>Empresa</th>
                            <th>CNPJ</th>
                            <th>Data de Envio</th>
                            <th>Valor Total</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${propostas.map(proposta => {
                            const processo = processos.find(p => p.numero === proposta.processo);
                            const prazoPassou = processo ? new Date(processo.prazo) < new Date() : false;
                            
                            return `
                                <tr>
                                    <td><strong>${proposta.protocolo}</strong></td>
                                    <td>${proposta.processo}</td>
                                    <td>${proposta.empresa}</td>
                                    <td>${proposta.cnpj}</td>
                                    <td>${new Date(proposta.data).toLocaleString('pt-BR')}</td>
                                    <td><strong style="color: #28a745;">${proposta.valor || 'R$ 0,00'}</strong></td>
                                    <td>
                                        <span class="processo-status ${prazoPassou ? 'status-encerrado' : 'status-ativo'}">
                                            ${prazoPassou ? 'Processo Encerrado' : 'Em An√°lise'}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-info" style="padding: 5px 15px; font-size: 12px;" 
                                                onclick="verDetalheProposta('${proposta.protocolo}')">
                                            Ver Detalhes
                                        </button>
                                        <div class="btn-group" style="display: inline-block; margin-left: 5px;">
                                            <button class="btn btn-success" style="padding: 5px 10px; font-size: 12px;" 
                                                    onclick="downloadPropostaExcel('${proposta.protocolo}')" 
                                                    title="Download Excel">
                                                üìä
                                            </button>
                                            <button class="btn btn-info" style="padding: 5px 10px; font-size: 12px;" 
                                                    onclick="downloadPropostaWord('${proposta.protocolo}')"
                                                    title="Download Word">
                                                üìù
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }
        
        // Cadastrar novo processo
        async function cadastrarProcesso(event) {
            event.preventDefault();
            
            const processo = {
                id: 'proc_' + Date.now(),
                numero: document.getElementById('numeroProc').value,
                objeto: document.getElementById('objetoProc').value,
                modalidade: document.getElementById('modalidade').value,
                prazo: document.getElementById('prazoProc').value,
                dataCadastro: new Date().toISOString(),
                criadoPor: usuarioAtual.usuarioId,
                notificarFornecedores: document.getElementById('notificarFornecedores').checked
            };
            
            // Verificar se n√∫mero j√° existe
            if (processos.find(p => p.numero === processo.numero)) {
                mostrarNotificacao('error', 'Erro', 'J√° existe um processo com este n√∫mero!');
                return;
            }
            
            // Salvar localmente
            processos.push(processo);
            localStorage.setItem('processos', JSON.stringify(processos));
            
            // Enviar para API se configurado
            if (processo.notificarFornecedores) {
                try {
                    const response = await fetch(`${API_URL}/api/criar-processo`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(processo)
                    });
                    
                    const result = await response.json();
                    if (result.success) {
                        mostrarNotificacao('success', 'Sucesso', 'Processo criado e fornecedores notificados!');
                    }
                } catch (error) {
                    console.error('Erro ao criar processo na API:', error);
                }
            } else {
                mostrarNotificacao('success', 'Sucesso', 'Processo cadastrado com sucesso!');
            }
            
            // Registrar atividade
            Auth.registrarLog(usuarioAtual.usuarioId, 'criar_processo', processo.numero);
            
            // Limpar formul√°rio
            document.getElementById('formProcesso').reset();
            
            // Recarregar dados
            carregarDados();
            
            // Voltar para lista de processos
            mostrarPagina('processos');
        }
        
        // Abrir modal de detalhes
        function abrirModal(numeroProcesso) {
            const processo = processos.find(p => p.numero === numeroProcesso);
            if (!processo) return;
            
            const modal = document.getElementById('modalProcesso');
            const titulo = document.getElementById('modalTitulo');
            const conteudo = document.getElementById('modalConteudo');
            
            titulo.textContent = `Detalhes do Processo ${processo.numero}`;
            
            // Contar propostas
            const propostasProcesso = propostas.filter(p => p.processo === numeroProcesso);
            
            conteudo.innerHTML = `
                <div style="display: grid; gap: 20px;">
                    <div>
                        <h4>Informa√ß√µes Gerais</h4>
                        <p><strong>N√∫mero:</strong> ${processo.numero}</p>
                        <p><strong>Objeto:</strong> ${processo.objeto}</p>
                        <p><strong>Modalidade:</strong> ${processo.modalidade}</p>
                        <p><strong>Prazo:</strong> ${new Date(processo.prazo).toLocaleString('pt-BR')}</p>
                        <p><strong>Data de Cadastro:</strong> ${new Date(processo.dataCadastro).toLocaleString('pt-BR')}</p>
                        <p><strong>Criado por:</strong> ${obterNomeUsuario(processo.criadoPor)}</p>
                    </div>
                    
                    <div>
                        <h4>Estat√≠sticas</h4>
                        <p><strong>Total de Propostas:</strong> ${propostasProcesso.length}</p>
                        <p><strong>Menor Valor:</strong> ${calcularMenorValor(propostasProcesso)}</p>
                        <p><strong>Maior Valor:</strong> ${calcularMaiorValor(propostasProcesso)}</p>
                        <p><strong>Valor M√©dio:</strong> ${calcularValorMedio(propostasProcesso)}</p>
                    </div>
                    
                    <div class="copy-link-container">
                        <input type="text" class="copy-link-input" id="linkPortal" 
                               value="${window.location.origin}/portal-propostas-novo.html?processo=${processo.numero}" 
                               readonly>
                        <button class="copy-btn" onclick="copiarLink()">üìã Copiar Link</button>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        ${propostasProcesso.length >= 2 ? `
                            <button class="btn btn-primary" onclick="abrirRelatorioComparativo('${processo.numero}')">
                                üìä An√°lise Comparativa com IA
                            </button>
                        ` : ''}
                        <button class="btn btn-success" onclick="exportarPropostas('${processo.numero}')">
                            üì• Exportar Propostas
                        </button>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        // Fechar modal
        function fecharModal() {
            document.getElementById('modalProcesso').style.display = 'none';
        }
        
        // Copiar link do processo
        function copiarLinkProcesso(numeroProcesso) {
            const link = `${window.location.origin}/portal-propostas-novo.html?processo=${numeroProcesso}`;
            navigator.clipboard.writeText(link).then(() => {
                mostrarNotificacao('success', 'Link copiado!', 'O link foi copiado para a √°rea de transfer√™ncia');
            });
        }
        
        // Copiar link do modal
        function copiarLink() {
            const input = document.getElementById('linkPortal');
            input.select();
            document.execCommand('copy');
            mostrarNotificacao('success', 'Link copiado!', 'O link foi copiado para a √°rea de transfer√™ncia');
        }
        
        // Ver detalhes da proposta
        function verDetalheProposta(protocolo) {
            const proposta = propostas.find(p => p.protocolo === protocolo);
            if (!proposta || !proposta.dados) {
                mostrarNotificacao('error', 'Erro', 'Dados da proposta n√£o encontrados');
                return;
            }
            
            const modal = document.getElementById('modalProcesso');
            const titulo = document.getElementById('modalTitulo');
            const conteudo = document.getElementById('modalConteudo');
            
            titulo.textContent = `Proposta ${protocolo}`;
            
            const dados = proposta.dados;
            
            conteudo.innerHTML = `
                <div style="display: grid; gap: 20px;">
                    <div>
                        <h4>üìã Dados da Empresa</h4>
                        <p><strong>Raz√£o Social:</strong> ${dados.dados?.razaoSocial || 'N/A'}</p>
                        <p><strong>CNPJ:</strong> ${dados.dados?.cnpj || 'N/A'}</p>
                        <p><strong>E-mail:</strong> ${dados.dados?.email || 'N/A'}</p>
                        <p><strong>Telefone:</strong> ${dados.dados?.telefone || 'N/A'}</p>
                        <p><strong>Respons√°vel T√©cnico:</strong> ${dados.dados?.respTecnico || 'N/A'} - ${dados.dados?.crea || ''}</p>
                    </div>
                    
                    <div>
                        <h4>üí∞ Valores</h4>
                        <p><strong>M√£o de Obra:</strong> R$ ${dados.comercial?.totalMaoObra || '0,00'}</p>
                        <p><strong>Materiais:</strong> R$ ${dados.comercial?.totalMateriais || '0,00'}</p>
                        <p><strong>Equipamentos:</strong> R$ ${dados.comercial?.totalEquipamentos || '0,00'}</p>
                        <p><strong>BDI:</strong> ${dados.comercial?.bdiPercentual || '0'}% = R$ ${dados.comercial?.bdiValor || '0,00'}</p>
                        <p style="font-size: 18px; color: #28a745;"><strong>VALOR TOTAL:</strong> R$ ${dados.comercial?.valorTotal || '0,00'}</p>
                    </div>
                    
                    <div>
                        <h4>üìÖ Execu√ß√£o</h4>
                        <p><strong>Prazo de Execu√ß√£o:</strong> ${dados.tecnica?.prazoExecucao || 'N/A'}</p>
                        <p><strong>Validade da Proposta:</strong> ${dados.comercial?.validadeProposta || '60 dias'}</p>
                        <p><strong>Data de Envio:</strong> ${new Date(proposta.data).toLocaleString('pt-BR')}</p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="visualizarPropostaCompleta('${protocolo}')">
                            üìÑ Visualizar Completa
                        </button>
                        <button class="btn btn-success" onclick="downloadPropostaExcel('${protocolo}')">
                            üìä Excel Profissional
                        </button>
                        <button class="btn btn-info" onclick="downloadPropostaWord('${protocolo}')">
                            üìù Word Profissional
                        </button>
                        <button class="btn btn-warning" onclick="downloadPropostaJSON('${protocolo}')">
                            üîß JSON (Backup)
                        </button>
                    </div>
            `;
            
            modal.style.display = 'block';
        }
        
        // Download proposta em Excel profissional
        async function downloadPropostaExcel(protocolo) {
            try {
                mostrarNotificacao('info', 'Processando', 'Gerando arquivo Excel profissional...');
        
                const response = await fetch(`${API_URL}/api/download/proposta/${protocolo}/excel`);
        
                if (!response.ok) {
                    throw new Error('Erro ao gerar arquivo');
                }
        
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `proposta_${protocolo}_completa.xlsx`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
        
                mostrarNotificacao('success', '‚úÖ Excel Gerado', 'Download do Excel profissional iniciado');
        
            } catch (error) {
                console.error('Erro:', error);
                mostrarNotificacao('error', 'Erro', 'N√£o foi poss√≠vel gerar o Excel');
            }
        }

        // Download proposta em Word profissional
        async function downloadPropostaWord(protocolo) {
            try {
                mostrarNotificacao('info', 'Processando', 'Gerando documento Word profissional...');
        
                const response = await fetch(`${API_URL}/api/download/proposta/${protocolo}/word`);
        
                if (!response.ok) {
                    throw new Error('Erro ao gerar arquivo');
                }
        
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `proposta_${protocolo}_tecnica.docx`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
        
                mostrarNotificacao('success', '‚úÖ Word Gerado', 'Download do documento Word iniciado');
        
            } catch (error) {
                console.error('Erro:', error);
                mostrarNotificacao('error', 'Erro', 'N√£o foi poss√≠vel gerar o Word');
            }
        }

        // Download proposta em JSON (backup completo)
        function downloadPropostaJSON(protocolo) {
            const proposta = propostas.find(p => p.protocolo === protocolo);
            if (!proposta) {
                mostrarNotificacao('error', 'Erro', 'Proposta n√£o encontrada');
                return;
            }
        
            // Formatar JSON com indenta√ß√£o
            const dataStr = JSON.stringify(proposta, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', `proposta_${protocolo}_backup.json`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        
            mostrarNotificacao('success', '‚úÖ JSON Gerado', 'Backup completo da proposta baixado');
        }
        
        // Carregar usu√°rios
        function carregarUsuarios() {
            const container = document.getElementById('listaUsuarios');
            
            if (usuarios.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d;">Nenhum usu√°rio cadastrado</p>';
                return;
            }
            
            container.innerHTML = usuarios.map(user => {
                let badge = '';
                let badgeClass = '';
                
                switch(user.tipo) {
                    case 'admin':
                        badge = 'Administrador';
                        badgeClass = 'badge-admin';
                        break;
                    case 'comprador':
                        badge = user.nivelAcesso ? user.nivelAcesso.replace(/_/g, ' ') : 'Comprador';
                        badgeClass = 'badge-comprador';
                        break;
                    case 'fornecedor':
                        badge = 'Fornecedor';
                        badgeClass = 'badge-fornecedor';
                        break;
                }
                
                return `
                    <div class="user-card">
                        <div class="user-info">
                            <h4>${user.nome}</h4>
                            <p>E-mail: ${user.email}</p>
                            <p>Criado em: ${new Date(user.dataCriacao).toLocaleDateString('pt-BR')}</p>
                            ${user.tipo === 'fornecedor' ? `<p>CNPJ: ${user.cnpj || 'N/A'}</p>` : ''}
                        </div>
                        <div>
                            <span class="user-badge ${badgeClass}">${badge}</span>
                            ${user.tipo !== 'admin' ? `
                                <button class="btn ${user.ativo ? 'btn-danger' : 'btn-success'}" 
                                        style="margin-left: 10px; padding: 5px 15px; font-size: 12px;"
                                        onclick="toggleUsuario('${user.id}')">
                                    ${user.ativo ? 'Desativar' : 'Ativar'}
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Fun√ß√µes auxiliares
        function calcularMenorValor(propostasArray) {
            if (propostasArray.length === 0) return 'R$ 0,00';
            
            const valores = propostasArray.map(p => {
                if (p.valor) {
                    let valorStr = p.valor.toString().replace(/[^\d,.-]/g, '').replace('.', '').replace(',', '.');
                    return parseFloat(valorStr) || 0;
                }
                return 0;
            }).filter(v => v > 0);
            
            if (valores.length === 0) return 'R$ 0,00';
            
            const menor = Math.min(...valores);
            return menor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }
        
        function calcularMaiorValor(propostasArray) {
            if (propostasArray.length === 0) return 'R$ 0,00';
            
            const valores = propostasArray.map(p => {
                if (p.valor) {
                    let valorStr = p.valor.toString().replace(/[^\d,.-]/g, '').replace('.', '').replace(',', '.');
                    return parseFloat(valorStr) || 0;
                }
                return 0;
            }).filter(v => v > 0);
            
            if (valores.length === 0) return 'R$ 0,00';
            
            const maior = Math.max(...valores);
            return maior.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }
        
        function calcularValorMedio(propostasArray) {
            if (propostasArray.length === 0) return 'R$ 0,00';
            
            const valores = propostasArray.map(p => {
                if (p.valor) {
                    let valorStr = p.valor.toString().replace(/[^\d,.-]/g, '').replace('.', '').replace(',', '.');
                    return parseFloat(valorStr) || 0;
                }
                return 0;
            }).filter(v => v > 0);
            
            if (valores.length === 0) return 'R$ 0,00';
            
            const media = valores.reduce((a, b) => a + b, 0) / valores.length;
            return media.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }
        
        function calcularAmplitude(propostasArray) {
            if (propostasArray.length < 2) return '0';
            
            const valores = propostasArray.map(p => {
                if (p.valor) {
                    let valorStr = p.valor.toString().replace(/[^\d,.-]/g, '').replace('.', '').replace(',', '.');
                    return parseFloat(valorStr) || 0;
                }
                return 0;
            }).filter(v => v > 0);
            
            if (valores.length < 2) return '0';
            
            const menor = Math.min(...valores);
            const maior = Math.max(...valores);
            
            if (menor === 0) return '0';
            
            const amplitude = ((maior - menor) / menor * 100).toFixed(2);
            return amplitude;
        }
        
        function obterNomeUsuario(userId) {
            const user = usuarios.find(u => u.id === userId);
            return user ? user.nome : 'Usu√°rio desconhecido';
        }
        
        // Sistema de notifica√ß√µes
        function mostrarNotificacao(tipo, titulo, mensagem) {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            
            notification.className = `notification ${tipo}`;
            notificationTitle.textContent = titulo;
            notificationMessage.textContent = mensagem;
            
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }
        
        // Verificar novas propostas
        function verificarNovasPropostas() {
            const propostasAntigas = JSON.parse(sessionStorage.getItem('propostas_count') || '0');
            const propostasAtuais = propostas.length;
            
            if (propostasAtuais > propostasAntigas) {
                const diferenca = propostasAtuais - propostasAntigas;
                mostrarNotificacao('info', 'Nova Proposta!', `${diferenca} nova(s) proposta(s) recebida(s)`);
            }
            
            sessionStorage.setItem('propostas_count', propostasAtuais.toString());
        }
        
        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('modalProcesso');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
