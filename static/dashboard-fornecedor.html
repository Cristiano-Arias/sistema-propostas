<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Fornecedor - Sistema de Propostas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.95em;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-info {
            background: #3498db;
            color: white;
        }
        
        .btn-sm {
            padding: 5px 15px;
            font-size: 13px;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #5a6c7d;
            border-bottom: 2px solid #e9ecef;
        }
        
        .table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-aberto {
            background: #d4edda;
            color: #155724;
        }
        
        .status-enviada {
            background: #cce5ff;
            color: #004085;
        }
        
        .status-rascunho {
            background: #e9ecef;
            color: #6c757d;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 800px;
            margin: 50px auto;
            border-radius: 10px;
            padding: 30px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close {
            font-size: 28px;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #000;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .tr-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .tr-section {
            margin-bottom: 20px;
        }
        
        .tr-section h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .tr-section p {
            line-height: 1.6;
            color: #495057;
        }
        
        .tr-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .tr-info-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }
        
        .tr-info-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .tr-info-value {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .success-message {
            display: none;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .success-message h3 {
            margin-bottom: 10px;
        }
        
        .auto-save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: none;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 999;
        }
        
        .auto-save-indicator.show {
            display: flex;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .saving {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div>
                <h1>Dashboard Fornecedor</h1>
                <p>Portal de Propostas</p>
            </div>
            <div class="user-info">
                <span>üè≠ <strong id="nomeEmpresa">Empresa ABC Ltda</strong></span>
                <button class="btn btn-sm" style="background: rgba(255,255,255,0.2); color: white;" onclick="logout()">
                    Sair
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="alertContainer"></div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="processosAbertos">0</div>
                <div class="stat-label">Processos Abertos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="propostasEnviadas">0</div>
                <div class="stat-label">Propostas Enviadas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="propostasRascunho">0</div>
                <div class="stat-label">Em Elabora√ß√£o</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="prazoProximo">-</div>
                <div class="stat-label">Pr√≥ximo Prazo</div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>üìã Processos Dispon√≠veis</h2>
                <input type="text" placeholder="Buscar processo..." style="padding: 8px 15px; border: 1px solid #ddd; border-radius: 5px;" onkeyup="filtrarProcessos(this.value)">
            </div>

            <table class="table" id="tabelaProcessos">
                <thead>
                    <tr>
                        <th>N√∫mero</th>
                        <th>Objeto</th>
                        <th>Modalidade</th>
                        <th>Prazo</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="tbodyProcessos">
                    <tr>
                        <td colspan="6" style="text-align: center; color: #7f8c8d;">
                            Carregando processos...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>üìù Minhas Propostas</h2>
            </div>

            <table class="table">
                <thead>
                    <tr>
                        <th>Protocolo</th>
                        <th>Processo</th>
                        <th>Valor</th>
                        <th>Data Envio</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="tbodyPropostas">
                    <tr>
                        <td colspan="6" style="text-align: center; color: #7f8c8d;">
                            Nenhuma proposta enviada
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal Visualizar TR -->
    <div id="modalVisualizarTR" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìã Termo de Refer√™ncia</h2>
                <span class="close" onclick="fecharModal('modalVisualizarTR')">&times;</span>
            </div>
            
            <div id="conteudoTR" class="tr-content">
                <!-- Conte√∫do do TR ser√° carregado aqui -->
            </div>
            
            <div class="btn-group">
                <button class="btn btn-success" onclick="baixarTRWord()">
                    üìÑ Baixar em Word
                </button>
                <button class="btn btn-primary" onclick="iniciarProposta()">
                    ‚úèÔ∏è Elaborar Proposta
                </button>
                <button class="btn btn-sm" style="background: #6c757d; color: white;" onclick="fecharModal('modalVisualizarTR')">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Sucesso Envio -->
    <div id="modalSucessoEnvio" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="success-message" style="display: block;">
                <h3>‚úÖ Proposta Enviada com Sucesso!</h3>
                <p>Protocolo: <strong id="protocoloEnviado">PROP-2025-001</strong></p>
                <p>Voc√™ receber√° um e-mail de confirma√ß√£o em breve.</p>
                
                <div class="btn-group" style="justify-content: center;">
                    <button class="btn btn-primary" onclick="voltarDashboard()">
                        üè† Voltar ao Dashboard
                    </button>
                    <button class="btn btn-success" onclick="baixarComprovante()">
                        üì• Baixar Comprovante
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Indicador de Auto-Save -->
    <div id="autoSaveIndicator" class="auto-save-indicator">
        <span class="saving">üíæ</span>
        <span id="saveStatus">Salvando...</span>
    </div>

    <script>
        // Dados mockados
        let processos = [
            {
                numero: 'LIC-2025-001',
                objeto: 'Contrata√ß√£o de servi√ßos de desenvolvimento de software',
                modalidade: 'Preg√£o Eletr√¥nico',
                prazo: '2025-02-15T10:00:00',
                status: 'aberto',
                tr: {
                    numero: 'TR-2025-001',
                    objeto: 'Contrata√ß√£o de servi√ßos de desenvolvimento de software para moderniza√ß√£o dos sistemas internos',
                    justificativa: 'A empresa necessita modernizar seus sistemas legados para melhorar a efici√™ncia operacional e reduzir custos de manuten√ß√£o.',
                    modalidade: 'Preg√£o Eletr√¥nico',
                    valorEstimado: 'R$ 150.000,00',
                    prazoExecucao: '6 meses',
                    localExecucao: 'Sede da empresa - Fortaleza/CE',
                    requisitos: [
                        'Experi√™ncia m√≠nima de 5 anos em desenvolvimento de software',
                        'Equipe t√©cnica com certifica√ß√µes relevantes',
                        'Capacidade de atendimento 24x7'
                    ],
                    documentosExigidos: [
                        'Certid√µes de regularidade fiscal',
                        'Atestados de capacidade t√©cnica',
                        'Balan√ßo patrimonial dos √∫ltimos 3 anos'
                    ],
                    criteriosAvaliacao: 'Menor pre√ßo global com requisitos t√©cnicos atendidos',
                    observacoes: 'O fornecedor dever√° apresentar cronograma detalhado de execu√ß√£o'
                }
            },
            {
                numero: 'LIC-2025-002',
                objeto: 'Aquisi√ß√£o de equipamentos de inform√°tica',
                modalidade: 'Preg√£o Eletr√¥nico',
                prazo: '2025-02-20T14:00:00',
                status: 'aberto',
                tr: {
                    numero: 'TR-2025-002',
                    objeto: 'Aquisi√ß√£o de equipamentos de inform√°tica para renova√ß√£o do parque tecnol√≥gico',
                    justificativa: 'Necessidade de atualiza√ß√£o dos equipamentos que est√£o obsoletos e fora de garantia.',
                    modalidade: 'Preg√£o Eletr√¥nico',
                    valorEstimado: 'R$ 80.000,00',
                    prazoExecucao: '30 dias',
                    localExecucao: 'Almoxarifado Central - Fortaleza/CE',
                    requisitos: [
                        'Assist√™ncia t√©cnica local',
                        'Garantia m√≠nima de 36 meses',
                        'Certifica√ß√µes de qualidade'
                    ],
                    documentosExigidos: [
                        'Certid√µes de regularidade fiscal',
                        'Cat√°logos t√©cnicos dos produtos'
                    ],
                    criteriosAvaliacao: 'Menor pre√ßo por item',
                    observacoes: 'Entrega parcelada conforme solicita√ß√£o'
                }
            }
        ];

        let propostasEnviadas = [
            {
                protocolo: 'PROP-2025-001',
                processo: 'LIC-2024-010',
                valor: 'R$ 45.000,00',
                dataEnvio: '2025-01-10T15:30:00',
                status: 'enviada'
            }
        ];

        let trAtual = null;
        let processoAtual = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            carregarDashboard();
            carregarProcessos();
            carregarPropostas();
            
            // Verificar se h√° proposta em elabora√ß√£o no localStorage
            verificarPropostaEmElaboracao();
        });

        function carregarDashboard() {
            document.getElementById('processosAbertos').textContent = processos.filter(p => p.status === 'aberto').length;
            document.getElementById('propostasEnviadas').textContent = propostasEnviadas.length;
            document.getElementById('propostasRascunho').textContent = localStorage.getItem('propostaRascunho') ? 1 : 0;
            
            // Pr√≥ximo prazo
            const processosOrdenados = processos
                .filter(p => p.status === 'aberto')
                .sort((a, b) => new Date(a.prazo) - new Date(b.prazo));
            
            if (processosOrdenados.length > 0) {
                const dias = Math.ceil((new Date(processosOrdenados[0].prazo) - new Date()) / (1000 * 60 * 60 * 24));
                document.getElementById('prazoProximo').textContent = `${dias} dias`;
            }
        }

        function carregarProcessos() {
            const tbody = document.getElementById('tbodyProcessos');
            
            if (processos.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: #7f8c8d;">
                            Nenhum processo dispon√≠vel
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = processos.map(processo => `
                <tr>
                    <td>${processo.numero}</td>
                    <td>${processo.objeto}</td>
                    <td>${processo.modalidade}</td>
                    <td>${formatarDataHora(processo.prazo)}</td>
                    <td>
                        <span class="status-badge status-${processo.status}">
                            ${processo.status === 'aberto' ? 'Aberto' : processo.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="visualizarTR('${processo.numero}')">
                            üìã Ver TR
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="elaborarProposta('${processo.numero}')">
                            ‚úèÔ∏è Proposta
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function carregarPropostas() {
            const tbody = document.getElementById('tbodyPropostas');
            
            if (propostasEnviadas.length === 0) {
                return;
            }

            tbody.innerHTML = propostasEnviadas.map(proposta => `
                <tr>
                    <td>${proposta.protocolo}</td>
                    <td>${proposta.processo}</td>
                    <td>${proposta.valor}</td>
                    <td>${formatarDataHora(proposta.dataEnvio)}</td>
                    <td>
                        <span class="status-badge status-${proposta.status}">
                            Enviada
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-success btn-sm" onclick="baixarProposta('${proposta.protocolo}')">
                            üì• Baixar
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function visualizarTR(numeroProcesso) {
            const processo = processos.find(p => p.numero === numeroProcesso);
            if (!processo || !processo.tr) return;

            processoAtual = processo;
            trAtual = processo.tr;

            const conteudoTR = document.getElementById('conteudoTR');
            conteudoTR.innerHTML = `
                <div class="tr-section">
                    <h4>Informa√ß√µes Gerais</h4>
                    <div class="tr-info-grid">
                        <div class="tr-info-item">
                            <div class="tr-info-label">N√∫mero do TR</div>
                            <div class="tr-info-value">${trAtual.numero}</div>
                        </div>
                        <div class="tr-info-item">
                            <div class="tr-info-label">Modalidade</div>
                            <div class="tr-info-value">${trAtual.modalidade}</div>
                        </div>
                        <div class="tr-info-item">
                            <div class="tr-info-label">Valor Estimado</div>
                            <div class="tr-info-value">${trAtual.valorEstimado}</div>
                        </div>
                        <div class="tr-info-item">
                            <div class="tr-info-label">Prazo de Execu√ß√£o</div>
                            <div class="tr-info-value">${trAtual.prazoExecucao}</div>
                        </div>
                    </div>
                </div>

                <div class="tr-section">
                    <h4>Objeto</h4>
                    <p>${trAtual.objeto}</p>
                </div>

                <div class="tr-section">
                    <h4>Justificativa</h4>
                    <p>${trAtual.justificativa}</p>
                </div>

                <div class="tr-section">
                    <h4>Local de Execu√ß√£o</h4>
                    <p>${trAtual.localExecucao}</p>
                </div>

                <div class="tr-section">
                    <h4>Requisitos T√©cnicos</h4>
                    <ul>
                        ${trAtual.requisitos.map(req => `<li>${req}</li>`).join('')}
                    </ul>
                </div>

                <div class="tr-section">
                    <h4>Documentos Exigidos</h4>
                    <ul>
                        ${trAtual.documentosExigidos.map(doc => `<li>${doc}</li>`).join('')}
                    </ul>
                </div>

                <div class="tr-section">
                    <h4>Crit√©rios de Avalia√ß√£o</h4>
                    <p>${trAtual.criteriosAvaliacao}</p>
                </div>

                ${trAtual.observacoes ? `
                    <div class="tr-section">
                        <h4>Observa√ß√µes</h4>
                        <p>${trAtual.observacoes}</p>
                    </div>
                ` : ''}
            `;

            document.getElementById('modalVisualizarTR').style.display = 'block';
        }

        function baixarTRWord() {
            mostrarAlert('success', 'Baixando Termo de Refer√™ncia em formato Word...');
            // Aqui implementaria o download real via API
        }

        function iniciarProposta() {
            if (processoAtual) {
                elaborarProposta(processoAtual.numero);
                fecharModal('modalVisualizarTR');
            }
        }

        function elaborarProposta(numeroProcesso) {
            // Salvar processo selecionado
            localStorage.setItem('processoSelecionado', numeroProcesso);
            
            // Redirecionar para portal de propostas
            window.location.href = 'portal-propostas.html';
        }

        function verificarPropostaEmElaboracao() {
            const rascunho = localStorage.getItem('propostaRascunho');
            if (rascunho) {
                mostrarAlert('info', 'Voc√™ tem uma proposta em elabora√ß√£o. Continue de onde parou!');
            }
        }

        function mostrarAutoSave() {
            const indicator = document.getElementById('autoSaveIndicator');
            const status = document.getElementById('saveStatus');
            
            indicator.classList.add('show');
            status.textContent = 'Salvando...';
            
            setTimeout(() => {
                status.textContent = 'Salvo!';
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 1000);
            }, 1000);
        }

        function simularEnvioProposta() {
            // Simular envio bem-sucedido
            const protocolo = 'PROP-2025-' + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            document.getElementById('protocoloEnviado').textContent = protocolo;
            
            // Limpar rascunho
            localStorage.removeItem('propostaRascunho');
            localStorage.removeItem('processoSelecionado');
            
            // Mostrar modal de sucesso
            document.getElementById('modalSucessoEnvio').style.display = 'block';
        }

        function voltarDashboard() {
            fecharModal('modalSucessoEnvio');
            // Recarregar dados
            carregarDashboard();
            carregarPropostas();
        }

        function baixarComprovante() {
            mostrarAlert('success', 'Baixando comprovante de envio...');
        }

        function filtrarProcessos(termo) {
            const linhas = document.querySelectorAll('#tbodyProcessos tr');
            termo = termo.toLowerCase();
            
            linhas.forEach(linha => {
                const texto = linha.textContent.toLowerCase();
                linha.style.display = texto.includes(termo) ? '' : 'none';
            });
        }

        function formatarDataHora(dataHora) {
            const data = new Date(dataHora);
            return data.toLocaleString('pt-BR');
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function mostrarAlert(tipo, mensagem) {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${tipo}`;
            alert.textContent = mensagem;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function baixarProposta(protocolo) {
            mostrarAlert('success', `Baixando proposta ${protocolo}...`);
        }

        function logout() {
            if (confirm('Deseja realmente sair?')) {
                localStorage.clear();
                window.location.href = 'index.html';
            }
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Simular auto-save periodicamente
        setInterval(() => {
            const rascunho = localStorage.getItem('propostaRascunho');
            if (rascunho) {
                mostrarAutoSave();
            }
        }, 30000); // A cada 30 segundos
    </script>
</body>
</html>
