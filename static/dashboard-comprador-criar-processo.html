<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Processo - Sistema de Gest√£o de Propostas</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            min-height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .logo h2 {
            color: #27ae60;
            font-size: 16px;
            margin-left: 10px;
        }

        .menu-section {
            margin-bottom: 25px;
        }

        .menu-title {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .menu-item:hover {
            background: #e8f5e8;
            color: #27ae60;
            transform: translateX(5px);
        }

        .menu-item.active {
            background: #27ae60;
            color: white;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e8f5e8;
        }

        .header h1 {
            color: #27ae60;
            margin-left: 15px;
            font-size: 28px;
        }

        .steps-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: #27ae60;
            color: white;
        }

        .step.completed .step-number {
            background: #2ecc71;
            color: white;
        }

        .step-title {
            font-size: 14px;
            text-align: center;
            color: #666;
            font-weight: 500;
        }

        .step.active .step-title {
            color: #27ae60;
            font-weight: 600;
        }

        .step-line {
            position: absolute;
            top: 20px;
            left: 50%;
            right: -50%;
            height: 2px;
            background: #ddd;
            z-index: -1;
        }

        .step:last-child .step-line {
            display: none;
        }

        .step.completed .step-line {
            background: #2ecc71;
        }

        .form-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .form-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #27ae60;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 12px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn-primary {
            background: #27ae60;
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .tr-selection {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tr-selection:hover {
            border-color: #27ae60;
            background: #e8f5e8;
        }

        .tr-selection.selected {
            border-color: #27ae60;
            background: #e8f5e8;
        }

        .tr-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .tr-meta {
            display: flex;
            gap: 20px;
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .tr-objective {
            color: #555;
            line-height: 1.5;
        }

        .fornecedor-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .fornecedor-info {
            flex: 1;
        }

        .fornecedor-actions {
            display: flex;
            gap: 10px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .summary-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-content {
            color: #555;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 15px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .steps-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .step-line {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-plus-circle" style="font-size: 24px; color: #27ae60;"></i>
            <h2>Criar Processo</h2>
        </div>

        <div class="menu-section">
            <div class="menu-title">NAVEGA√á√ÉO</div>
            <button class="menu-item" onclick="navigateTo('dashboard')">
                <i class="fas fa-tachometer-alt" style="margin-right: 10px;"></i>
                Dashboard
            </button>
            <button class="menu-item" onclick="navigateTo('aprovacao-tr')">
                <i class="fas fa-file-check" style="margin-right: 10px;"></i>
                Aprova√ß√£o de TRs
            </button>
            <button class="menu-item active" onclick="navigateTo('criar-processo')">
                <i class="fas fa-plus-circle" style="margin-right: 10px;"></i>
                Criar Processo
            </button>
            <button class="menu-item" onclick="navigateTo('propostas')">
                <i class="fas fa-envelope" style="margin-right: 10px;"></i>
                Propostas
            </button>
        </div>

        <div class="menu-section">
            <div class="menu-title">SISTEMA</div>
            <button class="menu-item" onclick="navigateTo('sair')">
                <i class="fas fa-sign-out-alt" style="margin-right: 10px;"></i>
                Sair
            </button>
        </div>
    </div>

    <div class="main-content">
        <div class="content-card">
            <div class="header">
                <i class="fas fa-plus-circle" style="font-size: 32px; color: #27ae60;"></i>
                <h1>Criar Processo Licitat√≥rio</h1>
            </div>

            <div class="steps-container">
                <div class="step active" id="step-1">
                    <div class="step-number">1</div>
                    <div class="step-title">Selecionar TR</div>
                    <div class="step-line"></div>
                </div>
                <div class="step" id="step-2">
                    <div class="step-number">2</div>
                    <div class="step-title">Dados do Processo</div>
                    <div class="step-line"></div>
                </div>
                <div class="step" id="step-3">
                    <div class="step-number">3</div>
                    <div class="step-title">Fornecedores</div>
                    <div class="step-line"></div>
                </div>
                <div class="step" id="step-4">
                    <div class="step-number">4</div>
                    <div class="step-title">Confirma√ß√£o</div>
                </div>
            </div>

            <!-- Etapa 1: Sele√ß√£o de TR -->
            <div class="form-section active" id="etapa-1">
                <h3 style="margin-bottom: 20px; color: #27ae60;">
                    <i class="fas fa-file-check"></i> Selecione o TR Aprovado
                </h3>
                
                <div class="alert alert-info">
                    <strong><i class="fas fa-info-circle"></i> Informa√ß√£o:</strong>
                    Selecione um Termo de Refer√™ncia que foi aprovado para criar o processo licitat√≥rio.
                </div>

                <div id="trs-disponiveis">
                    <!-- TRs aprovados ser√£o carregados aqui -->
                </div>
            </div>

            <!-- Etapa 2: Dados do Processo -->
            <div class="form-section" id="etapa-2">
                <h3 style="margin-bottom: 20px; color: #27ae60;">
                    <i class="fas fa-cog"></i> Dados do Processo Licitat√≥rio
                </h3>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="numeroProcesso">N√∫mero do Processo *</label>
                        <input type="text" id="numeroProcesso" required>
                        <small>Ex: 001/2024</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="modalidade">Modalidade *</label>
                        <select id="modalidade" required>
                            <option value="">Selecione a modalidade</option>
                            <option value="Preg√£o Eletr√¥nico">Preg√£o Eletr√¥nico</option>
                            <option value="Concorr√™ncia">Concorr√™ncia</option>
                            <option value="Tomada de Pre√ßos">Tomada de Pre√ßos</option>
                            <option value="Convite">Convite</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="dataAbertura">Data de Abertura *</label>
                        <input type="datetime-local" id="dataAbertura" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="dataLimite">Data Limite para Propostas *</label>
                        <input type="datetime-local" id="dataLimite" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="localAbertura">Local de Abertura *</label>
                    <input type="text" id="localAbertura" required>
                    <small>Local onde ser√° realizada a abertura das propostas</small>
                </div>

                <div class="form-group">
                    <label for="observacoesProcesso">Observa√ß√µes</label>
                    <textarea id="observacoesProcesso" placeholder="Observa√ß√µes adicionais sobre o processo..."></textarea>
                </div>
            </div>

            <!-- Etapa 3: Fornecedores -->
            <div class="form-section" id="etapa-3">
                <h3 style="margin-bottom: 20px; color: #27ae60;">
                    <i class="fas fa-building"></i> Cadastro de Fornecedores
                </h3>

                <div class="alert alert-info">
                    <strong><i class="fas fa-info-circle"></i> Informa√ß√£o:</strong>
                    Cadastre os fornecedores que poder√£o participar do processo. Credenciais de acesso ser√£o geradas automaticamente.
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px; color: #333;">Adicionar Novo Fornecedor</h4>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="razaoSocial">Raz√£o Social *</label>
                            <input type="text" id="razaoSocial">
                        </div>
                        
                        <div class="form-group">
                            <label for="cnpj">CNPJ *</label>
                            <input type="text" id="cnpj" maxlength="18" oninput="formatarCNPJ(this)">
                        </div>
                        
                        <div class="form-group">
                            <label for="email">E-mail *</label>
                            <input type="email" id="email">
                        </div>
                        
                        <div class="form-group">
                            <label for="telefone">Telefone</label>
                            <input type="text" id="telefone">
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="adicionarFornecedor()">
                        <i class="fas fa-plus"></i> Adicionar Fornecedor
                    </button>
                </div>

                <div id="fornecedores-lista">
                    <h4 style="margin-bottom: 15px; color: #333;">Fornecedores Cadastrados</h4>
                    <div id="fornecedores-container">
                        <p style="color: #666; text-align: center; padding: 20px;">Nenhum fornecedor cadastrado ainda.</p>
                    </div>
                </div>
            </div>

            <!-- Etapa 4: Confirma√ß√£o -->
            <div class="form-section" id="etapa-4">
                <h3 style="margin-bottom: 20px; color: #27ae60;">
                    <i class="fas fa-check-circle"></i> Confirma√ß√£o e Finaliza√ß√£o
                </h3>

                <div id="resumo-processo">
                    <!-- Resumo ser√° gerado aqui -->
                </div>
            </div>

            <div class="navigation-buttons">
                <button type="button" class="btn btn-secondary" id="btn-anterior" onclick="etapaAnterior()" disabled>
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                
                <div>
                    <button type="button" class="btn btn-primary" id="btn-proximo" onclick="proximaEtapa()">
                        Pr√≥ximo <i class="fas fa-arrow-right"></i>
                    </button>
                    <button type="button" class="btn btn-success" id="btn-finalizar" onclick="finalizarProcesso()" style="display: none;">
                        <i class="fas fa-check"></i> Finalizar Processo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let etapaAtual = 1;
        let trSelecionado = null;
        let fornecedores = [];
        let processData = {};

        // Sistema de dados local
        const SistemaLocal = {
            CHAVES: {
                TRS: 'sistema_trs',
                PROCESSOS: 'processos_licitatorios',
                CREDENCIAIS: 'credenciais_fornecedores'
            },

            salvar(chave, dados) {
                try {
                    localStorage.setItem(chave, JSON.stringify(dados));
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar dados:', error);
                    return false;
                }
            },

            carregar(chave, padrao = null) {
                try {
                    const dados = localStorage.getItem(chave);
                    return dados ? JSON.parse(dados) : padrao;
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    return padrao;
                }
            }
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            carregarTRsAprovados();
            
            // Verificar se h√° TR pr√©-selecionado via URL
            const urlParams = new URLSearchParams(window.location.search);
            const trId = urlParams.get('tr');
            if (trId) {
                selecionarTR(trId);
            }
        });

        // Carregar TRs aprovados
        function carregarTRsAprovados() {
            const trs = SistemaLocal.carregar(SistemaLocal.CHAVES.TRS, []);
            const trsAprovados = trs.filter(tr => tr.status === 'aprovado');
            const container = document.getElementById('trs-disponiveis');

            if (trsAprovados.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3>Nenhum TR aprovado dispon√≠vel</h3>
                        <p>Para criar um processo, primeiro √© necess√°rio ter TRs aprovados.</p>
                        <button class="btn btn-primary" onclick="navigateTo('aprovacao-tr')">
                            <i class="fas fa-file-check"></i> Ir para Aprova√ß√£o de TRs
                        </button>
                    </div>
                `;
                return;
            }

            let html = '';
            trsAprovados.forEach(tr => {
                const dataFormatada = new Date(tr.dataCriacao).toLocaleDateString('pt-BR');
                
                html += `
                    <div class="tr-selection" onclick="selecionarTR('${tr.id}')" id="tr-${tr.id}">
                        <div class="tr-title">${tr.titulo}</div>
                        <div class="tr-meta">
                            <span><i class="fas fa-hashtag"></i> ${tr.numeroTR}</span>
                            <span><i class="fas fa-calendar"></i> ${dataFormatada}</span>
                            <span><i class="fas fa-tag"></i> ${tr.modalidade}</span>
                            <span><i class="fas fa-money-bill"></i> R$ ${parseFloat(tr.valorEstimado || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                        </div>
                        <div class="tr-objective">${tr.objetivo}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Selecionar TR
        function selecionarTR(id) {
            const trs = SistemaLocal.carregar(SistemaLocal.CHAVES.TRS, []);
            trSelecionado = trs.find(tr => tr.id === id);

            if (trSelecionado) {
                // Remover sele√ß√£o anterior
                document.querySelectorAll('.tr-selection').forEach(el => {
                    el.classList.remove('selected');
                });

                // Adicionar sele√ß√£o atual
                document.getElementById(`tr-${id}`).classList.add('selected');

                // Preencher dados do processo com base no TR
                document.getElementById('modalidade').value = trSelecionado.modalidade || '';
                
                // Habilitar bot√£o pr√≥ximo
                document.getElementById('btn-proximo').disabled = false;
            }
        }

        // Navega√ß√£o entre etapas
        function proximaEtapa() {
            if (validarEtapaAtual()) {
                etapaAtual++;
                mostrarEtapa(etapaAtual);
                atualizarBotoes();
            }
        }

        function etapaAnterior() {
            if (etapaAtual > 1) {
                etapaAtual--;
                mostrarEtapa(etapaAtual);
                atualizarBotoes();
            }
        }

        function mostrarEtapa(numero) {
            // Esconder todas as etapas
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });

            // Mostrar etapa atual
            document.getElementById(`etapa-${numero}`).classList.add('active');

            // Atualizar indicadores visuais
            document.querySelectorAll('.step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < numero) {
                    step.classList.add('completed');
                } else if (index + 1 === numero) {
                    step.classList.add('active');
                }
            });

            // Carregar dados espec√≠ficos da etapa
            if (numero === 4) {
                gerarResumo();
            }
        }

        function atualizarBotoes() {
            const btnAnterior = document.getElementById('btn-anterior');
            const btnProximo = document.getElementById('btn-proximo');
            const btnFinalizar = document.getElementById('btn-finalizar');

            btnAnterior.disabled = etapaAtual === 1;

            if (etapaAtual === 4) {
                btnProximo.style.display = 'none';
                btnFinalizar.style.display = 'inline-block';
            } else {
                btnProximo.style.display = 'inline-block';
                btnFinalizar.style.display = 'none';
            }
        }

        function validarEtapaAtual() {
            switch (etapaAtual) {
                case 1:
                    if (!trSelecionado) {
                        alert('Selecione um TR aprovado para continuar.');
                        return false;
                    }
                    return true;

                case 2:
                    const campos = ['numeroProcesso', 'modalidade', 'dataAbertura', 'dataLimite', 'localAbertura'];
                    for (let campo of campos) {
                        if (!document.getElementById(campo).value) {
                            alert(`O campo "${document.querySelector(`label[for="${campo}"]`).textContent}" √© obrigat√≥rio.`);
                            document.getElementById(campo).focus();
                            return false;
                        }
                    }
                    return true;

                case 3:
                    if (fornecedores.length === 0) {
                        alert('Cadastre pelo menos um fornecedor para continuar.');
                        return false;
                    }
                    return true;

                default:
                    return true;
            }
        }

        // Gerenciamento de fornecedores
        function adicionarFornecedor() {
            const razaoSocial = document.getElementById('razaoSocial').value;
            const cnpj = document.getElementById('cnpj').value;
            const email = document.getElementById('email').value;
            const telefone = document.getElementById('telefone').value;

            if (!razaoSocial || !cnpj || !email) {
                alert('Preencha todos os campos obrigat√≥rios.');
                return;
            }

            if (!validarCNPJ(cnpj)) {
                alert('CNPJ inv√°lido.');
                return;
            }

            if (!validarEmail(email)) {
                alert('E-mail inv√°lido.');
                return;
            }

            // Verificar se CNPJ j√° existe
            if (fornecedores.some(f => f.cnpj === cnpj)) {
                alert('Este CNPJ j√° foi cadastrado.');
                return;
            }

            // Gerar credenciais
            const login = `fornecedor_${cnpj.replace(/\D/g, '').slice(-6)}`;
            const senha = gerarSenha();

            const fornecedor = {
                id: Date.now() + Math.random(),
                razaoSocial,
                cnpj,
                email,
                telefone,
                login,
                senha
            };

            fornecedores.push(fornecedor);
            atualizarListaFornecedores();
            limparFormularioFornecedor();
        }

        function removerFornecedor(id) {
            if (confirm('Deseja realmente remover este fornecedor?')) {
                fornecedores = fornecedores.filter(f => f.id !== id);
                atualizarListaFornecedores();
            }
        }

        function atualizarListaFornecedores() {
            const container = document.getElementById('fornecedores-container');

            if (fornecedores.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Nenhum fornecedor cadastrado ainda.</p>';
                return;
            }

            let html = '';
            fornecedores.forEach(fornecedor => {
                html += `
                    <div class="fornecedor-item">
                        <div class="fornecedor-info">
                            <strong>${fornecedor.razaoSocial}</strong><br>
                            <small>CNPJ: ${fornecedor.cnpj} | E-mail: ${fornecedor.email}</small><br>
                            <small>Login: ${fornecedor.login} | Senha: ${fornecedor.senha}</small>
                        </div>
                        <div class="fornecedor-actions">
                            <button class="btn btn-danger" onclick="removerFornecedor(${fornecedor.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function limparFormularioFornecedor() {
            document.getElementById('razaoSocial').value = '';
            document.getElementById('cnpj').value = '';
            document.getElementById('email').value = '';
            document.getElementById('telefone').value = '';
        }

        // Gerar resumo
        function gerarResumo() {
            const container = document.getElementById('resumo-processo');

            const html = `
                <div class="summary-section">
                    <div class="summary-title">
                        <i class="fas fa-file-check"></i> TR Selecionado
                    </div>
                    <div class="summary-content">
                        <strong>${trSelecionado.titulo}</strong><br>
                        N√∫mero: ${trSelecionado.numeroTR}<br>
                        Modalidade: ${trSelecionado.modalidade}<br>
                        Valor Estimado: R$ ${parseFloat(trSelecionado.valorEstimado || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                    </div>
                </div>

                <div class="summary-section">
                    <div class="summary-title">
                        <i class="fas fa-cog"></i> Dados do Processo
                    </div>
                    <div class="summary-content">
                        <strong>N√∫mero:</strong> ${document.getElementById('numeroProcesso').value}<br>
                        <strong>Modalidade:</strong> ${document.getElementById('modalidade').value}<br>
                        <strong>Data de Abertura:</strong> ${formatarDataHora(document.getElementById('dataAbertura').value)}<br>
                        <strong>Data Limite:</strong> ${formatarDataHora(document.getElementById('dataLimite').value)}<br>
                        <strong>Local:</strong> ${document.getElementById('localAbertura').value}
                    </div>
                </div>

                <div class="summary-section">
                    <div class="summary-title">
                        <i class="fas fa-building"></i> Fornecedores Cadastrados (${fornecedores.length})
                    </div>
                    <div class="summary-content">
                        ${fornecedores.map(f => `
                            <div style="background: white; padding: 10px; border-radius: 4px; border: 1px solid #ddd; margin-bottom: 5px;">
                                <strong>${f.razaoSocial}</strong> - CNPJ: ${f.cnpj} - E-mail: ${f.email}
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <h4 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è Importante</h4>
                    <p style="color: #856404; margin: 0;">
                        Ao finalizar, o processo ser√° criado e as credenciais ser√£o enviadas automaticamente 
                        por e-mail para todos os fornecedores cadastrados. Esta a√ß√£o n√£o pode ser desfeita.
                    </p>
                </div>
            `;

            container.innerHTML = html;
        }

        function finalizarProcesso() {
            if (!confirm('Tem certeza que deseja criar este processo? As credenciais ser√£o enviadas para os fornecedores e esta a√ß√£o n√£o pode ser desfeita.')) {
                return;
            }

            // Coletar dados do processo
            processData = {
                id: Date.now(),
                numeroProcesso: document.getElementById('numeroProcesso').value,
                modalidade: document.getElementById('modalidade').value,
                dataAbertura: document.getElementById('dataAbertura').value,
                dataLimite: document.getElementById('dataLimite').value,
                localAbertura: document.getElementById('localAbertura').value,
                observacoes: document.getElementById('observacoesProcesso').value,
                trVinculado: trSelecionado,
                fornecedores: fornecedores,
                status: 'ATIVO',
                dataCriacao: new Date().toISOString(),
                criadoPor: 'Comprador'
            };

            // Salvar processo
            const processos = SistemaLocal.carregar(SistemaLocal.CHAVES.PROCESSOS, []);
            processos.push(processData);
            SistemaLocal.salvar(SistemaLocal.CHAVES.PROCESSOS, processos);

            // Salvar credenciais dos fornecedores
            const credenciais = SistemaLocal.carregar(SistemaLocal.CHAVES.CREDENCIAIS, []);
            fornecedores.forEach(fornecedor => {
                credenciais.push({
                    id: Date.now() + Math.random(),
                    processoId: processData.id,
                    numeroProcesso: processData.numeroProcesso,
                    cnpj: fornecedor.cnpj,
                    razaoSocial: fornecedor.razaoSocial,
                    email: fornecedor.email,
                    login: fornecedor.login,
                    senha: fornecedor.senha,
                    ativo: true,
                    dataCriacao: new Date().toISOString()
                });
            });
            SistemaLocal.salvar(SistemaLocal.CHAVES.CREDENCIAIS, credenciais);

            // Simular envio de e-mails
            simularEnvioEmails();

            alert(`Processo ${processData.numeroProcesso} criado com sucesso!\n\nCredenciais enviadas para ${fornecedores.length} fornecedor(es).`);
            
            // Redirecionar para dashboard
            navigateTo('dashboard');
        }

        function simularEnvioEmails() {
            console.log('Enviando e-mails para fornecedores...');
            
            fornecedores.forEach(fornecedor => {
                console.log(`E-mail enviado para ${fornecedor.email}:`);
                console.log(`Assunto: Credenciais de Acesso - Processo ${processData.numeroProcesso}`);
                console.log(`Login: ${fornecedor.login}`);
                console.log(`Senha: ${fornecedor.senha}`);
                console.log('---');
            });
        }

        // Fun√ß√µes utilit√°rias
        function formatarCNPJ(input) {
            let value = input.value.replace(/\D/g, '');
            value = value.replace(/^(\d{2})(\d)/, '$1.$2');
            value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
            value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
            value = value.replace(/(\d{4})(\d)/, '$1-$2');
            input.value = value;
        }

        function validarCNPJ(cnpj) {
            cnpj = cnpj.replace(/\D/g, '');
            return cnpj.length === 14;
        }

        function validarEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }

        function gerarSenha() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let senha = '';
            for (let i = 0; i < 8; i++) {
                senha += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return senha;
        }

        function formatarDataHora(dataHora) {
            return new Date(dataHora).toLocaleString('pt-BR');
        }

        function navigateTo(page) {
            switch(page) {
                case 'dashboard':
                    window.location.href = 'dashboard-comprador-integrado-completo.html';
                    break;
                case 'aprovacao-tr':
                    window.location.href = 'dashboard-comprador-integrado-completo.html';
                    break;
                case 'criar-processo':
                    // J√° estamos na p√°gina
                    break;
                case 'propostas':
                    window.location.href = 'dashboard-comprador-integrado-completo.html';
                    break;
                case 'sair':
                    if (confirm('Deseja realmente sair? Dados n√£o salvos ser√£o perdidos.')) {
                        window.location.href = '/';
                    }
                    break;
            }
        }

        // Inicializar primeira etapa
        mostrarEtapa(1);
        atualizarBotoes();
    </script>
</body>
</html>
