<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Unificado</title>
  <style>
    :root{--bg1:#185a9d;--bg2:#43cea2;--card:rgba(255,255,255,.06);--b:rgba(255,255,255,.12);--txt:#F4F6F8;--muted:#c8d0d8;}
    *{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;color:var(--txt);
      background:linear-gradient(135deg,var(--bg1),var(--bg2)) fixed;display:flex;align-items:center;justify-content:center;padding:24px}
    .wrap{width:100%;max-width:420px}
    .card{background:var(--card);border:1px solid var(--b);backdrop-filter:blur(8px);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden}
    .hd{padding:18px 22px;border-bottom:1px solid var(--b);display:flex;gap:12px;align-items:center}
    .hd h1{font-size:18px;margin:0}
    .bd{padding:22px}
    label{display:block;font-size:13px;color:var(--muted);margin:0 0 6px}
    input{width:100%;padding:12px 12px;border-radius:12px;border:1px solid var(--b);background:rgba(0,0,0,.15);color:var(--txt)}
    .actions{display:flex;gap:12px;justify-content:flex-end;margin-top:18px}
    button{padding:12px 18px;border-radius:12px;border:1px solid var(--b);background:#179E7A;color:white;font-weight:600;cursor:pointer;width:100%}
    .msg{margin-top:10px;font-size:13px}
    .err{color:#ffb3b3}.ok{color:#6ae0a7}
  </style>
  <script>
    async function doLogin(e){
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      const senha = document.getElementById('senha').value;
      try{
        const res = await fetch('/api/auth/login', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, senha })
        });
        const data = await res.json().catch(()=>({}));
        if(res.ok){
          const { access_token, token, perfil, nome } = data;
          localStorage.setItem('access_token', access_token || token || '');
          localStorage.setItem('perfil', perfil||'');
          localStorage.setItem('nome', nome||'');
          const map = {
            'requisitante':'/static/dashboard-requisitante-integrado.html',
            'comprador':'/static/dashboard-comprador-funcional.html',
            'fornecedor':'/static/portal-propostas-novo.html',
            'admin':'/static/dashboard-comprador-funcional.html'
          };
          location.href = map[perfil] || '/static/index.html';
        }else{
          setMsg(data.erro || data.message || 'Falha no login', true);
        }
      }catch(err){
        setMsg('Erro de rede. Tente novamente.', true);
      }
    }
    function setMsg(t,err){ const m=document.getElementById('msg'); m.textContent=t; m.className='msg '+(err?'err':'ok'); }
  </script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="hd"><h1>Acesso ao Sistema</h1></div>
      <div class="bd">
        <form onsubmit="doLogin(event)">
          <label>E-mail / Usu√°rio</label>
          <input id="email" required placeholder="email@empresa.com">
          <label style="margin-top:12px">Senha</label>
          <input id="senha" type="password" required>
          <div class="actions"><button type="submit">Entrar</button></div>
          <div id="msg" class="msg"></div>
        </form>
      </div>
    </div>
  </div>
</body>
</html>
